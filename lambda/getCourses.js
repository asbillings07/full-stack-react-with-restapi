!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a}),n.d(e,"d",function(){return s}),n.d(e,"h",function(){return u}),n.d(e,"e",function(){return c}),n.d(e,"f",function(){return h}),n.d(e,"g",function(){return l});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function s(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function u(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function c(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}},function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return p}),n.d(e,"c",function(){return I}),n.d(e,"d",function(){return S}),n.d(e,"e",function(){return j}),n.d(e,"f",function(){return o}),n.d(e,"g",function(){return a}),n.d(e,"h",function(){return u}),n.d(e,"i",function(){return c}),n.d(e,"j",function(){return R}),n.d(e,"k",function(){return F}),n.d(e,"l",function(){return l}),n.d(e,"m",function(){return f}),n.d(e,"n",function(){return B}),n.d(e,"o",function(){return d}),n.d(e,"p",function(){return k}),n.d(e,"q",function(){return y}),n.d(e,"r",function(){return b}),n.d(e,"s",function(){return M}),n.d(e,"t",function(){return w}),n.d(e,"u",function(){return m}),n.d(e,"v",function(){return g}),n.d(e,"w",function(){return T}),n.d(e,"x",function(){return v}),n.d(e,"y",function(){return _}),n.d(e,"z",function(){return D}),n.d(e,"A",function(){return O}),n.d(e,"B",function(){return L}),n.d(e,"C",function(){return x}),n.d(e,"D",function(){return P}),n.d(e,"E",function(){return Q}),n.d(e,"F",function(){return H}),n.d(e,"G",function(){return N}),n.d(e,"H",function(){return q}),n.d(e,"I",function(){return W}),n.d(e,"J",function(){return K});var r=n(0),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw a(e)},a=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},s=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){var e=s(t);return u.encodeByteArray(e,!0)},h=function(t){try{return u.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function l(t){return f(void 0,t)}function f(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=f(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var p=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())}function g(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}function y(){return"object"==typeof self&&self.self===self}function v(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function b(){return d().indexOf("Electron/")>=0}function w(){var t=d();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function _(){return d().indexOf("MSAppHost/")>=0}function T(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var E="FirebaseError",S=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=E,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,I.prototype.create),i}return Object(r.c)(e,t),e}(Error),I=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(C,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new S(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},t}();var C=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O(t){return JSON.parse(t)}function N(t){return JSON.stringify(t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var A=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=O(h(o[0])||""),n=O(h(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},D=function(t){var e=A(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},k=function(t){var e=A(t).claims;return"object"==typeof e&&!0===e.admin};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function P(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function M(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function L(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach(function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var j=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=h^u&(c^h),a=1518500249):(o=u^c^h,a=1859775393):r<60?(o=u&c|h&(u|c),a=2400959708):(o=u^c^h,a=3395469782);i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();function F(t,e){var n=new U(t,e);return n.subscribe.bind(n)}var U=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=V),void 0===r.error&&(r.error=V),void 0===r.complete&&(r.complete=V);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function V(){}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var q=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function B(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function W(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(B(t,e,r)+"must be a valid function.")}function K(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(B(t,e,r)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var H=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;o(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},Q=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e}},function(t,e,n){"use strict";var r,i,o=n(0),a=n(1),s=n(3),u=n(4),c=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r),h=new a.c("app","Firebase",c),l="@firebase/app",f="0.5.1",p="[DEFAULT]",d=((i={})[l]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),m=new u.b("@firebase/app"),g=function(){function t(t,e,n){var r,i,u=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Object(a.l)(t),this.container=new s.b(e.name),this._addComponent(new s.a("app",function(){return u},"PUBLIC"));try{for(var c=Object(o.h)(this.firebase_.INTERNAL.components.values()),h=c.next();!h.done;h=c.next()){var l=h.value;this._addComponent(l)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map(function(t){return t.delete()}))}).then(function(){t.isDeleted_=!0})},t.prototype._getService=function(t,e){return void 0===e&&(e=p),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=p),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){m.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw h.create("app-deleted",{appName:this.name_})},t}();g.prototype.name&&g.prototype.options||g.prototype.delete||console.log("dc");var y="7.6.2";
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var v=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){if(void 0===i&&(i={}),"object"!=typeof i||null===i){var o=i;i={name:o}}var s=i;void 0===s.name&&(s.name=p);var u=s.name;if("string"!=typeof u||!u)throw h.create("bad-app-name",{appName:String(u)});if(Object(a.j)(e,u))throw h.create("duplicate-app",{appName:u});var c=new t(n,s,r);return e[u]=c,c},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=d[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var c=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&c.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&c.push("and"),a&&c.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void m.warn(c.join(" "))}u(new s.a(i+"-version",function(){return{library:i,version:e}},"VERSION"))},apps:null,SDK_VERSION:y,INTERNAL:{registerComponent:u,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"===e?null:e}}};function i(t){if(t=t||p,!Object(a.j)(e,t))throw h.create("no-app",{appName:t});return e[t]}function u(s){var u,c,l=s.name;if(n.has(l))return m.debug("There were multiple attempts to register component "+l+"."),"PUBLIC"===s.type?r[l]:null;if(n.set(l,s),"PUBLIC"===s.type){var f=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[l])throw h.create("invalid-app-argument",{appName:l});return t[l]()};void 0!==s.serviceProps&&Object(a.m)(f,s.serviceProps),r[l]=f,t.prototype[l]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,l).apply(this,s.multipleInstances?t:[])}}try{for(var p=Object(o.h)(Object.keys(e)),d=p.next();!d.done;d=p.next()){var g=d.value;e[g]._addComponent(s)}}catch(t){u={error:t}}finally{try{d&&!d.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}return"PUBLIC"===s.type?r[l]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map(function(t){return e[t]})}}),i.App=t,r}(g);return e.INTERNAL=Object(o.a)(Object(o.a)({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Object(a.m)(e,t)},createSubscribe:a.k,ErrorFactory:a.c,deepExtend:a.m}),e}(),b=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(t){if(function(t){var e,n=t.getComponent();return"VERSION"===(null===(e=n)||void 0===e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null}).filter(function(t){return t}).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(Object(a.q)()&&void 0!==self.firebase){m.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var w=self.firebase.SDK_VERSION;w&&w.indexOf("LITE")>=0&&m.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var _=v.initializeApp;v.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object(a.v)()&&m.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),_.apply(void 0,t)};var T=v;!function(t,e){t.INTERNAL.registerComponent(new s.a("platform-logger",function(t){return new b(t)},"PRIVATE")),t.registerVersion(l,f,e),t.registerVersion("fire-js","")}(T),e.a=T},function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return u});var r=n(0),i=n(1),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),a="[DEFAULT]",s=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t=a);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new i.b;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=Object(r.a)({identifier:a,optional:!1},t),n=e.identifier,i=e.optional,o=this.normalizeInstanceIdentifier(n);try{var s=this.getOrInitializeService(o);if(!s){if(i)return null;throw Error("Service "+this.name+" is not available")}return s}catch(t){if(i)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService(a)}catch(t){}try{for(var i=Object(r.h)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var s=Object(r.e)(o.value,2),u=s[0],c=s[1],h=this.normalizeInstanceIdentifier(u);try{var l=this.getOrInitializeService(h);c.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t=a),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))];case 1:return e.sent(),[2]}})})},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return t===a?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:a:t},t}();var u=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new s(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}()},function(t,e,n){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n.d(e,"a",function(){return i}),n.d(e,"b",function(){return u});var i,o=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(i||(i={}));var a=i.INFO,s=function(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];if(!(e<t.logLevel)){var a=(new Date).toISOString();switch(e){case i.DEBUG:case i.VERBOSE:console.log.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case i.INFO:console.info.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case i.WARN:console.warn.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case i.ERROR:console.error.apply(console,r(["["+a+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},u=function(){function t(t){this.name=t,this._logLevel=a,this._logHandler=s,o.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in i))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,i.ERROR],t))},t}()},function(t,e,n){"use strict";var r,i=n(2),o=n(0),a=n(4),s=n(1),u=n(3),c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h=h||{},l=c;function f(t){return"string"==typeof t}function p(t){return"number"==typeof t}function d(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function m(){}function g(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function y(t){return"array"==g(t)}function v(t){var e=g(t);return"array"==e||"object"==e&&"number"==typeof t.length}function b(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var w="closure_uid_"+(1e9*Math.random()>>>0),_=0;function T(t,e,n){return t.call.apply(t.bind,arguments)}function E(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function S(t,e,n){return(S=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?T:E).apply(null,arguments)}function I(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var C=Date.now||function(){return+new Date};function O(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.xb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function N(){this.j=this.j,this.i=this.i}N.prototype.j=!1,N.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[w]||(this[w]=++_)},N.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var A=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(f(t))return f(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},D=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=f(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function k(t){return Array.prototype.concat.apply([],arguments)}function R(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function P(t){return/^[\s\xa0]*$/.test(t)}var M,L=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function x(t,e){return-1!=t.indexOf(e)}function j(t,e){return t<e?-1:t>e?1:0}t:{var F=l.navigator;if(F){var U=F.userAgent;if(U){M=U;break t}}M=""}function V(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function q(t){var e,n={};for(e in t)n[e]=t[e];return n}var B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<B.length;o++)n=B[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function K(t){return K[" "](t),t}K[" "]=m;var H,Q,G=x(M,"Opera"),z=x(M,"Trident")||x(M,"MSIE"),Y=x(M,"Edge"),X=Y||z,J=x(M,"Gecko")&&!(x(M.toLowerCase(),"webkit")&&!x(M,"Edge"))&&!(x(M,"Trident")||x(M,"MSIE"))&&!x(M,"Edge"),$=x(M.toLowerCase(),"webkit")&&!x(M,"Edge");function Z(){var t=l.document;return t?t.documentMode:void 0}t:{var tt="",et=(Q=M,J?/rv:([^\);]+)(\)|;)/.exec(Q):Y?/Edge\/([\d\.]+)/.exec(Q):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Q):$?/WebKit\/(\S+)/.exec(Q):G?/(?:Version)[ \/]?(\S+)/.exec(Q):void 0);if(et&&(tt=et?et[1]:""),z){var nt=Z();if(null!=nt&&nt>parseFloat(tt)){H=String(nt);break t}}H=tt}var rt,it={};function ot(t){return function(t,e){var n=it;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=L(String(H)).split("."),r=L(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=j(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||j(0==a[2].length,0==s[2].length)||j(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}var at=l.document;rt=at&&z?Z()||("CSS1Compat"==at.compatMode?parseInt(H,10):5):void 0;var st=!z||9<=Number(rt),ut=z&&!ot("9"),ct=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",m,e),l.removeEventListener("test",m,e)}catch(t){}return t}();function ht(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function lt(t,e){if(ht.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(J){t:{try{K(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=f(t.pointerType)?t.pointerType:ft[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}ht.prototype.b=function(){this.Ia=!1},O(lt,ht);var ft={2:"touch",3:"pen",4:"mouse"};lt.prototype.b=function(){lt.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ut)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var pt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function mt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++dt,this.X=this.Z=!1}function gt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function yt(t){this.src=t,this.a={},this.b=0}function vt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=A(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(gt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function bt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}yt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=bt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new mt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var wt="closure_lm_"+(1e6*Math.random()|0),_t={};function Tt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(y(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Dt(r);return e&&e[pt]?e.Aa(n,r,b(i)?!!i.capture:!!i,o):Et(e,n,r,!0,i,o)}(t,e,n,r,i);if(y(e)){for(var o=0;o<e.length;o++)Tt(t,e[o],n,r,i);return null}return n=Dt(n),t&&t[pt]?t.za(e,n,b(r)?!!r.capture:!!r,i):Et(t,e,n,!1,r,i)}function Et(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=b(i)?!!i.capture:!!i;if(a&&!st)return null;var s=Nt(t);if(s||(t[wt]=s=new yt(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Ot,e=st?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ct||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(It(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function St(t){if(!p(t)&&t&&!t.X){var e=t.src;if(e&&e[pt])vt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(It(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Nt(e))?(vt(n,t),0==n.b&&(n.src=null,e[wt]=null)):gt(t)}}}function It(t){return t in _t?_t[t]:_t[t]="on"+t}function Ct(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&St(t),n.call(r,e)}function Ot(t,e){return!!t.X||(st?Ct(t,new lt(e,this)):Ct(t,e=new lt(e||d("window.event"),this)))}function Nt(t){return(t=t[wt])instanceof yt?t:null}var At="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dt(t){return"function"==g(t)?t:(t[At]||(t[At]=function(e){return t.handleEvent(e)}),t[At])}function kt(){N.call(this),this.c=new yt(this),this.J=this,this.B=null}function Rt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&vt(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}O(kt,N),kt.prototype[pt]=!0,(r=kt.prototype).addEventListener=function(t,e,n,r){Tt(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(y(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=b(i)?!!i.capture:!!i,r=Dt(r),e&&e[pt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=bt(a=e.a[n],r,i,o))&&(gt(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=Nt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=bt(n,r,i,o)),(r=-1<e?n[e]:null)&&St(r))}(this,t,e,n,r)},r.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(f(t))t=new ht(t,n);else if(t instanceof ht)t.target=t.target||n;else{var i=t;W(t=new ht(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Rt(a,r,!0,t)&&i}if(i=Rt(a=t.a=n,r,!0,t)&&i,i=Rt(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Rt(a=t.a=e[o],r,!1,t)&&i;return i},r.G=function(){if(kt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)gt(n[r]);delete e.a[t],e.b--}}this.B=null},r.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},r.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Pt=l.JSON.stringify;function Mt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Lt(){this.b=this.a=null}Mt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var xt,jt=new Mt(function(){return new Ut},function(t){t.reset()});function Ft(){var t=Wt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Ut(){this.next=this.b=this.a=null}function Vt(t){l.setTimeout(function(){throw t},0)}function qt(t,e){xt||function(){var t=l.Promise.resolve(void 0);xt=function(){t.then(Kt)}}(),Bt||(xt(),Bt=!0),Wt.add(t,e)}Lt.prototype.add=function(t,e){var n=jt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ut.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Ut.prototype.reset=function(){this.next=this.b=this.a=null};var Bt=!1,Wt=new Lt;function Kt(){for(var t;t=Ft();){try{t.a.call(t.b)}catch(t){Vt(t)}var e=jt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Bt=!1}function Ht(t,e){kt.call(this),this.b=t||1,this.a=e||l,this.f=S(this.fb,this),this.g=C()}function Qt(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Gt(t,e,n){if("function"==g(t))n&&(t=S(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=S(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function zt(t,e,n){N.call(this),this.f=null!=n?S(t,n):t,this.c=e,this.b=S(this.$a,this),this.a=[]}function Yt(t){t.U=Gt(t.b,t.c),t.f.apply(null,t.a)}function Xt(t){N.call(this),this.b=t,this.a={}}O(Ht,kt),(r=Ht.prototype).ba=!1,r.L=null,r.fb=function(){if(this.ba){var t=C()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Qt(this),this.start()))}},r.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=C())},r.G=function(){Ht.N.G.call(this),Qt(this),delete this.a},O(zt,N),(r=zt.prototype).ea=!1,r.U=null,r.Ta=function(t){this.a=arguments,this.U?this.ea=!0:Yt(this)},r.G=function(){zt.N.G.call(this),this.U&&(l.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},r.$a=function(){this.U=null,this.ea&&(this.ea=!1,Yt(this))},O(Xt,N);var Jt=[];function $t(t,e,n,r){y(n)||(n&&(Jt[0]=n.toString()),n=Jt);for(var i=0;i<n.length;i++){var o=Tt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Zt(t){V(t.a,function(t,e){this.a.hasOwnProperty(e)&&St(t)},t),t.a={}}function te(){}Xt.prototype.G=function(){Xt.N.G.call(this),Zt(this)},Xt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ee=new kt;function ne(t){ht.call(this,"serverreachability",t)}function re(t){ee.dispatchEvent(new ne(ee,t))}function ie(t){ht.call(this,"statevent",t)}function oe(t){ee.dispatchEvent(new ie(ee,t))}function ae(t){ht.call(this,"timingevent",t)}function se(t,e){if("function"!=g(t))throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){t()},e)}O(ne,ht),O(ie,ht),O(ae,ht);var ue={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},ce={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function he(){}function le(t){var e;return(e=t.a)||(e=t.a={}),e}function fe(){}he.prototype.a=null;var pe,de={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function me(){ht.call(this,"d")}function ge(){ht.call(this,"c")}function ye(){}function ve(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Xt(this),this.O=be,t=X?125:void 0,this.P=new Ht(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}O(me,ht),O(ge,ht),O(ye,he),pe=new ye;var be=45e3,we={},_e={};function Te(t,e,n){t.F=1,t.f=Ge(Ve(e)),t.l=n,t.H=!0,Se(t,null)}function Ee(t,e,n,r){t.F=1,t.f=Ge(Ve(e)),t.l=null,t.H=n,Se(t,r)}function Se(t,e){t.v=C(),Oe(t),t.D=Ve(t.f),Qe(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new zt(S(t.Ja,t,t.a),t.J)),$t(t.I,t.a,"readystatechange",t.cb),e=t.h?q(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),re(1)}function Ie(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ce(t,n);if(i==_e){4==e&&(t.c=4,oe(14),r=!1);break}if(i==we){t.c=4,oe(15),r=!1;break}Re(t,i)}4==e&&0==n.length&&(t.c=1,oe(16),r=!1),t.b=t.b&&r,r||(ke(t),De(t))}function Ce(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?_e:(n=Number(e.substring(n,r)),isNaN(n)?we:(r+=1)+n>e.length?_e:(e=e.substr(r,n),t.A=r+n,e))}function Oe(t){t.R=C()+t.O,Ne(t,t.O)}function Ne(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=se(S(t.ab,t),e)}function Ae(t){t.i&&(l.clearTimeout(t.i),t.i=null)}function De(t){t.g.Ca()||t.m||t.g.na(t)}function ke(t){Ae(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Qt(t.P),Zt(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Re(t,e){try{t.g.Fa(t,e),re(4)}catch(t){}}function Pe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(v(t)||f(t))D(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(v(t)||f(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(f(t))return t.split("");if(v(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Me(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Me)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Le(t,e){je(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&xe(t))}function xe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];je(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)je(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(r=ve.prototype).setTimeout=function(t){this.O=t},r.cb=function(t){t=t.target;var e=this.B;e&&3==Vn(t)?e.Ta():this.Ja(t)},r.Ja=function(t){try{if(t==this.a)t:{var e=Vn(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!X&&!this.a.aa())){this.m||4!=e||7==n||re(8==n||0>=r?3:2),Ae(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=qn(this.a,"X-HTTP-Initial-Response");if(a&&!P(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,oe(12),ke(this),De(this);break t}this.s=!0,Re(this,s)}this.H?(Ie(this,e,o),X&&this.b&&3==e&&($t(this.I,this.P,"tick",this.bb),this.P.start())):Re(this,o),4==e&&ke(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Oe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,oe(12)):(this.c=0,oe(13)),ke(this),De(this)}}}catch(t){}},r.bb=function(){if(this.a){var t=Vn(this.a),e=this.a.aa();this.A<e.length&&(Ae(this),Ie(this,t,e),this.b&&4!=t&&Oe(this))}},r.cancel=function(){this.m=!0,ke(this)},r.ab=function(){this.i=null;var t=C();0<=t-this.R?(2!=this.F&&(re(3),oe(17)),ke(this),this.c=2,De(this)):Ne(this,this.R-t)},(r=Me.prototype).C=function(){xe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},r.K=function(){return xe(this),this.a.concat()},r.get=function(t,e){return je(this.b,t)?this.b[t]:e},r.set=function(t,e){je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},r.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Fe=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ue(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Ue?(this.h=void 0!==e?e:t.h,qe(this,t.f),this.j=t.j,Be(this,t.b),We(this,t.i),this.a=t.a,Ke(this,un(t.c)),this.g=t.g):t&&(n=String(t).match(Fe))?(this.h=!!e,qe(this,n[1]||"",!0),this.j=ze(n[2]||""),Be(this,n[3]||"",!0),We(this,n[4]),this.a=ze(n[5]||"",!0),Ke(this,n[6]||"",!0),this.g=ze(n[7]||"")):(this.h=!!e,this.c=new nn(null,this.h))}function Ve(t){return new Ue(t)}function qe(t,e,n){t.f=n?ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Be(t,e,n){t.b=n?ze(e,!0):e}function We(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Ke(t,e,n){e instanceof nn?(t.c=e,function(t,e){e&&!t.f&&(rn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(on(this,e),sn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Ye(e,tn)),t.c=new nn(e,t.h))}function He(t,e,n){t.c.set(e,n)}function Qe(t,e,n){y(n)||(n=[String(n)]),sn(t.c,e,n)}function Ge(t){return He(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^C()).toString(36)),t}function ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ye(t,e,n){return f(t)?(t=encodeURI(t).replace(e,Xe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Xe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ue.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ye(e,Je,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ye(e,Je,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ye(n,"/"==n.charAt(0)?Ze:$e,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Ye(n,en)),t.join("")},Ue.prototype.resolve=function(t){var e=Ve(this),n=!!t.f;n?qe(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Be(e,t.b):n=null!=t.i;var r=t.a;if(n)We(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(x(i,"./")||x(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Ke(e,un(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Je=/[#\/\?@]/g,$e=/[#\?:]/g,Ze=/[#\?]/g,tn=/[#\?@]/g,en=/#/g;function nn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function rn(t){t.a||(t.a=new Me,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function on(t,e){rn(t),e=cn(t,e),je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Le(t.a,e))}function an(t,e){return rn(t),e=cn(t,e),je(t.a.b,e)}function sn(t,e,n){on(t,e),0<n.length&&(t.c=null,t.a.set(cn(t,e),R(n)),t.b+=n.length)}function un(t){var e=new nn;return e.c=t.c,t.a&&(e.a=new Me(t.a),e.b=t.b),e}function cn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function hn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function ln(t){var e=t.a.F.a;if(null!=e)oe(4),e?(oe(10),Zn(t.a,t,!1)):(oe(11),Zn(t.a,t,!0));else{t.b=new ve(t,void 0,void 0),t.b.h=t.h,e=ir(e=t.a,e.Y()?t.f:null,t.i),oe(4),Qe(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&He(e,n,r),Ee(t.b,e,!1,t.f)}}function fn(){this.a=this.b=null}function pn(){this.a=new Me}function dn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[w]||(t[w]=++_)):e.charAt(0)+t}function mn(t,e){this.b=t,this.a=e}function gn(t){this.g=t||yn,l.PerformanceNavigationTiming?t=0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(l.ka&&l.ka.Da&&l.ka.Da()&&l.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new pn),this.b=null,this.c=[]}(r=nn.prototype).add=function(t,e){rn(this),this.c=null,t=cn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},r.forEach=function(t,e){rn(this),this.a.forEach(function(n,r){D(n,function(n){t.call(e,n,r,this)},this)},this)},r.K=function(){rn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},r.C=function(t){rn(this);var e=[];if(f(t))an(this,t)&&(e=k(e,this.a.get(cn(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=k(e,t[n])}return e},r.set=function(t,e){return rn(this),this.c=null,an(this,t=cn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},r.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},r.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},O(function(){},function(){}),(r=hn.prototype).M=null,r.$=function(t){return this.a.$(t)},r.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},r.Ca=function(){return!1},r.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=qn(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=qn(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void nr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,nr(e,2)}else 1==this.M&&(this.g?oe(6):"11111"==e?(oe(5),this.g=!0,(!z||10<=Number(rt))&&(this.c=200,this.b.cancel(),oe(11),Zn(this.a,this,!0))):(oe(7),this.g=!1))},r.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,ln(this)):1==this.M&&(this.g?(oe(11),Zn(this.a,this,!0)):(oe(10),Zn(this.a,this,!1)));else{0==this.M?oe(8):1==this.M&&oe(9);var t=this.a;t.m=this.c,nr(t,2)}},r.Y=function(){return this.a.Y()},r.ma=function(){return this.a.ma()},pn.prototype.add=function(t){this.a.set(dn(t),t)},pn.prototype.C=function(){return this.a.C()};var yn=10;function vn(t,e){!t.a&&(x(e,"spdy")||x(e,"quic")||x(e,"h2"))&&(t.f=t.g,t.a=new pn,t.b&&(Tn(t,t.b),t.b=null))}function bn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function wn(t){return t.b?1:t.a?t.a.a.c:0}function _n(t,e){return t.b?t=t.b==e:t.a?(e=dn(e),t=je(t.a.a.b,e)):t=!1,t}function Tn(t,e){t.a?t.a.add(e):t.b=e}function En(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=dn(e),n=je(t.a.a.b,n)),n&&Le(t.a.a,dn(e)))}function Sn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return D(t.a.C(),function(t){e=e.concat(t.j)}),e}return R(t.c)}function In(){}function Cn(){this.a=new In}function On(t,e,n){var r=n||"";try{Pe(t,function(t,n){var i=t;b(t)&&(i=Pt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Nn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}gn.prototype.cancel=function(){var t;this.c=Sn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(D(this.a.C(),function(t){t.cancel()}),(t=this.a.a).b={},t.a.length=0,t.c=0)},In.prototype.stringify=function(t){return l.JSON.stringify(t,void 0)},In.prototype.parse=function(t){return l.JSON.parse(t,void 0)};var An=l.JSON.parse;function Dn(t){kt.call(this),this.headers=new Me,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=kn,this.D=this.F=!1}O(Dn,kt);var kn="",Rn=/^https?$/i,Pn=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function Ln(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,xn(t),Fn(t)}function xn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function jn(t){if(t.b&&void 0!==h&&(!t.s[1]||4!=Vn(t)||2!=t.T()))if(t.l&&4==Vn(t))Gt(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Vn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Fe)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!Rn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var s=2<Vn(t)?t.a.statusText:""}catch(t){s=""}t.f=s+" ["+t.T()+"]",xn(t)}}finally{Fn(t)}}}function Fn(t,e){if(t.a){Un(t);var n=t.a,r=t.s[0]?m:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Un(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(l.clearTimeout(t.m),t.m=null)}function Vn(t){return t.a?t.a.readyState:0}function qn(t,e){return t.a?t.a.getResponseHeader(e):null}function Bn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return V(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),f(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return He(t,e,n),t}function Wn(t){this.f=[],this.F=new fn,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!d("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=d("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=d("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=d("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=d("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new gn(t&&t.concurrentRequestLimit),this.ja=new Cn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Kn(t){if(Hn(t),3==t.u){var e=t.P++,n=Ve(t.B);He(n,"SID",t.H),He(n,"RID",e),He(n,"TYPE","terminate"),Yn(t,n),(e=new ve(t,e,void 0)).F=2,e.f=Ge(Ve(n)),n=!1,l.navigator&&l.navigator.sendBeacon&&(n=l.navigator.sendBeacon(e.f.toString(),"")),!n&&l.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=C(),Oe(e)}rr(t)}function Hn(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(l.clearTimeout(t.l),t.l=null),tr(t),t.b.cancel(),t.h&&(p(t.h)&&l.clearTimeout(t.h),t.h=null)}function Qn(t,e){t.f.push(new mn(t.Qa++,e)),3==t.u&&Gn(t)}function Gn(t){bn(t.b)||t.h||(t.h=!0,qt(t.Ha,t),t.A=0)}function zn(t,e){var n;n=e?e.W:t.P++;var r=Ve(t.B);He(r,"SID",t.H),He(r,"RID",n),He(r,"AID",t.O),Yn(t,r),t.g&&t.i&&Bn(r,t.g,t.i),n=new ve(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Xn(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Tn(t.b,n),Te(n,r,e)}function Yn(t,e){t.c&&Pe({},function(t,n){He(e,n,t)})}function Xn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?S(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{On(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Jn(t){t.a||t.l||(t.S=1,qt(t.Ga,t),t.v=0)}function $n(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=se(S(t.Ga,t),er(t,t.v)),t.v++,!0)}function Zn(t,e,n){var r=e.l;r&&vn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=ir(t,null,t.ha),Gn(t)}function tr(t){null!=t.s&&(l.clearTimeout(t.s),t.s=null)}function er(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function nr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=S(t.eb,t);n||(n=new Ue("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||qe(n,"https"),Ge(n)),function(t,e){var n=new te;if(l.Image){var r=new Image;r.onload=I(Nn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=I(Nn,n,r,"TestLoadImage: error",!1,e),r.onabort=I(Nn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=I(Nn,n,r,"TestLoadImage: timeout",!1,e),l.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else oe(2);t.u=0,t.c&&t.c.ta(e),rr(t),Hn(t)}function rr(t){t.u=0,t.m=-1,t.c&&(0==Sn(t.b).length&&0==t.f.length||(t.b.c.length=0,R(t.f),t.f.length=0),t.c.sa())}function ir(t,e,n){var r=function(t){return t instanceof Ue?Ve(t):new Ue(t,void 0)}(n);if(""!=r.b)e&&Be(r,e+"."+r.b),We(r,r.i);else{var i,o=l.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Ue(null,void 0);return t&&qe(i,t),e&&Be(i,e),n&&We(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&V(t.V,function(t,e){He(r,e,t)}),e=t.j,n=t.I,e&&n&&He(r,e,n),He(r,"VER",t.wa),Yn(t,r),r}function or(){}function ar(){if(z&&!(10<=Number(rt)))throw Error("Environmental error: no available transport.")}function sr(t,e){kt.call(this),this.a=new Wn(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!P(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!P(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new hr(this)}function ur(t){me.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){ge.call(this),this.status=1}function hr(t){this.a=t}(r=Dn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?le(this.H):le(pe),this.a.onreadystatechange=S(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Ln(this,t)}t=n||"";var i=new Me(this.headers);r&&Pe(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Mn,n=t.length,r=f(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:f(t)?t.charAt(e):t[e]}(i.K()),n=l.FormData&&t instanceof l.FormData,!(0<=A(Pn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Un(this),0<this.o&&((this.D=function(t){return z&&ot(9)&&p(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=S(this.Ba,this)):this.m=Gt(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ln(this,t)}},r.Ba=function(){void 0!==h&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},r.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Fn(this))},r.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Fn(this,!0)),Dn.N.G.call(this)},r.Ea=function(){this.j||(this.w||this.l||this.g?jn(this):this.Za())},r.Za=function(){jn(this)},r.T=function(){try{return 2<Vn(this)?this.a.status:-1}catch(t){return-1}},r.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},r.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),An(e)}},r.ya=function(){return this.h},r.Xa=function(){return f(this.f)?this.f:String(this.f)},(r=Wn.prototype).wa=8,r.u=1,r.Ca=function(){return 0==this.u},r.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new ve(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?W(r=q(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&f(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xn(this,n,e),He(i=Ve(this.B),"RID",t),He(i,"CVER",22),this.o&&this.j&&He(i,"X-HTTP-Session-Id",this.j),Yn(this,i),this.g&&r&&Bn(i,this.g,r),Tn(this.b,n),this.W?(He(i,"$req",e),He(i,"SID","null"),n.S=!0,Te(n,i,null)):Te(n,i,e),this.u=2}}else 3==this.u&&(t?zn(this,t):0==this.f.length||bn(this.b)||zn(this))},r.Ga=function(){this.l=null,this.a=new ve(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ve(this.pa);He(t,"RID","rpc"),He(t,"SID",this.H),He(t,"CI",this.ia?"0":"1"),He(t,"AID",this.O),Yn(this,t),He(t,"TYPE","xmlhttp"),this.g&&this.i&&Bn(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Ee(this.a,t,!0,this.ga)},r.Fa=function(t,e){if(0!=this.u&&(this.a==t||_n(this.b,t)))if(this.m=t.o,!t.s&&_n(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(y(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;tr(this),this.a.cancel(),this.a=null}$n(this),oe(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=se(S(this.Ya,this),6e3));if(1>=wn(this.b)&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else nr(this,11)}else if((t.s||this.a==t)&&tr(this),!P(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&p(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=qn(r,"X-Client-Wire-Protocol"))&&vn(this.b,i),this.j&&(r=qn(r,"X-HTTP-Session-Id")))&&(this.I=r,He(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=ir(this,this.Y()?this.ga:null,this.ha),r.s?(En(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ae(r),Oe(r)),this.a=r):Jn(this),0<this.f.length&&Gn(this)}else"stop"!=r[0]&&"close"!=r[0]||nr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?nr(this,7):Kn(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},r.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,$n(this),oe(19))},r.na=function(t){var e=null;if(this.a==t){tr(this),this.a=null;var n=2}else{if(!_n(this.b,t))return;e=t.j,En(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=C()-t.v,ee.dispatchEvent(new ae(ee,t.l?t.l.length:0,e,this.A)),Gn(this)):Jn(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(wn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa)||(t.h=se(S(t.Ha,t,e),er(t,t.A)),t.A++,0)))}(this,t)||2==n&&$n(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:nr(this,5);break;case 4:nr(this,10);break;case 3:nr(this,6);break;default:nr(this,2)}}},r.eb=function(t){oe(t?2:1)},r.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Dn(this.Ka)).F=this.R,t},r.ma=function(){return!!this.c&&!0},r.Y=function(){return this.R},(r=or.prototype).va=function(){},r.ua=function(){},r.ta=function(){},r.sa=function(){},r.Sa=function(){},ar.prototype.a=function(t,e){return new sr(t,e)},O(sr,kt),(r=sr.prototype).addEventListener=function(t,e,n,r){sr.N.addEventListener.call(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){sr.N.removeEventListener.call(this,t,e,n,r)},r.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;oe(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new hn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Bn(e,t.g,t.i)),(t=t.w).i=n,e=ir(t.a,null,t.i),oe(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,ln(t)):(Qe(e,"MODE","init"),!t.a.o&&t.a.j&&Qe(e,"X-HTTP-Session-Id",t.a.j),t.b=new ve(t,void 0,void 0),t.b.h=t.h,Ee(t.b,e,!1,null),t.M=0)},r.close=function(){Kn(this.a)},r.Wa=function(t){if(f(t)){var e={};e.__data__=t,Qn(this.a,e)}else this.h?((e={}).__data__=Pt(t),Qn(this.a,e)):Qn(this.a,t)},r.G=function(){this.a.c=null,delete this.f,Kn(this.a),delete this.a,sr.N.G.call(this)},O(ur,me),O(cr,ge),O(hr,or),hr.prototype.va=function(){this.a.dispatchEvent("a")},hr.prototype.ua=function(t){this.a.dispatchEvent(new ur(t))},hr.prototype.ta=function(t){this.a.dispatchEvent(new cr(t))},hr.prototype.sa=function(){this.a.dispatchEvent("b")};var lr=I(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},ar);ar.prototype.createWebChannel=ar.prototype.a,sr.prototype.send=sr.prototype.Wa,sr.prototype.open=sr.prototype.Va,sr.prototype.close=sr.prototype.close,ue.NO_ERROR=0,ue.TIMEOUT=8,ue.HTTP_ERROR=6,ce.COMPLETE="complete",fe.EventType=de,de.OPEN="a",de.CLOSE="b",de.ERROR="c",de.MESSAGE="d",kt.prototype.listen=kt.prototype.za,Dn.prototype.listenOnce=Dn.prototype.Aa,Dn.prototype.getLastError=Dn.prototype.Xa,Dn.prototype.getLastErrorCode=Dn.prototype.ya,Dn.prototype.getStatus=Dn.prototype.T,Dn.prototype.getResponseJson=Dn.prototype.Ua,Dn.prototype.getResponseText=Dn.prototype.aa,Dn.prototype.send=Dn.prototype.ca;var fr,pr={createWebChannelTransport:lr,ErrorCode:ue,EventType:ce,WebChannel:fe,XhrIo:Dn},dr=pr.createWebChannelTransport,mr=pr.ErrorCode,gr=pr.EventType,yr=pr.WebChannel,vr=pr.XhrIo,br=i.a.SDK_VERSION,wr=new a.b("@firebase/firestore");function _r(){return wr.logLevel===a.a.DEBUG?fr.DEBUG:wr.logLevel===a.a.SILENT?fr.SILENT:fr.ERROR}function Tr(t){switch(t){case fr.DEBUG:wr.logLevel=a.a.DEBUG;break;case fr.ERROR:wr.logLevel=a.a.ERROR;break;case fr.SILENT:wr.logLevel=a.a.SILENT;break;default:wr.error("Firestore ("+br+"): Invalid value passed to `setLogLevel`")}}function Er(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(wr.logLevel<=a.a.DEBUG){var i=n.map(Ir);wr.debug.apply(wr,Object(o.g)(["Firestore ("+br+") ["+t+"]: "+e],i))}}function Sr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(wr.logLevel<=a.a.ERROR){var r=e.map(Ir);wr.error.apply(wr,Object(o.g)(["Firestore ("+br+"): "+t],r))}}function Ir(t){if("string"==typeof t)return t;var e=Nr.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(t){var e="FIRESTORE ("+br+") INTERNAL ASSERTION FAILED: "+t;throw Sr(e),new Error(e)}function Or(t,e){t||Cr(e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT"}(fr||(fr={}));var Nr=function(){function t(){}return t.setPlatform=function(e){t.platform&&Cr("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||Cr("Platform not set"),t.platform},t}();function Ar(){return Nr.getPlatform().emptyByteString}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},kr=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(o.c)(e,t),e}(Error);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Rr(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new kr(Dr.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Mr(t,e){return void 0!==t?t:e}function Lr(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function xr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function jr(t){for(var e in Or(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Fr(t,e){if(0!==e.length)throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+ni(e.length,"argument")+".")}function Ur(t,e,n){if(e.length!==n)throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires "+ni(n,"argument")+", but was called with "+ni(e.length,"argument")+".")}function Vr(t,e,n){if(e.length<n)throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+ni(n,"argument")+", but was called with "+ni(e.length,"argument")+".")}function qr(t,e,n,r){if(e.length<n||e.length>r)throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+ni(e.length,"argument")+".")}function Br(t,e,n,r){zr(t,e,ei(n)+" argument",r)}function Wr(t,e,n,r){void 0!==r&&Br(t,e,n,r)}function Kr(t,e,n,r){zr(t,e,n+" option",r)}function Hr(t,e,n,r){void 0!==r&&Kr(t,e,n,r)}function Qr(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Xr(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Xr(r[o]))}(t,e,n,r,i)}function Gr(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Xr(u))}var c=Xr(r);throw new kr(Dr.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function zr(t,e,n,r){if(!("object"===e?Yr(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Xr(r);throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Yr(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Xr(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Cr("Unknown wrong type: "+typeof t)}function Jr(t,e,n){if(void 0===n)throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ei(e)+" argument, but it was undefined.")}function $r(t,e,n){xr(e,function(e,r){if(n.indexOf(e)<0)throw new kr(Dr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function Zr(t,e,n,r){var i=Xr(r);return new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires its "+ei(n)+" argument to be a "+e+", but it was: "+i)}function ti(t,e,n){if(n<=0)throw new kr(Dr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+ei(e)+" argument to be a positive number, but it was: "+n+".")}function ei(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function ni(t,e){return t+" "+e+(1===t?"":"s")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ri=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Or(20===e.length,"Invalid auto ID: "+e),e},t}();function ii(t,e){return t<e?-1:t>e?1:0}function oi(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function ai(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(){if("undefined"==typeof Uint8Array)throw new kr(Dr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ui(){if(!Nr.getPlatform().base64Available)throw new kr(Dr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ci,hi=function(){function t(t){ui(),this._binaryString=t}return t.fromBase64String=function(e){Ur("Blob.fromBase64String",arguments,1),Br("Blob.fromBase64String","string",1,e),ui();try{return new t(Nr.getPlatform().atob(e))}catch(t){throw new kr(Dr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(Ur("Blob.fromUint8Array",arguments,1),si(),!(e instanceof Uint8Array))throw Zr("Blob.fromUint8Array","Uint8Array",1,e);return new t(Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join(""))},t.prototype.toBase64=function(){return Ur("Blob.toBase64",arguments,0),ui(),Nr.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){Ur("Blob.toUint8Array",arguments,0),si();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return ii(this._binaryString,t._binaryString)},t}(),li=Rr(hi,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),fi=function(){return function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}}(),pi="(default)",di=function(){function t(t,e){this.projectId=t,this.database=e||pi}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===pi},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return ii(this.projectId,t.projectId)||ii(this.database,t.database)},t}(),mi=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),gi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Cr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Cr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,Or(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return Or(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return Or(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return Or(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),yi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new kr(Dr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return t.length>0}))},e.EMPTY_PATH=new e([]),e}(gi),vi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,bi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return vi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new kr(Dr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new kr(Dr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new kr(Dr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new kr(Dr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(gi),wi=function(){function t(e){this.path=e,Or(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===yi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return yi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new yi(e.slice()))},t.fromPathString=function(e){return new t(yi.fromString(e))},t.EMPTY=new t(new yi([])),t}(),_i=function(){return function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}}();!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection",t.RetryTransaction="retry_transaction"}(ci||(ci={}));var Ti=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new _i,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new kr(Dr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),Ei=function(){function t(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueAndInitiateShutdown=function(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},t.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Sr("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Or(e>=0,"Attempted to schedule an operation with a negative delay of "+e),this.timerIdsToSkip.indexOf(t)>-1&&(e=0);var i=Ti.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Cr("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){Or(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){Or(t===ci.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==ci.All&&i.timerId===t)break}return e.drain()})},t.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Or(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Si="",Ii="",Ci="",Oi="";function Ni(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Di(e)),e=Ai(t.get(n),e);return Di(e)}function Ai(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Si+Ci;break;case Si:n+=Si+Oi;break;default:n+=o}}return n}function Di(t){return t+Si+Ii}function ki(t){var e=t.length;if(Or(e>=2,"Invalid path "+t),2===e)return Or(t.charAt(0)===Si&&t.charAt(1)===Ii,"Non-empty path "+t+" had length 2"),yi.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Si,o);switch((a<0||a>n)&&Cr('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Ii:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Ci:i+=t.substring(o,a),i+="\0";break;case Oi:i+=t.substring(o,a+1);break;default:Cr('Invalid encoded resource path: "'+t+'"')}o=a+2}return new yi(r)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ri=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new kr(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new kr(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new kr(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new kr(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?ii(this.nanoseconds,t.nanoseconds):ii(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),Pi=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new Ri(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new Ri(0,0)),t}(),Mi=function(){function t(t,e){this.comparator=t,this.root=e||xi.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,xi.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xi.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Li(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Li(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Li(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Li(this.root,t,this.comparator,!0)},t}(),Li=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){Or(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),xi=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Cr("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Cr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Cr("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),ji=function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Cr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Cr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Cr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Cr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Cr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new xi(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xi.EMPTY=new ji;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Fi=function(){function t(t){this.comparator=t,this.data=new Mi(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Ui(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Ui(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Ui=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Vi=new Mi(wi.comparator);function qi(){return Vi}function Bi(){return qi()}var Wi=new Mi(wi.comparator);function Ki(){return Wi}var Hi=new Mi(wi.comparator);function Qi(){return Hi}var Gi=new Fi(wi.comparator);function zi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Gi,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Yi=new Fi(ii);function Xi(){return Yi}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ji=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,Or(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&Or(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Or(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&Or(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},zi())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&oi(this.mutations,t.mutations)&&oi(this.baseMutations,t.baseMutations)},t}(),$i=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){Or(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=Qi(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),Zi=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Cr("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++){r(o[i])}return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),to="SimpleDb",eo=function(){function t(e){this.db=e,12.2===t.getIOSVersion(Object(s.o)())&&Sr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.openOrCreate=function(e,n,r){return Or(t.isAvailable(),"IndexedDB not supported in current environment."),Er(to,"Opening database:",e),new Zi(function(i,o){var a=window.indexedDB.open(e,n);a.onsuccess=function(e){var n=e.target.result;i(new t(n))},a.onblocked=function(){o(new kr(Dr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new kr(Dr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},a.onupgradeneeded=function(t){Er(to,'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result;r.createOrUpgrade(n,a.transaction,t.oldVersion,la).next(function(){Er(to,"Database upgrade to version "+la+" complete")})}}).toPromise()},t.delete=function(t){return Er(to,"Removing database:",t),oo(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(t.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var e=Object(s.o)(),n=t.getIOSVersion(e),r=0<n&&n<10,i=t.getAndroidVersion(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.isMockPersistence=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.USE_MOCK_PERSISTENCE)},t.getStore=function(t,e){return t.store(e)},t.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},t.prototype.runTransaction=function(t,e,n){return Object(o.b)(this,void 0,void 0,function(){var r,i,a,s,u,c;return Object(o.d)(this,function(h){switch(h.label){case 0:r=t.startsWith("readonly"),i=t.endsWith("idempotent"),a=0,s=function(){var t,s,c,h;return Object(o.d)(this,function(o){switch(o.label){case 0:++a,t=ro.open(u.db,r?"readonly":"readwrite",e),o.label=1;case 1:return o.trys.push([1,3,,4]),(s=n(t).catch(function(e){return t.abort(e),Zi.reject(e)}).toPromise()).catch(function(){}),[4,t.completionPromise];case 2:return o.sent(),[2,{value:s}];case 3:return c=o.sent(),h=i&&"FirebaseError"!==c.name&&a<3,Er(to,"Transaction failed with error: %s. Retrying: %s.",c.message,h),h?[3,4]:[2,{value:Promise.reject(c)}];case 4:return[2]}})},u=this,h.label=1;case 1:return[5,s()];case 2:return"object"==typeof(c=h.sent())?[2,c.value]:[3,1];case 3:return[2]}})})},t.prototype.close=function(){this.db.close()},t}(),no=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return oo(this.dbCursor.delete())},t}(),ro=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new _i,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=so(t.target.error);e.completionDeferred.reject(n)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Er(to,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return Or(!!e,"Object store not part of transaction: "+t),new io(e)},t}(),io=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Er(to,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(Er(to,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),oo(n)},t.prototype.add=function(t){return Er(to,"ADD",this.store.name,t,t),oo(this.store.add(t))},t.prototype.get=function(t){var e=this;return oo(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Er(to,"GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Er(to,"DELETE",this.store.name,t),oo(this.store.delete(t))},t.prototype.count=function(){return Er(to,"COUNT",this.store.name),oo(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){Er(to,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new Zi(function(n,r){e.onerror=function(t){var e=so(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new Zi(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new no(i),a=e(i.primaryKey,i.value,o);if(a instanceof Zi){var s=a.catch(function(t){return o.done(),Zi.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return Zi.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Or(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function oo(t){return new Zi(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=so(t.target.error);n(e)}})}var ao=!1;function so(t){var e=eo.getIOSVersion(Object(s.o)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new kr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ao||(ao=!0,setTimeout(function(){throw r},0)),r}}return t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var uo=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return Or(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fo(t).iterate({index:ga.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=lo(n),mo(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=lo(e),mo(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=po(t),a=fo(t);return a.add({}).next(function(s){Or("number"==typeof s,"Auto-generated key is not a number");for(var u=new Ji(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u),h=[],l=new Fi(function(t,e){return ii(t.canonicalString(),e.canonicalString())}),f=0,p=r;f<p.length;f++){var d=p[f],m=ya.key(i.userId,d.key.path,s);l=l.add(d.key.path.popLast()),h.push(a.put(c)),h.push(o.put(m,ya.PLACEHOLDER))}return l.forEach(function(e){h.push(i.indexManager.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.documentKeysByBatchId[s]=u.keys()}),Zi.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return fo(t).get(e).next(function(t){return t?(Or(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?Zi.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return fo(t).iterate({index:ga.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Or(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return fo(t).iterate({index:ga.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fo(t).loadAll(ga.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ya.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return po(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=ki(u);if(s===n.userId&&e.path.isEqual(h))return fo(t).get(c).next(function(t){if(!t)throw Cr("Dangling document-mutation reference found: "+r+" which points to "+c);Or(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Fi(ii),i=[];return e.forEach(function(e){var o=ya.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=po(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=ki(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),Zi.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Or(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Or(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=ya.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new Fi(ii);return po(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=ki(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(fo(t).get(e).next(function(t){if(null===t)throw Cr("Dangling document-mutation reference found, which points to "+e);Or(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Zi.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return ho(t.simpleDbTransaction,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.removeCachedMutationKeys(e.batchId)}),Zi.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Zi.resolve();var r=IDBKeyRange.lowerBound(ya.prefixForUser(e.userId)),i=[];return po(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=ki(t[1]);i.push(o)}else r.done()}).next(function(){Or(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return co(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return mo(t).get(this.userId).next(function(t){return t||new ma(e.userId,-1,"")})},t}();function co(t,e,n){var r=ya.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return po(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2];o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function ho(t,e,n){var r=t.store(ga.store),i=t.store(ya.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Or(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=ya.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Zi.waitFor(o).next(function(){return c})}function lo(t){return t instanceof Uint8Array?(Or(eo.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function fo(t){return za.getStore(t,ga.store)}function po(t){return za.getStore(t,ya.store)}function mo(t){return za.getStore(t,ma.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var go,yo=1;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(go||(go={}));var vo=function(){function t(t,e){this.generatorId=t,Or((t&yo)===t,"Generator ID "+t+" contains more than "+yo+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<yo,t},t.prototype.after=function(t){return this.seek(t+(1<<yo)),this.next()},t.prototype.seek=function(t){Or((t&yo)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forTargetCache=function(){return new t(go.QueryCache,2)},t.forSyncEngine=function(){return new t(go.SyncEngine)},t}(),bo=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=vo.forTargetCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Pi.fromTimestamp(new Ri(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return To(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.saveTargetData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromTargetData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return wo(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return Or(e.targetCount>0,"Removing from an empty target cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return wo(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return Zi.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return wo(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return _o(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,za.getStore(n,Sa.store)).put(Sa.key,e);var n},t.prototype.saveTargetData=function(t,e){return wo(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return wo(t).iterate({range:i,index:Ta.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.target)&&(o=a,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Eo(t);return e.forEach(function(e){var a=Ni(e.path);i.push(o.put(new Ea(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),Zi.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Eo(t);return Zi.forEach(e,function(e){var o=Ni(e.path);return Zi.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Eo(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Eo(t),i=zi();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=ki(t[1]),o=new wi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Ni(e.path),r=IDBKeyRange.bound([n],[ai(n)],!1,!0),i=0;return Eo(t).iterate({index:Ea.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.getTargetDataForTarget=function(t,e){var n=this;return wo(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wo(t){return za.getStore(t,Ta.store)}function _o(t){return eo.getStore(t,Sa.store).get(Sa.key).next(function(t){return Or(null!==t,"Missing metadata row."),t})}function To(t){return _o(t).next(function(t){return t.highestListenSequenceNumber})}function Eo(t){return za.getStore(t,Ea.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var So,Io=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new Fi(bi.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),Co=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),Oo=function(){return function(t,e){this.version=t,this.transformResults=e}}();!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(So||(So={}));var No,Ao,Do=function(){function t(t,e){this.updateTime=t,this.exists=e,Or(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Zo&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Zo:(Or(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),ko=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&Or(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof Zo?t.version:Pi.MIN},t}(),Ro=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=So.Set,i}return Object(o.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Or(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Zo(this.key,n,{hasCommittedMutations:!0},this.value)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=ko.getPostMutationVersion(t);return new Zo(this.key,r,{hasLocalMutations:!0},this.value)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(ko),Po=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=So.Patch,o}return Object(o.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Or(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new ea(this.key,e.version);var n=this.patchDocument(t);return new Zo(this.key,e.version,{hasCommittedMutations:!0},n)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=ko.getPostMutationVersion(t),i=this.patchDocument(t);return new Zo(this.key,r,{hasLocalMutations:!0},i)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof Zo?t.data():Xo.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}}),t},e}(ko),Mo=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=So.Transform,r.precondition=Do.exists(!0),r}return Object(o.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Or(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new ea(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Zo(this.key,i,{hasCommittedMutations:!0},o)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Zo(this.key,r.version,{hasLocalMutations:!0},o)},e.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Zo?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Xo.EMPTY.set(i.field,a):e.set(i.field,a))}return e},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&oi(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){return Or(t instanceof Zo,"Unknown MaybeDocument type "+t),Or(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},e.prototype.serverTransformResults=function(t,e){var n=[];Or(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Zo&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Zo&&(u=e.field(a.field)),null===u&&n instanceof Zo&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},e.prototype.transformObject=function(t,e){Or(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(ko),Lo=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=So.Delete,r}return Object(o.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Or(null==e.transformResults,"Transform results received by DeleteMutation."),new ta(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Or(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new ta(this.key,Pi.forDeletedDoc())):t},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(ko);!function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}(No||(No={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(Ao||(Ao={}));var xo=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(Ao.Estimate,n);case"previous":return new t(Ao.Previous,n);case"none":case void 0:return new t(Ao.Default,n);default:return Cr("fromSnapshotOptions() called with invalid options.")}},t}(),jo=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return Or(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),ii(this.typeOrder,t.typeOrder)},t}(),Fo=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=No.NullValue,e.internalValue=null,e}return Object(o.c)(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(jo),Uo=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.BooleanValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?ii(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(jo),Vo=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.NumberValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue,r=t.internalValue,n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1):this.defaultCompareTo(t);var n,r},e}(jo);function qo(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Bo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.isEqual=function(t){return t instanceof e&&qo(this.internalValue,t.internalValue)},e}(Vo),Wo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.isEqual=function(t){return t instanceof e&&qo(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Vo),Ko=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.StringValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?ii(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(jo),Ho=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.TimestampValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof Qo?-1:this.defaultCompareTo(t)},e}(jo),Qo=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=No.TimestampValue,r}return Object(o.c)(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===Ao.Estimate?new Ho(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Ao.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Ho?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(jo),Go=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.BlobValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(jo),zo=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=No.RefValue,r}return Object(o.c)(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:wi.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(jo),Yo=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.GeoPointValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(jo),Xo=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.ObjectValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),a=ii(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return ii(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(Or(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(Or(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return null!==this.field(t)},e.prototype.field=function(t){Or(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e?n.internalValue.get(t):null}),n},e.prototype.fieldMask=function(){var t=new Fi(bi.comparator);return this.internalValue.forEach(function(n,r){var i=new bi([n]);if(r instanceof e){var o=r.fieldMask().fields;o.isEmpty()?t=t.add(i):o.forEach(function(e){t=t.add(i.child(e))})}else t=t.add(i)}),Io.fromSet(t)},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new Mi(ii)),e}(jo),Jo=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=No.ArrayValue,n}return Object(o.c)(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++){if(n[e].isEqual(t))return!0}return!1},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return ii(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},e}(jo),$o=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return wi.comparator(t.key,e.key)},t}(),Zo=function(t){function e(e,n,r,i,o,a){var s=t.call(this,e,n)||this;return s.objectValue=i,s.proto=o,s.converter=a,Or(void 0!==s.objectValue||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.hasLocalMutations=!!r.hasLocalMutations,s.hasCommittedMutations=!!r.hasCommittedMutations,s}return Object(o.c)(e,t),e.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},e.prototype.data=function(){var t=this;if(!this.objectValue){var e=Xo.EMPTY;xr(this.proto.fields||{},function(n,r){e=e.set(new bi([n]),t.converter(r))}),this.objectValue=e,this.fieldValueCache=void 0}return this.objectValue},e.prototype.value=function(){return this.data().value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.getProtoField=function(t){Or(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Cr("Trying to compare documents on fields that don't exist")},e}($o),ta=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(o.c)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}($o),ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}($o),na=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){xr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},t.prototype.isEmpty=function(){return jr(this.inner)},t}(),ra=function(){function t(){this.changes=new na(function(t){return t.toString()}),this.changesApplied=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return Or(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){Or(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},t.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Zi.resolve(n):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){Or(!this.changesApplied,"Changes have already been applied.")},t}(),ia=function(){function t(t,e){this.serializer=t,this.indexManager=e}return t.prototype.addEntry=function(t,e,n){return aa(t).put(sa(e),n)},t.prototype.removeEntry=function(t,e){var n=aa(t),r=sa(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return aa(t).get(sa(e)).next(function(t){return n.maybeDecodeDocument(t)})},t.prototype.getSizedEntry=function(t,e){var n=this;return aa(t).get(sa(e)).next(function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:ua(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Bi();return this.forEachDbEntry(t,e,function(t,e){var i=n.maybeDecodeDocument(e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=Bi(),i=new Mi(wi.comparator);return this.forEachDbEntry(t,e,function(t,e){var o=n.maybeDecodeDocument(e);o?(r=r.insert(t,o),i=i.insert(t,ua(e))):(r=r.insert(t,null),i=i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return Zi.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return aa(t).iterate({range:r},function(t,e,r){for(var a=wi.fromSegments(t);o&&wi.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this;Or(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var i=Ki(),o=e.path.length+1,a={};if(n.isEqual(Pi.MIN)){var s=e.path.toArray();a.range=IDBKeyRange.lowerBound(s)}else{var u=e.path.toArray(),c=this.serializer.toDbTimestampKey(n);a.range=IDBKeyRange.lowerBound([u,c],!0),a.index=wa.collectionReadTimeIndex}return aa(t).iterate(a,function(t,n,a){if(t.length===o){var s=r.serializer.fromDbRemoteDocument(n);e.path.isPrefixOf(s.key.path)?s instanceof Zo&&e.matches(s)&&(i=i.insert(s.key,s)):a.done()}}).next(function(){return i})},t.prototype.getNewDocumentChanges=function(t,e){var n=this,r=qi(),i=this.serializer.toDbTimestampKey(e),o=aa(t),a=IDBKeyRange.lowerBound(i,!0);return o.iterate({index:wa.readTimeIndex,range:a},function(t,e){var o=n.serializer.fromDbRemoteDocument(e);r=r.insert(o.key,o),i=e.readTime}).next(function(){return{changedDocs:r,readTime:n.serializer.fromDbTimestampKey(i)}})},t.prototype.getLastDocumentChange=function(t){var e,n=this,r=aa(t),i=Pi.MIN;return r.iterate({index:wa.readTimeIndex,reverse:!0},function(t,r,o){e=n.serializer.fromDbRemoteDocument(r),r.readTime&&(i=n.serializer.fromDbTimestampKey(r.readTime)),o.done()}).next(function(){return{changedDoc:e,readTime:i}})},t.prototype.newChangeBuffer=function(e){return new t.RemoteDocumentChangeBuffer(this,!!e&&e.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return oa(t).get(_a.key).next(function(t){return Or(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return oa(t).put(_a.key,e)},t.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof ta&&e.version.isEqual(Pi.forDeletedDoc())?null:e}return null},t.RemoteDocumentChangeBuffer=function(t){function e(e,n){var r=t.call(this)||this;return r.documentCache=e,r.trackRemovals=n,r.documentSizes=new na(function(t){return t.toString()}),r}return Object(o.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Fi(function(t,e){return ii(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,a){var s=e.documentSizes.get(o);if(Or(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){Or(!e.readTime.isEqual(Pi.MIN),"Cannot add a document with a read time of zero");var u=e.documentCache.serializer.toDbRemoteDocument(a,e.readTime);i=i.add(o.path.popLast());var c=ua(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else if(r-=s,e.trackRemovals){var h=e.documentCache.serializer.toDbRemoteDocument(new ta(o,Pi.forDeletedDoc()),e.readTime);n.push(e.documentCache.addEntry(t,o,h))}else n.push(e.documentCache.removeEntry(t,o))}),i.forEach(function(r){n.push(e.documentCache.indexManager.addToCollectionParentIndex(t,r))}),n.push(this.documentCache.updateMetadata(t,r)),Zi.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},e}(ra),t}();function oa(t){return za.getStore(t,_a.store)}function aa(t){return za.getStore(t,wa.store)}function sa(t){return t.path.toArray()}function ua(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Cr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ca=function(){function t(){this.collectionParentIndex=new ha}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Zi.resolve()},t.prototype.getCollectionParents=function(t,e){return Zi.resolve(this.collectionParentIndex.getEntries(e))},t}(),ha=function(){function t(){this.index={}}return t.prototype.add=function(t){Or(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Fi(yi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Fi(yi.comparator)).toArray()},t}(),la=9,fa=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Or(n<r&&n>=0&&r<=la,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new ro(e);n<1&&r>=1&&(function(t){t.createObjectStore(da.store)}(t),function(t){t.createObjectStore(ma.store,{keyPath:ma.keyPath}),t.createObjectStore(ga.store,{keyPath:ga.keyPath,autoIncrement:!0}).createIndex(ga.userMutationsIndex,ga.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ya.store)}(t),Ca(t),function(t){t.createObjectStore(wa.store)}(t));var a=Zi.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(Ea.store),t.deleteObjectStore(Ta.store),t.deleteObjectStore(Sa.store)}(t),Ca(t)),a=a.next(function(){return t=o.store(Sa.store),e=new Sa(0,0,Pi.MIN.toTimestamp(),0),t.put(Sa.key,e);var t,e})),n<4&&r>=4&&(0!==n&&(a=a.next(function(){return function(t,e){return e.store(ga.store).loadAll().next(function(n){t.deleteObjectStore(ga.store);var r=t.createObjectStore(ga.store,{keyPath:ga.keyPath,autoIncrement:!0});r.createIndex(ga.userMutationsIndex,ga.userMutationsKeyPath,{unique:!0});var i=e.store(ga.store),o=n.map(function(t){return i.put(t)});return Zi.waitFor(o)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore(Oa.store,{keyPath:Oa.keyPath})}(t)})),n<5&&r>=5&&(a=a.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&r>=6&&(a=a.next(function(){return function(t){t.createObjectStore(_a.store)}(t),i.addDocumentGlobal(o)})),n<7&&r>=7&&(a=a.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&r>=8&&(a=a.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&r>=9&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(wa.store);e.createIndex(wa.readTimeIndex,wa.readTimeIndexPath,{unique:!1}),e.createIndex(wa.collectionReadTimeIndex,wa.collectionReadTimeIndexPath,{unique:!1})}(e)})),a},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(wa.store).iterate(function(t,n){e+=ua(n)}).next(function(){var n=new _a(e);return t.store(_a.store).put(_a.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(ma.store),r=t.store(ga.store);return n.loadAll().next(function(n){return Zi.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(ga.userMutationsIndex,i).next(function(r){return Zi.forEach(r,function(r){Or(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return ho(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Ea.store),n=t.store(wa.store);return To(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new yi(n),a=function(t){return[0,Ni(t)]}(o);r.push(e.get(a).next(function(n){return n?Zi.resolve():function(n){return e.put(new Ea(0,Ni(n),t))}(o)}))}).next(function(){return Zi.waitFor(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Ia.store,{keyPath:Ia.keyPath});var n=e.store(Ia.store),r=new ha,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Ni(i)})}};return e.store(wa.store).iterate({keysOnly:!0},function(t,e){var n=new yi(t);return i(n.popLast())}).next(function(){return e.store(ya.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],ki(n));return i(r.popLast())})})},t}();var pa=function(){return function(t,e){this.seconds=t,this.nanoseconds=e}}(),da=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var ma=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),ga=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var ya=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ni(e)]},t.key=function(t,e,n){return[t,Ni(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var va=function(){return function(t,e){this.path=t,this.readTime=e}}(),ba=function(){return function(t,e){this.path=t,this.version=e}}(),wa=function(){function t(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}return t.store="remoteDocuments",t.readTimeIndex="readTimeIndex",t.readTimeIndexPath="readTime",t.collectionReadTimeIndex="collectionReadTimeIndex",t.collectionReadTimeIndexPath=["parentPath","readTime"],t}(),_a=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var Ta=function(){function t(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),Ea=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,Or(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),Sa=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),Ia=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function Ca(t){t.createObjectStore(Ea.store,{keyPath:Ea.keyPath}).createIndex(Ea.documentTargetsIndex,Ea.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ta.store,{keyPath:Ta.keyPath}).createIndex(Ta.queryTargetsIndexName,Ta.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Sa.store)}var Oa=function(){function t(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}return t.store="clientMetadata",t.keyPath="clientId",t}();var Na,Aa=[ma.store,ga.store,ya.store,wa.store,Ta.store,da.store,Sa.store,Ea.store],Da=Object(o.g)(Aa,[Oa.store]),ka=Object(o.g)(Da,[_a.store]),Ra=Object(o.g)(ka,[Ia.store]),Pa=function(){function t(){this.collectionParentsCache=new ha}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(Or(e.length%2==1,"Expected a collection path."),!this.collectionParentsCache.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.collectionParentsCache.add(e)});var o={collectionId:r,parent:Ni(i)};return Ma(t).put(o)}return Zi.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ai(e),""],!1,!0);return Ma(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ki(o.parent))}return n})},t}();function Ma(t){return za.getStore(t,Ia.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(Na||(Na={}));var La=function(){function t(t,e,n,r,i,o,a){void 0===i&&(i=Pi.MIN),void 0===o&&(o=Pi.MIN),void 0===a&&(a=Ar()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},t}(),xa=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=wi.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new ta(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=wi.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new ea(e,n)}return Cr("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof Zo){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new wa(null,null,i,o,n,r)}if(t instanceof ta){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);o=t.hasCommittedMutations;return new wa(null,new va(a,s),null,o,n,r)}if(t instanceof ea){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new wa(new ba(a,u),null,null,!0,n,r)}return Cr("Unexpected MaybeDocument")},t.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},t.prototype.fromDbTimestampKey=function(t){var e=new Ri(t[0],t[1]);return Pi.fromTimestamp(e)},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new pa(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Ri(t.seconds,t.nanoseconds);return Pi.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new ga(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Ri.fromMillis(t.localWriteTimeMs);return new Ji(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Ni(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=zi(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new wi(ki(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):Pi.MIN,i=t.resumeToken;return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new La(e,t.targetId,Na.Listen,t.lastListenSequenceNumber,n,r,i)},t.prototype.toDbTarget=function(t){Or(Na.Listen===t.purpose,"Only queries with purpose "+Na.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),t.resumeToken instanceof Uint8Array?(Or(eo.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new Ta(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ja(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=ii(n,i);return 0===a?ii(r,o):a}var Fa=function(){function t(t){this.maxElements=t,this.buffer=new Fi(ja),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ja(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Ua={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Va=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),qa=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}return t.prototype.start=function(){Or(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Va.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;Or(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Er("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(ci.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Ya)})},t}(),Ba=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Zi.resolve(mi.INVALID);var r=new Fa(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Va.COLLECTION_DISABLED?(Er("LruGarbageCollector","Garbage collection skipped; disabled"),Zi.resolve(Ua)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Er("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Ua):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Er("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){(u=Date.now(),_r()<=fr.DEBUG)&&Er("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms");return Zi.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Wa=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Ka="IndexedDbPersistence",Ha="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Qa="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Ga=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return Object(o.c)(e,t),e}(Wa),za=function(){function t(e,n,r,i,o,a,s,u){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.queue=a,this.sequenceNumberSyncer=u,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new $a(this,o),this.dbName=n+t.MAIN_DATABASE,this.serializer=new xa(s),this.document=i.document,this.targetCache=new bo(this.referenceDelegate,this.serializer),this.indexManager=new Pa,this.remoteDocumentCache=new ia(this.serializer,this.indexManager),!i.window||!i.window.localStorage)throw new kr(Dr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=i.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof Ga)return eo.getStore(t.simpleDbTransaction,e);throw Cr("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e){return Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:if(!t.isAvailable())throw new kr(Dr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(n=new t(e.allowTabSynchronization,e.persistenceKey,e.clientId,e.platform,e.lruParams,e.queue,e.serializer,e.sequenceNumberSyncer)).start()];case 1:return r.sent(),[2,n]}})})},t.prototype.start=function(){var t=this;return Or(!this.started,"IndexedDbPersistence double-started!"),Or(null!==this.window,"Expected 'window' to be defined"),eo.openOrCreate(this.dbName,la,new fa(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.simpleDb.runTransaction("readonly-idempotent",[Sa.store],function(t){return To(t)})}).then(function(e){t.listenSequence=new mi(e,t.sequenceNumberSyncer)}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return Object(o.b)(e,void 0,void 0,function(){return Object(o.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener(function(n){return Object(o.b)(e,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return Object(o.b)(e,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite-idempotent",Ra,function(e){return Ja(e).put(new Oa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){return t.isPrimary&&!n?t.releasePrimaryLeaseIfHeld(e).next(function(){return!1}):!!n&&t.acquireOrExtendPrimaryLease(e).next(function(){return!0})})}).catch(function(e){if(!t.allowTabSynchronization)throw e;return Er(Ka,"Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(e)}),t.isPrimary=e})},t.prototype.verifyPrimaryLease=function(t){var e=this;return Xa(t).get(da.key).next(function(t){return Zi.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return Ja(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return Object(o.b)(this,void 0,void 0,function(){var e=this;return Object(o.d)(this,function(n){switch(n.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(n){var r=t.getStore(n,Oa.store);return r.loadAll().next(function(t){var n=e.filterActiveClients(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Zi.forEach(i,function(t){return r.delete(t.clientId)}).next(function(){return i})})})]);case 1:n.sent().forEach(function(t){e.window.localStorage.removeItem(e.zombiedClientLocalStorageKey(t.clientId))}),n.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(ci.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return Xa(t).get(da.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new kr(Dr.FAILED_PRECONDITION,Qa);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ja(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&Er(Ka,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(o.b)(this,void 0,void 0,function(){var t=this;return Object(o.d)(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[da.store,Oa.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly-idempotent",[Oa.store],function(e){return Ja(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},t.clearPersistence=function(e){return Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:return t.isAvailable()?(n=e+t.MAIN_DATABASE,[4,eo.delete(n)]):[2,Promise.resolve()];case 1:return r.sent(),[2]}})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return Or(this.started,"Cannot initialize MutationQueue before persistence is started."),uo.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getTargetCache=function(){return Or(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},t.prototype.getRemoteDocumentCache=function(){return Or(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return Or(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;Er(Ka,"Starting transaction:",t);var i,o=e.endsWith("idempotent"),a=e.startsWith("readonly")?o?"readonly-idempotent":"readonly":o?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,Ra,function(o){return i=new Ga(o,r.listenSequence.next()),"readwrite-primary"===e||"readwrite-primary-idempotent"===e?r.verifyPrimaryLease(o).next(function(t){return!!t||r.canActAsPrimary(o)}).next(function(e){if(!e)throw Sr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new kr(Dr.FAILED_PRECONDITION,Ha);return n(i)}).next(function(t){return r.acquireOrExtendPrimaryLease(o).next(function(){return t})}):r.verifyAllowTabSynchronization(o).next(function(){return n(i)})}).then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Xa(t).get(da.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new kr(Dr.FAILED_PRECONDITION,Qa)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new da(this.clientId,this.allowTabSynchronization,Date.now());return Xa(t).put(da.key,e)},t.isAvailable=function(){return eo.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Xa(t);return n.get(da.key).next(function(t){return e.isLocalClient(t)?(Er(Ka,"Releasing primary lease."),n.delete(da.key)):Zi.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(t>n)||(Sr("Detected an update time that is in the future: "+t+" > "+n),!1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Or(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Or("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Er(Ka,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Sr(Ka,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Sr("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Ya(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){if(!function(t){return t.code===Dr.FAILED_PRECONDITION&&t.message===Ha}(t))throw t;return Er(Ka,"Unexpectedly lost primary lease"),[2]})})}function Xa(t){return t.store(da.store)}function Ja(t){return t.store(Oa.store)}var $a=function(){function t(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new Ba(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Za(t,e)},t.prototype.removeReference=function(t,e){return Za(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Za(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Zi.resolve(!0):function(t,e){var n=!1;return mo(t).iterateSerial(function(r){return co(t,r,e).next(function(t){return t&&(n=!0),Zi.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return o++,r.getEntry(t,a).next(function(){return r.removeEntry(a),Eo(t).delete([0,Ni(a.path)])})});i.push(u)}}).next(function(){return Zi.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Za(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=Eo(t),i=mi.INVALID;return r.iterate({index:Ea.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==mi.INVALID&&e(new wi(ki(n)),i),i=s,n=a):i=mi.INVALID}).next(function(){i!==mi.INVALID&&e(new wi(ki(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Za(t,e){return Eo(t).put(function(t,e){return new Ea(0,Ni(t.path),e)}(e,t.currentSequenceNumber))}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ts=Number,es=ts.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),ns=ts.MAX_SAFE_INTEGER||Math.pow(2,53)-1,rs=ts.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function is(t){return null==t}function os(t){return rs(t)&&t<=ns&&t>=es}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var as,ss=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}return t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}is(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),is(this.limit)||(t+=", limit: "+this.limit),this.orderBy.length>0&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},t.prototype.isDocumentQuery=function(){return wi.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.First="F",t.Last="L"}(as||(as={}));var us=function(){function t(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=as.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[ws]:this.memoizedOrderBy=[new bs(t),ws];else{Or(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:ys.ASCENDING;this.memoizedOrderBy.push(a===ys.ASCENDING?ws:_s)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){Or(null==this.getInequalityFilterField()||!(e instanceof ls)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Or(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){Or(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.withLimitToFirst=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,as.First,this.startAt,this.endAt)},t.prototype.withLimitToLast=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,as.Last,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},t.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},t.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},t.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Or(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimitToFirst=function(){return!is(this.limit)&&this.limitType===as.First},t.prototype.hasLimitToLast=function(){return!is(this.limit)&&this.limitType===as.Last},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof ls&&n.isInequality())return n.field}return null},t.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof ls&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===as.First)this.memoizedTarget=new ss(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===ys.DESCENDING?ys.ASCENDING:ys.DESCENDING;t.push(new bs(r.field,i))}var o=this.endAt?new vs(this.endAt.position,!this.endAt.before):null,a=this.startAt?new vs(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new ss(this.path,this.collectionGroup,t,this.filters,this.limit,o,a)}return this.memoizedTarget},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):wi.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){Or(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),cs=function(){return function(){}}(),hs=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return Cr("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),ls=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return Object(o.c)(e,t),e.create=function(t,n,r){if(t.isKeyField())return n===hs.IN?(Or(r instanceof Jo,"Comparing on key with IN, but filter value not an ArrayValue"),Or(r.internalValue.every(function(t){return t instanceof zo}),"Comparing on key with IN, but an array value was not a RefValue"),new ps(t,r)):(Or(r instanceof zo,"Comparing on key, but filter value not a RefValue"),Or(n!==hs.ARRAY_CONTAINS&&n!==hs.ARRAY_CONTAINS_ANY,"'"+n.toString()+"' queries don't make sense on document keys."),new fs(t,n,r));if(r.isEqual(Fo.INSTANCE)){if(n!==hs.EQUAL)throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(r.isEqual(Wo.NAN)){if(n!==hs.EQUAL)throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return n===hs.ARRAY_CONTAINS?new ds(t,r):n===hs.IN?(Or(r instanceof Jo,"IN filter has invalid value: "+r.toString()),new ms(t,r)):n===hs.ARRAY_CONTAINS_ANY?(Or(r instanceof Jo,"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new gs(t,r)):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case hs.LESS_THAN:return t<0;case hs.LESS_THAN_OR_EQUAL:return t<=0;case hs.EQUAL:return 0===t;case hs.GREATER_THAN:return t>0;case hs.GREATER_THAN_OR_EQUAL:return t>=0;default:return Cr("Unknown FieldFilter operator: "+this.op)}},e.prototype.isInequality=function(){return[hs.LESS_THAN,hs.LESS_THAN_OR_EQUAL,hs.GREATER_THAN,hs.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(cs),fs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.matches=function(t){var e=this.value,n=wi.comparator(t.key,e.key);return this.matchesComparison(n)},e}(ls),ps=function(t){function e(e,n){var r=t.call(this,e,hs.IN,n)||this;return r.value=n,r}return Object(o.c)(e,t),e.prototype.matches=function(t){return this.value.internalValue.some(function(e){return t.key.isEqual(e.key)})},e}(ls),ds=function(t){function e(e,n){return t.call(this,e,hs.ARRAY_CONTAINS,n)||this}return Object(o.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Jo&&e.contains(this.value)},e}(ls),ms=function(t){function e(e,n){var r=t.call(this,e,hs.IN,n)||this;return r.value=n,r}return Object(o.c)(e,t),e.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},e}(ls),gs=function(t){function e(e,n){var r=t.call(this,e,hs.ARRAY_CONTAINS_ANY,n)||this;return r.value=n,r}return Object(o.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Jo&&n.internalValue.some(function(t){return e.value.contains(t)})},e}(ls),ys=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),vs=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){Or(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Or(o instanceof zo,"Bound has a non-key value where the key path is being used."),n=wi.comparator(o.key,e.key);else{var a=e.field(i.field);Or(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===ys.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),bs=function(){function t(t,e){this.field=t,void 0===e&&(e=ys.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Zo.compareByKey(t,e):Zo.compareByField(this.field,t,e);switch(this.dir){case ys.ASCENDING:return n;case ys.DESCENDING:return-1*n;default:return Cr("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),ws=new bs(bi.keyField(),ys.ASCENDING),_s=new bs(bi.keyField(),ys.DESCENDING),Ts=function(){function t(){}return t.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return Or(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),e.matchesAllDocuments()?this.executeFullCollectionScan(t,e):n.isEqual(Pi.MIN)?this.executeFullCollectionScan(t,e):this.localDocumentsView.getDocuments(t,r).next(function(o){var a=i.applyQuery(e,o);return(e.hasLimitToFirst()||e.hasLimitToLast())&&i.needsRefill(e.limitType,a,r,n)?i.executeFullCollectionScan(t,e):(_r()<=fr.DEBUG&&Er("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),e.toString()),i.localDocumentsView.getDocumentsMatchingQuery(t,e,n).next(function(t){return a.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.applyQuery=function(t,e){var n=new Fi(function(e,n){return t.docComparator(e,n)});return e.forEach(function(e,r){r instanceof Zo&&t.matches(r)&&(n=n.add(r))}),n},t.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===as.First?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.executeFullCollectionScan=function(t,e){return _r()<=fr.DEBUG&&Er("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,e,Pi.MIN)},t}(),Es=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++){t=i[r].applyToLocalView(e,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Bi();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++){e=o[i].applyToLocalView(t,e)}r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=qi();return i.forEach(function(t,e){e||(e=new ta(t,Pi.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new wi(e)).next(function(t){var e=Ki();return t instanceof Zo&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e,n){var r=this;Or(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var i=e.collectionGroup,o=Ki();return this.indexManager.getCollectionParents(t,i).next(function(a){return Zi.forEach(a,function(a){var s=e.asCollectionQueryAtPath(a.child(i));return r.getDocumentsMatchingCollectionQuery(t,s,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e,n){var r,i,o=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return i=e,o.addMissingBaseDocuments(t,i,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=r.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);r=l instanceof Zo?r.insert(c,l):r.remove(c)}})}).next(function(){return r.forEach(function(t,n){e.matches(n)||(r=r.remove(t))}),r})},t.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=zi(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Po&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Zo&&(c=c.insert(t,e))}),c})},t}(),Ss=function(){function t(){this.refsByKey=new Fi(Is.compareByKey),this.refsByTarget=new Fi(Is.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new Is(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new Is(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=wi.EMPTY,r=new Is(n,t),i=new Is(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=wi.EMPTY,n=new Is(e,t),r=new Is(e,t+1),i=zi();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Is(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Is=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return wi.comparator(t.key,e.key)||ii(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return ii(t.targetOrBatchId,e.targetOrBatchId)||wi.comparator(t.key,e.key)},t}(),Cs=function(){function t(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new Ss,this.targetDataByTarget=new Mi(ii),this.targetIdByTarget=new na(function(t){return t.canonicalId()}),this.lastDocumentChangeReadTime=Pi.MIN,Or(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new Es(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}return t.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},t.prototype.handleUserChange=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,r,i=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return e=this.mutationQueue,n=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(r){var o;return i.mutationQueue.getAllMutationBatches(r).next(function(a){return o=a,e=i.persistence.getMutationQueue(t),n=new Es(i.remoteDocuments,e,i.persistence.getIndexManager()),e.getAllMutationBatches(r)}).next(function(t){for(var e=[],i=[],a=zi(),s=0,u=o;s<u.length;s++){var c=u[s];e.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p];i.push(c.batchId);for(var m=0,g=c.mutations;m<g.length;m++){f=g[m];a=a.add(f.key)}}return n.getDocuments(r,a).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:i}})})})];case 1:return r=o.sent(),this.mutationQueue=e,this.localDocuments=n,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,r]}})})},t.prototype.localWrite=function(t){var e,n=this,r=Ri.now(),i=t.reduce(function(t,e){return t.add(e.key)},zi());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(o){return n.localDocuments.getDocuments(o,i).next(function(i){e=i;for(var a=[],s=0,u=t;s<u.length;s++){var c=u[s],h=c.extractBaseValue(e.get(c.key));null!=h&&a.push(new Po(c.key,h,h.fieldMask(),Do.exists(!0)))}return n.mutationQueue.addMutationBatch(o,r,a,t)})}).then(function(t){var n=t.applyToLocalDocumentSet(e);return{batchId:t.batchId,changes:n}})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):Zi.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer({trackRemovals:!0});return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return Or(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=e.snapshotVersion,i=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var a=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=n.targetDataByTarget;var s=[];Lr(e.targetChanges,function(e,a){var u=i.get(e);if(u){s.push(n.targetCache.removeMatchingKeys(o,a.removedDocuments,e).next(function(){return n.targetCache.addMatchingKeys(o,a.addedDocuments,e)}));var c=a.resumeToken;if(c.length>0){var h=u.withResumeToken(c,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(e,h),t.shouldPersistTargetData(u,h,a)&&s.push(n.targetCache.updateTargetData(o,h))}}});var u=qi(),c=zi();if(e.documentUpdates.forEach(function(t,e){c=c.add(t)}),s.push(a.getEntries(o,c).next(function(t){e.documentUpdates.forEach(function(i,c){var h=t.get(i);c instanceof ta&&c.version.isEqual(Pi.MIN)?(a.removeEntry(i,r),u=u.insert(i,c)):null==h||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(Or(!Pi.MIN.isEqual(r),"Cannot add a document when the remote version is zero"),a.addEntry(c,r),u=u.insert(i,c)):Er("LocalStore","Ignoring outdated watch update for ",i,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(i)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(o,i))})})),!r.isEqual(Pi.MIN)){var h=n.targetCache.getLastRemoteSnapshotVersion(o).next(function(t){return Or(r.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+r+" < "+t),n.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,r)});s.push(h)}return Zi.waitFor(s).next(function(){return a.apply(o)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(o,u)})}).then(function(t){return n.targetDataByTarget=i,t})},t.shouldPersistTargetData=function(t,e,n){return Or(e.resumeToken.length>0,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)},t.prototype.notifyLocalViewChanges=function(t){for(var e=this,n=0,r=t;n<r.length;n++){var i=r[n],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);Or(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(n){return Zi.forEach(t,function(t){return Zi.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateTarget=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(n){var r;return e.targetCache.getTargetData(n,t).next(function(i){return i?(r=i,Zi.resolve(r)):e.targetCache.allocateTargetId(n).next(function(i){return r=new La(t,i,Na.Listen,n.currentSequenceNumber),e.targetCache.addTargetData(n,r).next(function(){return r})})})}).then(function(n){return null===e.targetDataByTarget.get(n.targetId)&&(e.targetDataByTarget=e.targetDataByTarget.insert(n.targetId,n),e.targetIdByTarget.set(t,n.targetId)),n})},t.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?Zi.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},t.prototype.releaseTarget=function(t,e){var n=this,r=this.targetDataByTarget.get(t);Or(null!==r,"Tried to release nonexistent target: "+t);var i=e?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",i,function(i){var o=n.localViewReferences.removeReferencesForId(t);return e?Zi.resolve():Zi.forEach(o,function(t){return n.persistence.referenceDelegate.removeReference(i,t)}).next(function(){n.persistence.referenceDelegate.removeTarget(i,r)})}).then(function(){n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(r.target)})},t.prototype.executeQuery=function(t,e){var n=this,r=Pi.MIN,i=zi();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(o){return n.getTargetData(o,t.toTarget()).next(function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(o,t.targetId).next(function(t){i=t})}).next(function(){return n.queryEngine.getDocumentsMatchingQuery(o,t,e?r:Pi.MIN,e?i:zi())}).next(function(t){return{documents:t,remoteKeys:i}})})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(n){return e.targetCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=Zi.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);Or(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o,e.commitVersion):Or(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(n){return t.collect(n,e.targetDataByTarget)})},t.prototype.getTarget=function(t){var e=this,n=this.targetDataByTarget.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(n){return e.targetCache.getTargetDataForTarget(n,t).next(function(t){return t?t.target:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(e){return t.remoteDocuments.getNewDocumentChanges(e,t.lastDocumentChangeReadTime)}).then(function(e){var n=e.changedDocs,r=e.readTime;return t.lastDocumentChangeReadTime=r,n})},t.prototype.synchronizeLastDocumentChangeReadTime=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e=this;return Object(o.d)(this,function(n){return this.remoteDocuments instanceof ia?(t=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(e){return t.getLastDocumentChange(e)}).then(function(t){var n=t.readTime;e.lastDocumentChangeReadTime=n})]):[2]})})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),Os=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Ar(),this.batchesByDocumentKey=new Fi(Is.compareByKey)}return t.prototype.checkEmpty=function(t){return Zi.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Or(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Or(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Zi.resolve()},t.prototype.getLastStreamToken=function(t){return Zi.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Zi.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){Or(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,this.mutationQueue.length>0)&&Or(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Ji(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Is(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Zi.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Zi.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Or(null!=n,"Failed to find local mutation batch."),Zi.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Zi.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Zi.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},t.prototype.getAllMutationBatches=function(t){return Zi.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Is(e,0),i=new Is(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){Or(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Or(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),Zi.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Fi(ii);return e.forEach(function(t){var e=new Is(t,0),i=new Is(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){Or(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),Zi.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Or(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;wi.isDocumentKey(i)||(i=i.child(""));var o=new Is(new wi(i),0),a=new Fi(ii);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Zi.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Or(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return Zi.forEach(e.mutations,function(i){var o=new Is(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new Is(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Zi.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Or(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Zi.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Or(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Or(n.batchId===t,"If found batch must match"),n},t}();var Ns,As=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new Mi(wi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){Or(!n.isEqual(Pi.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Zi.resolve(n?n.maybeDocument:null)},t.prototype.getEntries=function(t,e){var n=this,r=Bi();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Zi.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){Or(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=Ki(),i=new wi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof Zo&&e.matches(c)&&(r=r.insert(c.key,c))}return Zi.resolve(r)},t.prototype.forEachDocumentKey=function(t,e){return Zi.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},t.prototype.newChangeBuffer=function(e){return new t.RemoteDocumentChangeBuffer(this)},t.prototype.getSize=function(t){return Zi.resolve(this.size)},t.RemoteDocumentChangeBuffer=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return Object(o.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i?n.push(e.documentCache.addEntry(t,i,e.readTime)):e.documentCache.removeEntry(r)}),Zi.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},e}(ra),t}(),Ds=function(){function t(t){this.persistence=t,this.targets=new na(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Pi.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Ss,this.targetCount=0,this.targetIdGenerator=vo.forTargetCache()}return t.prototype.forEachTarget=function(t,e){return this.targets.forEach(function(t,n){return e(n)}),Zi.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Zi.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Zi.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Zi.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Zi.resolve()},t.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return Or(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,Zi.resolve()},t.prototype.updateTargetData=function(t,e){return Or(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),Zi.resolve()},t.prototype.removeTargetData=function(t,e){return Or(this.targetCount>0,"Removing a target from an empty cache"),Or(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Zi.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.targets.forEach(function(a,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.targets.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),Zi.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Zi.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return Zi.resolve(n)},t.prototype.getTargetDataForTarget=function(t,e){return Cr("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),Zi.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),Zi.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Zi.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Zi.resolve(n)},t.prototype.containsKey=function(t,e){return Zi.resolve(this.references.containsKey(e))},t}(),ks=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new mi(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new Ds(this);this.indexManager=new ca,this.remoteDocumentCache=new As(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new Ms(t,new xa(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new Ps(t)})},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Os(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.targetCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;Er("MemoryPersistence","Starting transaction:",t);var i=new Rs(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.mutationQueuesContainKey=function(t,e){return Zi.or((n=this.mutationQueues,r=[],xr(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),Rs=function(t){function e(e){var n=t.call(this)||this;return n.currentSequenceNumber=e,n}return Object(o.c)(e,t),e}(Wa),Ps=function(){function t(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}return Object.defineProperty(t.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Cr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Zi.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Zi.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Zi.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Zi.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(t){t||n.removeEntry(r)})}).next(function(){return e._orphanedDocuments=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return Zi.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Zi.resolve(n.inMemoryPins.containsKey(e))}])},t}(),Ms=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new na(function(t){return Ni(t.path)}),this.garbageCollector=new Ba(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return Zi.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return Zi.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?Zi.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,function(i){return n.isPinned(t,i,e).next(function(t){t||(r++,o.removeEntry(i))})}).next(function(){return o.apply(t)}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Zi.resolve()},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Zi.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Zi.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Zi.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Cr("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return Zi.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Zi.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Zi.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),Ls=1e3,xs=1.5,js=6e4,Fs=function(){function t(t,e,n,r,i){void 0===n&&(n=Ls),void 0===r&&(r=xs),void 0===i&&(i=js),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&Er("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}(Ns||(Ns={}));var Us,Vs,qs=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Ns.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Fs(t,e)}return t.prototype.isStarted=function(){return this.state===Ns.Starting||this.state===Ns.Open||this.state===Ns.Backoff},t.prototype.isOpen=function(){return this.state===Ns.Open},t.prototype.start=function(){this.state!==Ns.Error?(Or(this.state===Ns.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Ns.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){Or(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Ns.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){return this.isOpen()?[2,this.close(Ns.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(n){switch(n.label){case 0:return Or(this.isStarted(),"Only started streams should be closed."),Or(t===Ns.Error||is(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==Ns.Error?this.backoff.reset():e&&e.code===Dr.RESOURCE_EXHAUSTED?(Sr(e.toString()),Sr("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Dr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;Or(this.state===Ns.Initial,"Must be in initial state to auth"),this.state=Ns.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new kr(Dr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;Or(this.state===Ns.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Or(e.state===Ns.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Ns.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;Or(this.state===Ns.Error,"Should only perform backoff when in Error state"),this.state=Ns.Backoff,this.backoff.backoffAndRun(function(){return Object(o.b)(t,void 0,void 0,function(){return Object(o.d)(this,function(t){return Or(this.state===Ns.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Ns.Initial,this.start(),Or(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return Or(this.isStarted(),"Can't handle server close on non-started stream"),Er("PersistentStream","close with error: "+t),this.stream=null,this.close(Ns.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(Er("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Bs=function(t){function e(e,n,r,i,o){var a=t.call(this,e,ci.ListenStreamConnectionBackoff,ci.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return Object(o.c)(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(qs),Ws=function(t){function e(e,n,r,i,o){var a=t.call(this,e,ci.WriteStreamConnectionBackoff,ci.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a.lastStreamToken=Ar(),a}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(Or(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Or(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){Or(this.isOpen(),"Writing handshake requires an opened stream"),Or(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;Or(this.isOpen(),"Writing mutations requires an opened stream"),Or(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Or(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(qs),Ks=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Ws(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Bs(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=qi();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);Or(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Dr.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Dr.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),Hs=function(){function t(t){this.datastore=t,this.readVersions=Qi(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n=this;return Object(o.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new kr(Dr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach(function(t){t instanceof ta||t instanceof Zo?n.recordVersion(t):Cr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new Lo(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){return Object(o.b)(this,void 0,void 0,function(){var t;return Object(o.d)(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach(function(e){t=t.remove(e.key)}),!t.isEmpty())throw new kr(Dr.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t instanceof Zo)e=t.version;else{if(!(t instanceof ta))throw Cr("Document in a transaction was a "+t.constructor.name);e=Pi.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new kr(Dr.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Do.updateTime(e):Do.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(!this.writtenDocs.has(t)&&e){if(e.isEqual(Pi.forDeletedDoc()))throw new kr(Dr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Do.updateTime(e)}return Do.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){Or(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(Us||(Us={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(Vs||(Vs={}));
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Qs,Gs=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Us.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Us.Unknown),Or(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(ci.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Or(t.state===Us.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Us.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Us.Online?(this.setAndBroadcast(Us.Unknown),Or(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Or(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Us.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Us.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Sr(e),this.shouldWarnClientIsOffline=!1):Er("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}();function zs(t){switch(t){case Dr.OK:return Cr("Treated status OK as error");case Dr.CANCELLED:case Dr.UNKNOWN:case Dr.DEADLINE_EXCEEDED:case Dr.RESOURCE_EXHAUSTED:case Dr.INTERNAL:case Dr.UNAVAILABLE:case Dr.UNAUTHENTICATED:return!1;case Dr.INVALID_ARGUMENT:case Dr.NOT_FOUND:case Dr.ALREADY_EXISTS:case Dr.PERMISSION_DENIED:case Dr.FAILED_PRECONDITION:case Dr.ABORTED:case Dr.OUT_OF_RANGE:case Dr.UNIMPLEMENTED:case Dr.DATA_LOSS:return!0;default:return Cr("Unknown status code: "+t)}}function Ys(t){if(void 0===t)return Sr("GRPC error has no .code"),Dr.UNKNOWN;switch(t){case Qs.OK:return Dr.OK;case Qs.CANCELLED:return Dr.CANCELLED;case Qs.UNKNOWN:return Dr.UNKNOWN;case Qs.DEADLINE_EXCEEDED:return Dr.DEADLINE_EXCEEDED;case Qs.RESOURCE_EXHAUSTED:return Dr.RESOURCE_EXHAUSTED;case Qs.INTERNAL:return Dr.INTERNAL;case Qs.UNAVAILABLE:return Dr.UNAVAILABLE;case Qs.UNAUTHENTICATED:return Dr.UNAUTHENTICATED;case Qs.INVALID_ARGUMENT:return Dr.INVALID_ARGUMENT;case Qs.NOT_FOUND:return Dr.NOT_FOUND;case Qs.ALREADY_EXISTS:return Dr.ALREADY_EXISTS;case Qs.PERMISSION_DENIED:return Dr.PERMISSION_DENIED;case Qs.FAILED_PRECONDITION:return Dr.FAILED_PRECONDITION;case Qs.ABORTED:return Dr.ABORTED;case Qs.OUT_OF_RANGE:return Dr.OUT_OF_RANGE;case Qs.UNIMPLEMENTED:return Dr.UNIMPLEMENTED;case Qs.DATA_LOSS:return Dr.DATA_LOSS;default:return Cr("Unknown status code: "+t)}}function Xs(t){if(void 0===t)return Qs.OK;switch(t){case Dr.OK:return Qs.OK;case Dr.CANCELLED:return Qs.CANCELLED;case Dr.UNKNOWN:return Qs.UNKNOWN;case Dr.DEADLINE_EXCEEDED:return Qs.DEADLINE_EXCEEDED;case Dr.RESOURCE_EXHAUSTED:return Qs.RESOURCE_EXHAUSTED;case Dr.INTERNAL:return Qs.INTERNAL;case Dr.UNAVAILABLE:return Qs.UNAVAILABLE;case Dr.UNAUTHENTICATED:return Qs.UNAUTHENTICATED;case Dr.INVALID_ARGUMENT:return Qs.INVALID_ARGUMENT;case Dr.NOT_FOUND:return Qs.NOT_FOUND;case Dr.ALREADY_EXISTS:return Qs.ALREADY_EXISTS;case Dr.PERMISSION_DENIED:return Qs.PERMISSION_DENIED;case Dr.FAILED_PRECONDITION:return Qs.FAILED_PRECONDITION;case Dr.ABORTED:return Qs.ABORTED;case Dr.OUT_OF_RANGE:return Qs.OUT_OF_RANGE;case Dr.UNIMPLEMENTED:return Qs.UNIMPLEMENTED;case Dr.DATA_LOSS:return Qs.DATA_LOSS;default:return Cr("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(Qs||(Qs={}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Js,$s,Zs=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||wi.comparator(e.key,n.key)}:function(t,e){return wi.comparator(t.key,e.key)},this.keyedMap=Ki(),this.sortedSet=new Mi(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(Js||(Js={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}($s||($s={}));var tu,eu=function(){function t(){this.changeMap=new Mi(wi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Js.Added&&n.type===Js.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Js.Metadata&&n.type!==Js.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Js.Modified&&n.type===Js.Modified?this.changeMap=this.changeMap.insert(e,{type:Js.Modified,doc:t.doc}):t.type===Js.Modified&&n.type===Js.Added?this.changeMap=this.changeMap.insert(e,{type:Js.Added,doc:t.doc}):t.type===Js.Removed&&n.type===Js.Added?this.changeMap=this.changeMap.remove(e):t.type===Js.Removed&&n.type===Js.Modified?this.changeMap=this.changeMap.insert(e,{type:Js.Removed,doc:n.doc}):t.type===Js.Added&&n.type===Js.Removed?this.changeMap=this.changeMap.insert(e,{type:Js.Modified,doc:t.doc}):Cr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),nu=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:Js.Added,doc:t})}),new t(e,n,Zs.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),ru=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=iu.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(Pi.MIN,i,Xi(),qi(),zi())},t}(),iu=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Ar(),n,zi(),zi(),zi())},t}(),ou=function(){return function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r}}(),au=function(){return function(t,e){this.targetId=t,this.existenceFilter=e}}();!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(tu||(tu={}));var su=function(){return function(t,e,n,r){void 0===n&&(n=Ar()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}(),uu=function(){function t(){this.pendingResponses=0,this.documentChanges=lu(),this._resumeToken=Ar(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=zi(),e=zi(),n=zi();return this.documentChanges.forEach(function(r,i){switch(i){case Js.Added:t=t.add(r);break;case Js.Modified:e=e.add(r);break;case Js.Removed:n=n.add(r);break;default:Cr("Encountered invalid change type: "+i)}}),new iu(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=lu()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),cu=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=qi(),this.pendingDocumentTargetMapping=hu(),this.pendingTargetResets=new Fi(ii)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Zo?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof ta&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case tu.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case tu.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case tu.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Or(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case tu.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case tu.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Cr("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):Lr(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new wi(i.path);this.removeDocumentFromTarget(e,o,new ta(o,Pi.forDeletedDoc()))}else Or(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};Lr(this.targetStates,function(r,i){var o=e.targetDataForActiveTarget(r);if(o){if(i.current&&o.target.isDocumentQuery()){var a=new wi(o.target.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new ta(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=zi();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.targetDataForActiveTarget(t);return!n||n.purpose===Na.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new ru(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=qi(),this.pendingDocumentTargetMapping=hu(),this.pendingTargetResets=new Fi(ii),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Js.Modified:Js.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Js.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new uu),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Fi(ii),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||Er("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;Or(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new uu,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function hu(){return new Mi(wi.comparator)}function lu(){return new Mi(wi.comparator)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fu="RemoteStore",pu=function(){function t(t,e,n,r,i){var a=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return Object(o.b)(a,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Er(fu,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new Gs(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return Object(o.b)(this,void 0,void 0,function(){var t;return Object(o.d)(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Us.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Us.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(Er(fu,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return Er(fu,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(Us.Unknown),[2]}})})},t.prototype.listen=function(t){Pr(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},t.prototype.unlisten=function(t){Or(Pr(this.listenTargets,t),"unlisten called on target no currently watched: "+t),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),jr(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Us.Unknown))},t.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){Or(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new cu(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!jr(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return Object(o.b)(this,void 0,void 0,function(){var t=this;return Object(o.d)(this,function(e){return Lr(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){return void 0===t&&Or(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(Us.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(Us.Online),t instanceof su&&t.state===tu.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof ou?this.watchChangeAggregator.handleDocumentChange(t):t instanceof au?this.watchChangeAggregator.handleExistenceFilter(t):(Or(t instanceof su,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Pi.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;Or(!t.isEqual(Pi.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return Lr(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.withResumeToken(r.resumeToken,t))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.withResumeToken(Ar(),n.snapshotVersion),e.sendUnwatchRequest(t);var r=new La(n.target,t,Na.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;Or(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return Object(o.b)(e,void 0,void 0,function(){return Object(o.d)(this,function(e){return Pr(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e;return Object(o.d)(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){Or(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){Or(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(Ya)},t.prototype.onMutationResult=function(t,e){var n=this;Or(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=$i.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return Object(o.b)(this,void 0,void 0,function(){var e=this;return Object(o.d)(this,function(n){return void 0===t&&Or(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){return zs(t.code)?(Er(fu,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Ar(),[2,this.localStore.setLastStreamToken(Ar()).catch(Ya)]):[2]})})},t.prototype.handleWriteError=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n=this;return Object(o.d)(this,function(r){return zs(i=t.code)&&i!==Dr.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var i})})},t.prototype.createTransaction=function(){return new Hs(this.datastore)},t.prototype.restartNetwork=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Us.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},t.prototype.handleCredentialChange=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Er(fu,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.applyPrimaryState=function(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(Us.Unknown),e.label=4;case 4:return[2]}})})},t}(),du=function(){function t(t,e){if(Ur("GeoPoint",arguments,2),Br("GeoPoint","number",1,t),Br("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new kr(Dr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new kr(Dr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return ii(this._lat,t._lat)||ii(this._long,t._long)},t}(),mu=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new Qo(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),gu=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=bu(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new Jo(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&oi(e.elements,this.elements)},t}(),yu=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=bu(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new Jo(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&oi(e.elements,this.elements)},t}(),vu=function(){function t(t){this.operand=t}return t.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Bo&&this.operand instanceof Bo){var r=n.internalValue+this.operand.internalValue;return new Bo(r)}r=n.internalValue+this.operand.internalValue;return new Wo(r)},t.prototype.applyToRemoteDocument=function(t,e){return Or(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.computeBaseValue=function(t){return t instanceof Vo?t:new Bo(0)},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function bu(t){return t instanceof Jo?t.internalValue.slice():[]}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wu,_u,Tu=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),Eu=((wu={})[ys.ASCENDING.name]="ASCENDING",wu[ys.DESCENDING.name]="DESCENDING",wu),Su=((_u={})[hs.LESS_THAN.name]="LESS_THAN",_u[hs.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",_u[hs.GREATER_THAN.name]="GREATER_THAN",_u[hs.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",_u[hs.EQUAL.name]="EQUAL",_u[hs.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",_u[hs.IN.name]="IN",_u[hs.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",_u),Iu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cu(t,e){Or(!is(t),e+" is missing")}function Ou(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Cr("can't parse "+t)}var Nu=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Dr.UNKNOWN:Ys(t.code);return new kr(e,t.message||"")},t.prototype.toInt32Value=function(t){return this.options.useProto3Json||is(t)?t:{value:t}},t.prototype.fromInt32Value=function(t){var e;return is(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Or(!!t,"Cannot deserialize null or undefined timestamp.");var e=Ou(t.seconds||"0"),n=t.nanos||0;return new Ri(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=Iu.exec(t);if(Or(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Ri(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(Or(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),hi.fromBase64String(t)):(Or(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),hi.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return Or(!!t,"Trying to deserialize version that isn't set"),Pi.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=yi.fromString(t);return Or(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return Or(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Or(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new wi(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?yi.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new yi(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new yi(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return Or(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Fo)return{nullValue:"NULL_VALUE"};if(t instanceof Uo)return{booleanValue:t.value()};if(t instanceof Bo)return{integerValue:""+t.value()};if(t instanceof Wo){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Ko?{stringValue:t.value()}:t instanceof Xo?{mapValue:this.toMapValue(t)}:t instanceof Jo?{arrayValue:this.toArrayValue(t)}:t instanceof Ho?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Yo?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Go?{bytesValue:this.toBytes(t.value())}:t instanceof zo?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Cr("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Fo.INSTANCE;if("booleanValue"in t)return Uo.of(t.booleanValue);if("integerValue"in t)return new Bo(Ou(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Wo.NAN;if("Infinity"===t.doubleValue)return Wo.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Wo.NEGATIVE_INFINITY}return new Wo(t.doubleValue)}if("stringValue"in t)return new Ko(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){Cu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Jo(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return Cu(t.timestampValue,"timestampValue"),new Ho(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){Cu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Yo(new du(r,i))}if("bytesValue"in t){Cu(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Go(o)}if("referenceValue"in t){Cu(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new di(a.get(1),a.get(3)),u=new wi(this.extractLocalPathFromResourceName(a));return new zo(s,u)}return Cr("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return Or(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Zo(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=Xo.EMPTY;return xr(n,function(t,n){r=r.set(new bi([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){var e=this;Or(!!t.found,"Tried to deserialize a found document from a missing document."),Cu(t.found.name,"doc.found.name"),Cu(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Zo(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},t.prototype.fromMissing=function(t){Or(!!t.missing,"Tried to deserialize a missing document from a found document."),Or(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new ta(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Cr("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case tu.Added:return"ADD";case tu.Current:return"CURRENT";case tu.NoChange:return"NO_CHANGE";case tu.Removed:return"REMOVE";case tu.Reset:return"RESET";default:return Cr("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof au)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof ou){if(t.newDoc instanceof Zo){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof ta){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof su){var n=void 0;return t.cause&&(n={code:Xs(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Cr("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){Cu(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new su(r,i,o,s||null)}else if("documentChange"in t){Cu(t.documentChange,"documentChange");var u=t.documentChange;Cu(u.document,"documentChange.name"),Cu(u.document.name,"documentChange.document.name"),Cu(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Zo(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new ou(f,p,l.key,l)}else if("documentDelete"in t){Cu(t.documentDelete,"documentDelete");var d=t.documentDelete;Cu(d.document,"documentDelete.document");c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):Pi.forDeletedDoc(),l=new ta(c,h),p=d.removedTargetIds||[];e=new ou([],p,l.key,l)}else if("documentRemove"in t){Cu(t.documentRemove,"documentRemove");var m=t.documentRemove;Cu(m.document,"documentRemove");c=this.fromName(m.document),p=m.removedTargetIds||[];e=new ou([],p,c,null)}else{if(!("filter"in t))return Cr("Unknown change type "+JSON.stringify(t));Cu(t.filter,"filter");var g=t.filter;Cu(g.targetId,"filter.targetId");var y=g.count||0,v=new Tu(y),b=g.targetId;e=new au(b,v)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?tu.NoChange:"ADD"===t?tu.Added:"REMOVE"===t?tu.Removed:"CURRENT"===t?tu.Current:"RESET"===t?tu.Reset:Cr("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Pi.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Pi.MIN:e.readTime?this.fromVersion(e.readTime):Pi.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof Ro)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Lo)e={delete:this.toName(t.key)};else if(t instanceof Po)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Mo))return Cr("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Do.NONE;if(t.update){Cu(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Po(r,i,o,n)}return new Ro(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new Lo(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Or(!0===n.exists,'Transforms only support precondition "exists == true"'),new Mo(r,a)}return Cr("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return Or(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Cr("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Do.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Do.exists(t.exists):Do.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Pi.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new Oo(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(Or(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof mu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof gu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof yu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof vu)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Cr("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Or("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=mu.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new gu(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new yu(r.map(function(t){return e.fromValue(t)}))}else if("increment"in t){var i=this.fromValue(t.increment);Or(i instanceof Vo,"NUMERIC_ADD transform requires a NumberValue"),n=new vu(i)}else Cr("Unknown transform proto: "+JSON.stringify(t));var o=bi.fromServerFormat(t.fieldPath);return new Co(o,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Or(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return us.atPath(this.fromQueryPath(n)).toTarget()},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Or(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Or(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Or(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new us(e,i,s,a,u,as.First,c,h).toTarget()},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case Na.Listen:return null;case Na.ExistenceFilterMismatch:return"existence-filter-mismatch";case Na.LimboResolution:return"limbo-document";default:return Cr("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof ls?e.toUnaryOrFieldFilter(t):Cr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Cr("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new vs(r,n)},t.prototype.toDirection=function(t){return Eu[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return ys.ASCENDING;case"DESCENDING":return ys.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Su[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return hs.EQUAL;case"GREATER_THAN":return hs.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return hs.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return hs.LESS_THAN;case"LESS_THAN_OR_EQUAL":return hs.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return hs.ARRAY_CONTAINS;case"IN":return hs.IN;case"ARRAY_CONTAINS_ANY":return hs.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Cr("Unspecified operator");default:return Cr("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return bi.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new bs(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return ls.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===hs.EQUAL){if(t.value.isEqual(Wo.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Fo.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return ls.create(e,hs.EQUAL,Wo.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return ls.create(n,hs.EQUAL,Fo.INSTANCE);case"OPERATOR_UNSPECIFIED":return Cr("Unspecified filter");default:return Cr("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return bi.fromServerFormat(t)});return Io.fromArray(e)},t}(),Au=function(){return function(){this.viewSnap=null,this.targetId=0,this.listeners=[]}}(),Du=function(){function t(t){this.syncEngine=t,this.queries=new na(function(t){return t.canonicalId()}),this.onlineState=Us.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);(r||(n=!0,r=new Au,this.queries.set(e,r)),r.listeners.push(t),Or(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.viewSnap)&&(t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent());return n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,r,i;return Object(o.d)(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++){u[s].onViewSnapshot(i)&&(e=!0)}a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t;var e=!1;this.queries.forEach(function(n,r){for(var i=0,o=r.listeners;i<o.length;i++){o[i].applyOnlineStateChange(t)&&(e=!0)}}),e&&this.raiseSnapshotsInSyncEvent()},t.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},t.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},t.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},t}(),ku=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=Us.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(Or(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Js.Metadata&&e.push(i)}t=new nu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},t.prototype.shouldRaiseInitialEvent=function(t,e){if(Or(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Us.Offline;return this.options.waitForSyncWhenOnline&&n?(Or(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Us.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){Or(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=nu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),Ru=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}return t.fromSnapshot=function(e,n){for(var r=zi(),i=zi(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case Js.Added:r=r.add(s.doc.key);break;case Js.Removed:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Pu=function(){return function(t){this.key=t}}(),Mu=function(){return function(t){this.key=t}}(),Lu=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=zi(),this.mutatedKeys=zi(),this.documentSet=new Zs(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new eu,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimitToFirst()&&i.size===this.query.limit?i.last():null,c=this.query.hasLimitToLast()&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=e instanceof Zo?e:null;l&&(Or(t.isEqual(l.key),"Mismatching keys found in document changes: "+t+" != "+l.key),l=n.query.matches(l)?l:null);var f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data().isEqual(l.data())?f!==p&&(r.track({type:Js.Metadata,doc:l}),d=!0):n.shouldWaitForSyncedDocument(h,l)||(r.track({type:Js.Modified,doc:l}),d=!0,(u&&n.query.docComparator(l,u)>0||c&&n.query.docComparator(l,c)<0)&&(s=!0)):!h&&l?(r.track({type:Js.Added,doc:l}),d=!0):h&&!l&&(r.track({type:Js.Removed,doc:h}),d=!0,(u||c)&&(s=!0));d&&(l?(a=a.add(l),o=p?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;a.size>this.query.limit;){var h=this.query.hasLimitToFirst()?a.last():a.first();a=a.delete(h.key),o=o.delete(h.key),r.track({type:Js.Removed,doc:h})}return Or(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;Or(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case Js.Added:return 1;case Js.Modified:case Js.Metadata:return 2;case Js.Removed:return 0;default:return Cr("Unknown ChangeType: "+t)}};return n(t)-n(e)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?$s.Synced:$s.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new nu(this.query,t.documentSet,i,o,t.mutatedKeys,s===$s.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Us.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new eu,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Or(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=zi(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new Mu(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new Pu(t))}),n},t.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=zi();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},t.prototype.computeInitialSnapshot=function(){return nu.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===$s.Local)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xu=5,ju=function(){function t(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=xu,this.backoff=new Fs(this.asyncQueue,ci.RetryTransaction)}return t.prototype.run=function(){this.runWithBackOff()},t.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return Object(o.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(o.d)(this,function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.handleTransactionError(t)})})}).catch(function(t){n.handleTransactionError(t)}),[2]})})})},t.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!is(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.handleTransactionError=function(t){var e=this;this.retries>0&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.isRetryableTransactionError=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!zs(e)}return!1},t}(),Fu=function(){return function(t,e,n){this.query=t,this.targetId=e,this.view=n}}(),Uu=function(){return function(t){this.key=t,this.receivedDocument=!1}}(),Vu=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new na(function(t){return t.canonicalId()}),this.queriesByTarget={},this.limboTargetsByKey=new Mi(wi.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new Ss,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=vo.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Us.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Or(null!==t,"SyncEngine listener cannot be null"),Or(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,r,i,a;return Object(o.d)(this,function(o){switch(o.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(t.toTarget())];case 2:return i=o.sent(),a=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(t,e,"current"===a)];case 3:n=o.sent(),this.isPrimary&&this.remoteStore.listen(i),o.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e,n){return Object(o.b)(this,void 0,void 0,function(){var r,i,a,s,u,c;return Object(o.d)(this,function(o){switch(o.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return r=o.sent(),i=new Lu(t,r.remoteKeys),a=i.computeDocChanges(r.documents),s=iu.createSynthesizedTargetChangeForCurrentChange(e,n&&this.onlineState!==Us.Offline),Or(0===(u=i.applyChanges(a,!0===this.isPrimary,s)).limboChanges.length,"View returned limbo docs before target ack from the server."),Or(!!u.snapshot,"applyChanges for new view should always return a snapshot"),c=new Fu(t,e,i),this.queryViewsByQuery.set(t,c),this.queriesByTarget[e]||(this.queriesByTarget[e]=[]),this.queriesByTarget[e].push(t),[2,u.snapshot]}})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n;return Object(o.d)(this,function(r){switch(r.label){case 0:return[4,this.localStore.executeQuery(t.query,!0)];case 1:return e=r.sent(),n=t.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(t.targetId,n.limboChanges),[2,n]}})})},t.prototype.unlisten=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,r=this;return Object(o.d)(this,function(i){switch(i.label){case 0:return this.assertSubscribed("unlisten()"),Or(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),(n=this.queriesByTarget[e.targetId]).length>1?(this.queriesByTarget[e.targetId]=n.filter(function(e){return!e.isEqual(t)}),this.queryViewsByQuery.delete(t),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then(function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)}).catch(Ya)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}})})},t.prototype.runTransaction=function(t,e,n){new ju(t,this.remoteStore,e,n).run()},t.prototype.applyRemoteEvent=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n=this;return Object(o.d)(this,function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),xr(t.targetChanges,function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(Or(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?Or(r.receivedDocument,"Received change for limbo target document without add."):e.removedDocuments.size>0&&(Or(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Ya(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Vs.RemoteStore||!this.isPrimary&&e===Vs.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);Or(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n,r,i,a,s,u=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new Mi(wi.comparator)).insert(r,new ta(r,Pi.forDeletedDoc())),a=zi().add(r),s=new ru(Pi.MIN,{},new Fi(ii),i,a),[2,this.applyRemoteEvent(s)]):[3,1];case 1:return[4,this.localStore.releaseTarget(t,!1).then(function(){return u.removeAndCleanupTarget(t,e)}).catch(Ya)];case 2:o.sent(),o.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return Object(o.b)(this,void 0,void 0,function(){var r;return Object(o.d)(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(Er("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Cr("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n;return Object(o.d)(this,function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ya(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.rejectFailedWrite=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ya(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.registerPendingWritesCallback=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n;return Object(o.d)(this,function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||Er("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?(t.resolve(),[2]):((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n),[2])}})})},t.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},t.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach(function(e){e.forEach(function(e){e.reject(new kr(Dr.CANCELLED,t))})}),this.pendingWritesCallbacks.clear()},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Mi(ii)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Or(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),Or(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach(function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof Pu)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof Mu){Er("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else Cr("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Er("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=us.atPath(e.path);this.limboResolutionsByTarget[n]=new Uu(e),this.remoteStore.listen(new La(r.toTarget(),n,Na.LimboResolution,mi.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n,r,i,a=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(o,s){i.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?a.localStore.executeQuery(s.query,!1).then(function(t){var n=t.documents;return s.view.computeDocChanges(n,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],o=s.view.applyChanges(t,!0===a.isPrimary,i);if(a.updateTrackedLimbos(s.targetId,o.limboChanges),o.snapshot){a.isPrimary&&a.sharedClientState.updateQueryState(s.targetId,o.snapshot.fromCache?"not-current":"current"),n.push(o.snapshot);var u=Ru.fromSnapshot(s.targetId,o.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return o.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return o.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){Or(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n;return Object(o.d)(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,r,i,a,s,u,c=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return o.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=o.sent(),r=0,i=n;r<i.length;r++)a=i[r],this.remoteStore.listen(a);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),Lr(this.queriesByTarget,function(t,e){c.sharedClientState.isLocalQueryTarget(t)?s.push(t):u=u.then(function(){return c.removeAndCleanupTarget(t),c.localStore.releaseTarget(t,!0)}),c.remoteStore.unlisten(t)}),[4,u]);case 4:return o.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)];case 5:return o.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:o.sent(),o.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;Lr(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Mi(wi.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,r,i,a,s,u,c,h,l,f,p,d;return Object(o.d)(this,function(o){switch(o.label){case 0:e=[],n=[],r=0,i=t,o.label=1;case 1:return r<i.length?(a=i[r],s=void 0,(u=this.queriesByTarget[a])&&0!==u.length?[4,this.localStore.releaseTarget(a,!0)]:[3,8]):[3,14];case 2:return o.sent(),[4,this.localStore.allocateTarget(u[0].toTarget())];case 3:s=o.sent(),c=0,h=u,o.label=4;case 4:return c<h.length?(l=h[c],Or(!!(f=this.queryViewsByQuery.get(l)),"No query view found for "+l),[4,this.synchronizeViewAndComputeSnapshot(f)]):[3,7];case 5:(p=o.sent()).snapshot&&n.push(p.snapshot),o.label=6;case 6:return c++,[3,4];case 7:return[3,12];case 8:return Or(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(a)];case 9:return Or(!!(d=o.sent()),"Target for id "+a+" not found"),[4,this.localStore.allocateTarget(d)];case 10:return s=o.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(d),a,!1)];case 11:o.sent(),o.label=12;case 12:e.push(s),o.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},t.prototype.synthesizeTargetToQuery=function(t){return new us(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,as.First,t.startAt,t.endAt)},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return Object(o.b)(this,void 0,void 0,function(){var r,i;return Object(o.d)(this,function(o){switch(o.label){case 0:if(this.isPrimary)return Er("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[t])return[3,7];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return r=o.sent(),i=ru.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return o.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(t,!0)];case 5:return o.sent(),this.removeAndCleanupTarget(t,n),[3,7];case 6:Cr("Unexpected target state: "+e),o.label=7;case 7:return[2]}})})},t.prototype.applyActiveTargetsChange=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n,r,i,a,s,u,c,h,l,f=this;return Object(o.d)(this,function(p){switch(p.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,p.label=1;case 1:return n<r.length?(l=r[n],Or(!this.queriesByTarget[l],"Trying to add an already active target"),[4,this.localStore.getTarget(l)]):[3,6];case 2:return Or(!!(i=p.sent()),"Query data for active target "+l+" not found"),[4,this.localStore.allocateTarget(i)];case 3:return a=p.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(i),a.targetId,!1)];case 4:p.sent(),this.remoteStore.listen(a),p.label=5;case 5:return n++,[3,1];case 6:s=function(t){return Object(o.d)(this,function(e){switch(e.label){case 0:return u.queriesByTarget[t]?[4,u.localStore.releaseTarget(t,!1).then(function(){f.remoteStore.unlisten(t),f.removeAndCleanupTarget(t)}).catch(Ya)]:[2,"continue"];case 1:return e.sent(),[2]}})},u=this,c=0,h=e,p.label=7;case 7:return c<h.length?(l=h[c],[5,s(l)]):[3,10];case 8:p.sent(),p.label=9;case 9:return c++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return zi().add(e.key);var n=zi(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);Or(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},t}(),qu=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Bu="firestore_clients";function Wu(t,e){return Or(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Bu+"_"+t+"_"+e}var Ku="firestore_mutations";function Hu(t,e,n){var r=Ku+"_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}var Qu="firestore_targets";function Gu(t,e){return Qu+"_"+t+"_"+e}var zu="firestore_online_state";var Yu="firestore_sequence_number";
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Xu="SharedClientState",Ju=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,Or(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new kr(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(Sr(Xu,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),$u=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,Or(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new kr(r.error.code,r.error.message)),i?new t(e,r.state,o):(Sr(Xu,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Zu=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Xi(),a=0;i&&a<r.activeTargetIds.length;++a)i=os(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(Sr(Xu,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),tc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&n.onlineState in Us&&"string"==typeof n.clientId?new t(n.clientId,Us[n.onlineState]):(Sr(Xu,"Failed to parse online state: "+e),null)},t}(),ec=function(){function t(){this.activeTargetIds=Xi()}return t.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),nc=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new kr(Dr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=Wu(this.persistenceKey,this.localClientId),this.sequenceNumberKey=function(t){return Yu+"_"+t}(this.persistenceKey),this.activeClients[this.localClientId]=new ec,this.clientStateKeyRe=new RegExp("^"+Bu+"_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Ku+"_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+Qu+"_"+a+"_(\\d+)$"),this.onlineStateKey=function(t){return zu+"_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e,n,r,i,a,s,u,c,h,l,f=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return Or(!this.started,"WebStorageSharedClientState already started"),Or(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Or(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=o.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(Wu(this.persistenceKey,r)))&&(a=Zu.fromWebStorageEntry(r,i))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=Xi();return xr(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Gu(this.persistenceKey,t));if(n){var r=$u.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Gu(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Er(Xu,"READ",t,e),e},t.prototype.setItem=function(t,e){Er(Xu,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Er(Xu,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(Er(Xu,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Sr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return Object(o.b)(e,void 0,void 0,function(){var e,n,r,i,a,s;return Object(o.d)(this,function(o){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(a=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(a)]}else t.key===this.sequenceNumberKey&&(Or(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(s=function(t){var e=mi.INVALID;if(null!=t)try{var n=JSON.parse(t);Or("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Sr(Xu,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==mi.INVALID&&this.sequenceNumberHandler(s));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new Ju(this.currentUser,t,e,n),i=Hu(this.persistenceKey,this.currentUser,t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=Hu(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Us[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=Gu(this.persistenceKey,t),i=new $u(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Or(null!==n,"Cannot parse client state key '"+t+"'"),Zu.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Or(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ju.fromWebStorageEntry(new qu(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Or(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return $u.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return tc.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){return t.user.uid!==this.currentUser.uid?(Er(Xu,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),a=[],s=[];return i.forEach(function(t){return Object(o.b)(n,void 0,void 0,function(){return Object(o.d)(this,function(e){return r.has(t)||a.push(t),[2]})})}),r.forEach(function(t){return Object(o.b)(n,void 0,void 0,function(){return Object(o.d)(this,function(e){return i.has(t)||s.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(a,s)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}();var rc=function(){function t(){this.localState=new ec,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new ec,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),ic=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return Va.withCacheSize(this.cacheSizeBytes)},t}(),oc=function(){return function(){}}(),ac=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=ri.newId()}return t.prototype.start=function(t){var e=this;this.verifyNotTerminated();var n=new _i,r=new _i,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof ic?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof kr?t.code===Dr.FAILED_PRECONDITION||t.code===Dr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new kr(Dr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=za.buildStoragePrefix(this.databaseInfo),i=new Nu(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return Object(o.b)(n,void 0,void 0,function(){var n,a;return Object(o.d)(this,function(o){switch(o.label){case 0:if(e.synchronizeTabs&&!nc.isAvailable(this.platform))throw new kr(Dr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=e.lruParams(),this.sharedClientState=e.synchronizeTabs?new nc(this.asyncQueue,this.platform,r,this.clientId,t):new rc,[4,za.createIndexedDbPersistence({allowTabSynchronization:e.synchronizeTabs,persistenceKey:r,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:i,lruParams:n,sequenceNumberSyncer:this.sharedClientState})];case 1:return a=o.sent(),this.persistence=a,[2,a.referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=ks.createEagerPersistence(this.clientId),this.sharedClientState=new rc,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return Er("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return Object(o.b)(n,void 0,void 0,function(){var n,i,a,s,u,c,h=this;return Object(o.d)(this,function(l){switch(l.label){case 0:return n=new Ts,this.localStore=new Cs(this.persistence,n,t),[4,this.localStore.start()];case 1:return l.sent(),e&&(this.lruScheduler=new qa(e,this.asyncQueue,this.localStore)),i=this.platform.newConnectivityMonitor(),a=this.platform.newSerializer(this.databaseInfo.databaseId),s=new Ks(this.asyncQueue,r,this.credentials,a),u=function(t){return h.syncEngine.applyOnlineStateChange(t,Vs.RemoteStore)},c=function(t){return h.syncEngine.applyOnlineStateChange(t,Vs.SharedClientState)},this.remoteStore=new pu(this.localStore,s,this.asyncQueue,u,i),this.syncEngine=new Vu(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=c,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Du(this.syncEngine),[4,this.sharedClientState.start()];case 2:return l.sent(),[4,this.remoteStore.start()];case 3:return l.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return Object(o.b)(h,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 4:return l.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return Object(o.b)(h,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return l.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Er("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return Object(o.b)(t,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},t.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new _i;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new ku(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Zo)return t;if(t instanceof ta)return null;throw new kr(Dr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return Object(o.b)(e,void 0,void 0,function(){var e,n,r;return Object(o.d)(this,function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return e=i.sent(),n=new Lu(t,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}})})})},t.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new _i;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},t.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(t.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new _i;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},t}(),sc=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),uc=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+ni(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Br("FieldPath","string",n,t[n]),0===t[n].length)throw new kr(Dr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bi(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(bi.keyField().canonicalString()),t}(),cc=new RegExp("[~\\*/\\[\\]]");
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var hc=function(){return function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}}(),lc=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){Or(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(qu.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){Or(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),fc=function(){function t(t){var e=this;this.tokenListener=null,this.currentUser=qu.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),t.get().then(function(t){e.auth=t,e.tokenListener&&e.auth.addAuthTokenListener(e.tokenListener)},function(){}))}return t.prototype.getToken=function(){var t=this;Or(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new kr(Dr.ABORTED,"getToken aborted due to token change.");return n?(Or("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new hc(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){Or(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){Or(null!=this.tokenListener,"removeChangeListener() called twice"),Or(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.auth&&this.auth.getUid();return Or(null===t||"string"==typeof t,"Received invalid UID: "+t),new qu(t)},t}(),pc=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=qu.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),dc=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new pc(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(qu.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function mc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,["next","error","complete"])}var gc,yc=function(){function t(t){this._methodName=t}return t.delete=function(){return Fr("FieldValue.delete",arguments),vc.instance},t.serverTimestamp=function(){return Fr("FieldValue.serverTimestamp",arguments),bc.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Vr("FieldValue.arrayUnion",arguments,1),new wc(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Vr("FieldValue.arrayRemove",arguments,1),new _c(t)},t.increment=function(t){return Br("FieldValue.increment","number",1,t),Ur("FieldValue.increment",arguments,1),new Tc(t)},t.prototype.isEqual=function(t){return this===t},t}(),vc=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return Object(o.c)(e,t),e.instance=new e,e}(yc),bc=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return Object(o.c)(e,t),e.instance=new e,e}(yc),wc=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return Object(o.c)(e,t),e}(yc),_c=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return Object(o.c)(e,t),e}(yc),Tc=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return Object(o.c)(e,t),e}(yc),Ec=Rr(yc,"Use FieldValue.<field>() instead."),Sc=/^__.*__$/,Ic=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Po(t,this.data,this.fieldMask,e)):n.push(new Ro(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Mo(t,this.fieldTransforms)),n},t}(),Cc=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Po(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new Mo(t,this.fieldTransforms)),n},t}();function Oc(t){switch(t){case gc.Set:case gc.MergeSet:case gc.Update:return!0;case gc.Argument:case gc.ArrayArgument:return!1;default:throw Cr("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument",t[t.ArrayArgument=4]="ArrayArgument"}(gc||(gc={}));var Nc=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new kr(Dr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(Oc(this.dataSource)&&Sc.test(t))throw this.createError('Document fields cannot begin and end with "__"')},t}(),Ac=function(){return function(t,e){this.databaseId=t,this.key=e}}(),Dc=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Nc(gc.Set,t,bi.EMPTY_PATH);Rc("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Ic(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Nc(gc.MergeSet,t,bi.EMPTY_PATH);Rc("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new Fi(bi.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof uc)l=h._internalPath;else{if("string"!=typeof h)throw Cr("Expected stringOrFieldPath to be a string or a FieldPath");l=Mc(t,h)}if(!r.contains(l))throw new kr(Dr.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=Io.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=Io.fromArray(r.fieldMask),o=r.fieldTransforms;return new Ic(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new Nc(gc.Update,t,bi.EMPTY_PATH);Rc("Data must be an object, but it was:",r,e);var i=new Fi(bi.comparator),o=Xo.EMPTY;xr(e,function(e,a){var s=Mc(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof vc)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=Io.fromSet(i);return new Cc(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Nc(gc.Update,t,bi.EMPTY_PATH),o=[Pc(t,e)],a=[n];if(r.length%2!=0)throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Pc(t,r[s])),a.push(r[s+1]);var u=new Fi(bi.comparator),c=Xo.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof vc)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=Io.fromSet(u);return new Cc(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new Nc(n?gc.ArrayArgument:gc.Argument,t,bi.EMPTY_PATH),i=this.parseData(e,r);return Or(null!=i,"Parsed data should not be null."),Or(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=Lc(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(kc(t=this.runPreConverter(t,e)))return Rc("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof yc)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==gc.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new Mi(ii);return jr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xr(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new Xo(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Fo.INSTANCE),n.push(s),r++}return new Jo(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Oc(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof vc){if(e.dataSource!==gc.MergeSet)throw e.dataSource===gc.Update?(Or(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof bc)e.fieldTransforms.push(new Co(e.path,mu.instance));else if(t instanceof wc){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new gu(n);e.fieldTransforms.push(new Co(e.path,r))}else if(t instanceof _c){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new yu(n);e.fieldTransforms.push(new Co(e.path,i))}else if(t instanceof Tc){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new vu(o);e.fieldTransforms.push(new Co(e.path,a))}else Cr("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Fo.INSTANCE;if("number"==typeof t)return os(t)?new Bo(t):new Wo(t);if("boolean"==typeof t)return Uo.of(t);if("string"==typeof t)return new Ko(t);if(t instanceof Date)return new Ho(Ri.fromDate(t));if(t instanceof Ri)return new Ho(new Ri(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof du)return new Yo(t);if(t instanceof hi)return new Go(t);if(t instanceof Ac)return new zo(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Xr(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new Nc(gc.Argument,t,bi.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function kc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ri||t instanceof du||t instanceof hi||t instanceof Ac||t instanceof yc)}function Rc(t,e,n){if(!kc(n)||!Yr(n)){var r=Xr(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Pc(t,e){if(e instanceof uc)return e._internalPath;if("string"==typeof e)return Mc(t,e);throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Mc(t,e){try{return function(t){if(t.search(cc)>=0)throw new kr(Dr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(uc.bind.apply(uc,Object(o.g)([void 0],t.split("."))))}catch(e){throw new kr(Dr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=Lc(e);throw new kr(Dr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Lc(t){return t instanceof Error?t.message:t.toString()}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xc="firestore.googleapis.com",jc=!0,Fc=!0,Uc=!1,Vc=Va.COLLECTION_DISABLED,qc=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new kr(Dr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=xc,this.ssl=jc}else Kr("settings","non-empty string","host",t.host),this.host=t.host,Hr("settings","boolean","ssl",t.ssl),this.ssl=Mr(t.ssl,jc);if($r("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Hr("settings","object","credentials",t.credentials),this.credentials=t.credentials,Hr("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Sr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Sr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Mr(t.timestampsInSnapshots,Fc),Hr("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Va.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==Vc&&t.cacheSizeBytes<Va.MINIMUM_CACHE_SIZE_BYTES)throw new kr(Dr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Va.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}Hr("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0===t.experimentalForceLongPolling?Uc:t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),Bc=function(){function t(e,n){var r=this;if(this._firebaseApp=null,this._queue=new Ei,this.INTERNAL={delete:function(){return Object(o.b)(r,void 0,void 0,function(){return Object(o.d)(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof e.options){var i=e;this._firebaseApp=i,this._databaseId=t.databaseIdFromApp(i),this._persistenceKey=i.name,this._credentials=new fc(n)}else{var a=e;if(!a.projectId)throw new kr(Dr.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new di(a.projectId,a.database),this._persistenceKey="[DEFAULT]",this._credentials=new lc}this._settings=new qc({}),this._dataConverter=this.createDataConverter(this._databaseId)}return t.prototype.settings=function(t){if(Ur("Firestore.settings",arguments,1),Br("Firestore.settings","object",1,t),Pr(t,"persistence"))throw new kr(Dr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new qc(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new kr(Dr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._settings=e,void 0!==e.credentials&&(this._credentials=function(t){if(!t)return new lc;switch(t.type){case"gapi":var e=t.client;return Or(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new dc(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new kr(Dr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new kr(Dr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Sr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Mr(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new ic(this._settings.cacheSizeBytes,e))},t.prototype.clearPersistence=function(){var t=this,e=za.buildStoragePrefix(this.makeDatabaseInfo()),n=new _i;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return Object(o.b)(t,void 0,void 0,function(){var t;return Object(o.d)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new kr(Dr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,za.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}})})}),n.promise},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),mc(t))return this.onSnapshotsInSyncInternal(t);Br("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},t.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new sc({next:function(){t.next&&t.next()},error:function(t){throw Cr("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new oc),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new fi(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},t.prototype.configureClient=function(t){Or(!!this._settings.host,"FirestoreSettings.host is not set"),Or(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new ac(Nr.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},t.prototype.createDataConverter=function(t){return new Dc(function(e){if(e instanceof Hc){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new kr(Dr.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Ac(t,e._key)}return e})},t.databaseIdFromApp=function(t){var e=t.options;if(!Pr(e,"projectId"))throw new kr(Dr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new kr(Dr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new di(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._firebaseApp)throw new kr(Dr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return Ur("Firestore.collection",arguments,1),Br("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Jc(yi.fromString(t),this)},t.prototype.doc=function(t){return Ur("Firestore.doc",arguments,1),Br("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),Hc.forPath(yi.fromString(t),this)},t.prototype.collectionGroup=function(t){if(Ur("Firestore.collectionGroup",arguments,1),Br("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new kr(Dr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new Yc(new us(yi.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return Ur("Firestore.runTransaction",arguments,1),Br("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new Wc(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Kc(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(_r()){case fr.DEBUG:return"debug";case fr.ERROR:return"error";case fr.SILENT:return"silent";default:return Cr("Unknown log level: "+_r())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(Ur("Firestore.setLogLevel",arguments,1),Br("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Tr(fr.DEBUG);break;case"error":Tr(fr.ERROR);break;case"silent":Tr(fr.SILENT);break;default:throw new kr(Dr.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},t}(),Wc=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;Ur("Transaction.get",arguments,1);var n=eh("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Cr("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof ta)return new Gc(e._firestore,n._key,null,!1,!1,n._converter);if(r instanceof Zo)return new Gc(e._firestore,n._key,r,!1,!1,n._converter);throw Cr("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){qr("Transaction.set",arguments,2,3);var r=eh("Transaction.set",t,this._firestore);n=$c("Transaction.set",n);var i=rh(r._converter,e,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return"string"==typeof e||e instanceof uc?(Vr("Transaction.update",arguments,3),r=eh("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Ur("Transaction.update",arguments,2),r=eh("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Ur("Transaction.delete",arguments,1);var e=eh("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Kc=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){qr("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=eh("WriteBatch.set",t,this._firestore);n=$c("WriteBatch.set",n);var i=rh(r._converter,e,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,Do.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),"string"==typeof e||e instanceof uc?(Vr("WriteBatch.update",arguments,3),r=eh("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Ur("WriteBatch.update",arguments,2),r=eh("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Do.exists(!0))),this},t.prototype.delete=function(t){Ur("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=eh("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Lo(e._key,Do.NONE)),this},t.prototype.commit=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new kr(Dr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Hc=function(){function t(t,e,n){this._key=t,this.firestore=e,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n,r){if(e.length%2!=0)throw new kr(Dr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new wi(e),n,r)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Jc(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(Ur("DocumentReference.collection",arguments,1),Br("DocumentReference.collection","non-empty string",1,t),!t)throw new kr(Dr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=yi.fromString(t);return new Jc(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)&&this._converter===e._converter},t.prototype.set=function(t,e){qr("DocumentReference.set",arguments,1,2),e=$c("DocumentReference.set",e);var n=rh(this._converter,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,e.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,Do.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof uc?(Vr("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Ur("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Do.exists(!0)))},t.prototype.delete=function(){return Ur("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Lo(this._key,Do.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];qr("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||mc(t[i])||($r("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Hr("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return mc(t[i])?n=t[i]:(Br("DocumentReference.onSnapshot","function",i,t[i]),Wr("DocumentReference.onSnapshot","function",i+1,t[i+1]),Wr("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new sc({next:function(t){if(e.next){Or(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new Gc(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites,n._converter))}},error:r}),o=this._firestoreClient.listen(us.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return qr("DocumentReference.get",arguments,0,1),th("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new Gc(e.firestore,e._key,t,!0,t instanceof Zo&&t.hasLocalMutations,e._converter))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new kr(Dr.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new kr(Dr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t.prototype.withConverter=function(e){return new t(this._key,this.firestore,e)},t}(),Qc=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Gc=function(){function t(t,e,n,r,i,o){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}return t.prototype.data=function(t){if(qr("DocumentSnapshot.data",arguments,0,1),t=Zc("DocumentSnapshot.data",t),this._document){if(this._converter){var e=new zc(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(e,t)}return this.toJSObject(this._document.data(),xo.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},t.prototype.get=function(t,e){if(qr("DocumentSnapshot.get",arguments,1,2),e=Zc("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(Pc("DocumentSnapshot.get",t));if(null!==n)return this.toJSValue(n,xo.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Hc(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Qc(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))&&this._converter===e._converter},t.prototype.toJSObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.toJSValue(i,e)}),r},t.prototype.toJSValue=function(t,e){if(t instanceof Xo)return this.toJSObject(t,e);if(t instanceof Jo)return this.toJSArray(t,e);if(t instanceof zo){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Sr("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Hc(n,this._firestore,this._converter)}return t.value(e)},t.prototype.toJSArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.toJSValue(t,e)})},t}(),zc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return Or(void 0!==n,"Document in a QueryDocumentSnapshot should exist"),n},e}(Gc),Yc=function(){function t(t,e,n){this._query=t,this.firestore=e,this._converter=n}return t.prototype.where=function(e,n,r){Ur("Query.where",arguments,3),Jr("Query.where",3,r);var i;!function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new kr(Dr.INVALID_ARGUMENT,"Invalid value "+Xr(r)+" provided to function "+t+"() for its "+ei(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,n);var o=Pc("Query.where",e),a=hs.fromString(n);if(o.isKeyField()){if(a===hs.ARRAY_CONTAINS||a===hs.ARRAY_CONTAINS_ANY)throw new kr(Dr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+a.toString()+"' queries on FieldPath.documentId().");if(a===hs.IN){this.validateDisjunctiveFilterElements(r,a);for(var s=[],u=0,c=r;u<c.length;u++){var h=c[u];s.push(this.parseDocumentIdValue(h))}i=new Jo(s)}else i=this.parseDocumentIdValue(r)}else a!==hs.IN&&a!==hs.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(r,a),i=this.firestore._dataConverter.parseQueryValue("Query.where",r,a===hs.IN);var l=ls.create(o,a,i);return this.validateNewFilter(l),new t(this._query.addFilter(l),this.firestore,this._converter)},t.prototype.orderBy=function(e,n){var r;if(qr("Query.orderBy",arguments,1,2),Wr("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=ys.ASCENDING;else{if("desc"!==n)throw new kr(Dr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=ys.DESCENDING}if(null!==this._query.startAt)throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Pc("Query.orderBy",e),o=new bs(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore,this._converter)},t.prototype.limit=function(e){return Ur("Query.limit",arguments,1),Br("Query.limit","number",1,e),ti("Query.limit",1,e),new t(this._query.withLimitToFirst(e),this.firestore,this._converter)},t.prototype.limitToLast=function(e){return Ur("Query.limitToLast",arguments,1),Br("Query.limitToLast","number",1,e),ti("Query.limitToLast",1,e),new t(this._query.withLimitToLast(e),this.firestore,this._converter)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore,this._converter)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore,this._converter)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore,this._converter)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore,this._converter)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.withConverter=function(e){return new t(this._query,this.firestore,e)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(Jr(t,1,e),e instanceof Gc){if(n.length>0)throw new kr(Dr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new kr(Dr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new zo(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Qo)throw new kr(Dr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new vs(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new kr(Dr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(yi.fromString(a));if(!wi.isDocumentKey(s))throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new wi(s);i.push(new zo(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new vs(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];qr("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||mc(t[i])||($r("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Hr("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),mc(t[i])?n=t[i]:(Br("Query.onSnapshot","function",i,t[i]),Wr("Query.onSnapshot","function",i+1,t[i+1]),Wr("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new sc({next:function(t){e.next&&e.next(new Xc(n.firestore,n._query,t,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new kr(Dr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},t.prototype.get=function(t){var e=this;return qr("Query.get",arguments,0,1),th("Query.get",t),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new Xc(e.firestore,e._query,t,e._converter))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new kr(Dr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(yi.fromString(t));if(!wi.isDocumentKey(e))throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new zo(this.firestore._databaseId,new wi(e))}if(t instanceof Hc){var n=t;return new zo(this.firestore._databaseId,n._key)}throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Xr(t)+".")},t.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new kr(Dr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new kr(Dr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new kr(Dr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter(function(t){return Number.isNaN(t)}).length>0)throw new kr(Dr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.validateNewFilter=function(t){if(t instanceof ls){var e=[hs.ARRAY_CONTAINS,hs.ARRAY_CONTAINS_ANY],n=[hs.IN,hs.ARRAY_CONTAINS_ANY],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new kr(Dr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new kr(Dr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new kr(Dr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),Xc=function(){function t(t,e,n,r){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Qc(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;qr("QuerySnapshot.forEach",arguments,1,2),Br("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new Yc(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&($r("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Hr("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new kr(Dr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n,r){if(n.oldDocs.isEmpty()){var i,o=0;return n.docChanges.map(function(e){var a=new zc(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r);return Or(e.type===Js.Added,"Invalid event type for first snapshot"),Or(!i||n.query.docComparator(i,e.doc)<0,"Got added events in wrong order"),i=e.doc,{type:"added",doc:a,oldIndex:-1,newIndex:o++}})}var a=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==Js.Metadata}).map(function(e){var i=new zc(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r),o=-1,s=-1;return e.type!==Js.Added&&(Or((o=a.indexOf(e.doc.key))>=0,"Index for document not found"),a=a.delete(e.doc.key)),e.type!==Js.Removed&&(a=a.add(e.doc),s=a.indexOf(e.doc.key)),{type:nh(e.type),doc:i,oldIndex:o,newIndex:s}})}(this._firestore,e,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)&&this._converter===e._converter},t.prototype.convertToDocumentImpl=function(t){return new zc(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key),this._converter)},t}();Object(o.g)(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(Xc.prototype.docChanges,t,{get:function(){return function(){throw new kr(Dr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Jc=function(t){function e(e,n,r){var i=t.call(this,us.atPath(e),n,r)||this;if(i._path=e,e.length%2!=1)throw new kr(Dr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return i}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new Hc(new wi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(qr("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=ri.newId()),Br("CollectionReference.doc","non-empty string",1,t),""===t)throw new kr(Dr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=yi.fromString(t);return Hc.forPath(this._query.path.child(e),this.firestore,this._converter)},e.prototype.add=function(t){Ur("CollectionReference.add",arguments,1),Br("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e.prototype.withConverter=function(t){return new e(this._path,this.firestore,t)},e}(Yc);function $c(t,e){if(void 0===e)return{merge:!1};if($r(t,e,["merge","mergeFields"]),Hr(t,"boolean","merge",e.merge),Qr(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof uc}),void 0!==e.mergeFields&&void 0!==e.merge)throw new kr(Dr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Zc(t,e){return void 0===e?{}:($r(t,e,["serverTimestamps"]),Gr(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function th(t,e){Wr(t,"object",1,e),e&&($r(t,e,["source"]),Gr(t,0,"source",e.source,["default","server","cache"]))}function eh(t,e,n){if(e instanceof Hc){if(e.firestore!==n)throw new kr(Dr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Zr(t,"DocumentReference",1,e)}function nh(t){switch(t){case Js.Added:return"added";case Js.Modified:case Js.Metadata:return"modified";case Js.Removed:return"removed";default:return Cr("Unknown change type: "+t)}}function rh(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var ih=Rr(Bc,"Use firebase.firestore() instead."),oh=Rr(Wc,"Use firebase.firestore().runTransaction() instead."),ah=Rr(Kc,"Use firebase.firestore().batch() instead."),sh=Rr(Hc,"Use firebase.firestore().doc() instead."),uh=Rr(Gc),ch=Rr(zc),hh=Rr(Yc),lh=Rr(Xc),fh=Rr(Jc,"Use firebase.firestore().collection() instead."),ph={Firestore:ih,GeoPoint:du,Timestamp:Ri,Blob:li,Transaction:oh,WriteBatch:ah,DocumentReference:sh,DocumentSnapshot:uh,Query:hh,QueryDocumentSnapshot:ch,QuerySnapshot:lh,CollectionReference:fh,FieldPath:uc,FieldValue:Ec,setLogLevel:Bc.setLogLevel,CACHE_SIZE_UNLIMITED:Vc};function dh(t){t.INTERNAL.registerComponent(new u.a("firestore",function(t){var e=t.getProvider("app").getImmediate();return new Bc(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(function(t){Or(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(ph)))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mh=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),gh=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){Er("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(0)}},t.prototype.onNetworkUnavailable=function(){Er("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(1)}},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),yh=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){Or(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){Or(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){Or(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){Or(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){Or(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){Or(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),vh="Connection",bh={BatchGetDocuments:"batchGet",Commit:"commit"},wh="gl-js/ fire/"+br,_h=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=wh},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(a,s){var u=new vr;u.listenOnce(gr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case mr.NO_ERROR:var e=u.getResponseJson();Er(vh,"XHR received:",JSON.stringify(e)),a(e);break;case mr.TIMEOUT:Er(vh,'RPC "'+t+'" timed out'),s(new kr(Dr.DEADLINE_EXCEEDED,"Request time out"));break;case mr.HTTP_ERROR:var n=u.getStatus();if(Er(vh,'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var i=(o=r.status,c=o.toLowerCase().replace("_","-"),Object.values(Dr).indexOf(c)>=0?c:Dr.UNKNOWN);s(new kr(i,r.message))}else s(new kr(Dr.UNKNOWN,"Server responded with status "+u.getStatus()))}else Er(vh,'RPC "'+t+'" failed'),s(new kr(Dr.UNAVAILABLE,"Connection failed."));break;default:Cr('RPC "'+t+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{Er(vh,'RPC "'+t+'" completed.')}var o,c});var c=Object(o.a)({},e);delete c.database;var h=JSON.stringify(c);Er(vh,"XHR sending: ",i+" "+h);var l={"Content-Type":"text/plain"};r.modifyHeadersForRequest(l,n),u.send(i,"POST",h,l,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=dr(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Object(s.x)()||Object(s.r)()||Object(s.t)()||Object(s.y)()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Er(vh,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),u=!1,c=!1,h=new yh({sendFn:function(t){c?Er(vh,"Not sending because WebChannel is closed:",t):(u||(Er(vh,"Opening WebChannel transport."),a.open(),u=!0),Er(vh,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),l=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(yr.EventType.OPEN,function(){c||Er(vh,"WebChannel transport opened.")}),l(yr.EventType.CLOSE,function(){c||(c=!0,Er(vh,"WebChannel transport closed"),h.callOnClose())}),l(yr.EventType.ERROR,function(t){c||(c=!0,Er(vh,"WebChannel transport errored:",t),h.callOnClose(new kr(Dr.UNAVAILABLE,"The operation could not be completed")))}),l(yr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Or(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Er(vh,"WebChannel received error:",i);var o=i.status,s=function(t){var e=Qs[t];if(void 0!==e)return Ys(e)}(o),u=i.message;void 0===s&&(s=Dr.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),c=!0,h.callOnClose(new kr(s,u)),a.close()}else Er(vh,"WebChannel received:",n),h.callOnMessage(n)}}),setTimeout(function(){h.callOnOpen()},0),h},t.prototype.makeUrl=function(t){var e=bh[t];return Or(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},t}(),Th=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new _h(t))},t.prototype.newConnectivityMonitor=function(){return gh.isAvailable()?new gh:new mh},t.prototype.newSerializer=function(t){return new Nu(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Nr.setPlatform(new Th);var Eh,Sh="@firebase/firestore",Ih="1.9.2";dh(Eh=i.a),Eh.registerVersion(Sh,Ih)},,,function(t,e,n){"use strict";(function(t){var e,r=n(2),i=n(0),o=n(1),a=n(4),s=n(3),u=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Object(o.G)(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Object(o.A)(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),c=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return Object(o.j)(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),h=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new u(e)}}catch(t){}return new c},l=h("localStorage"),f=h("sessionStorage"),p=new a.b("@firebase/database"),d=(e=1,function(){return e++}),m=function(t){var e=Object(o.F)(t),n=new o.e;n.update(e);var r=n.digest();return o.h.encodeByteArray(r)},g=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=g.apply(null,i):n+="object"==typeof i?Object(o.G)(i):i,n+=" "}return n},y=null,v=!0,b=function(t,e){Object(o.f)(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(p.logLevel=a.a.VERBOSE,y=p.log.bind(p),e&&f.set("logging_enabled",!0)):"function"==typeof t?y=t:(y=null,f.remove("logging_enabled"))},w=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===v&&(v=!1,null===y&&!0===f.get("logging_enabled")&&b(!0)),y){var n=g.apply(null,t);y(n)}},_=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];w.apply(void 0,Object(i.f)([t],e))}},T=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+g.apply(void 0,Object(i.f)(t));p.error(n)},E=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+g.apply(void 0,Object(i.f)(t));throw p.error(n),new Error(n)},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+g.apply(void 0,Object(i.f)(t));p.warn(n)},I=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},C="[MIN_NAME]",O="[MAX_NAME]",N=function(t,e){if(t===e)return 0;if(t===C||e===O)return-1;if(e===C||t===O)return 1;var n=x(t),r=x(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},A=function(t,e){return t===e?0:t<e?-1:1},D=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Object(o.G)(e))},k=function(t){if("object"!=typeof t||null===t)return Object(o.G)(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Object(o.G)(e[i]),r+=":",r+=k(t[e[i]]);return r+="}"},R=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function P(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var M=function(t){Object(o.f)(!I(t),"Invalid JSON number");var e,n,r,i,a;0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074))));var s=[];for(a=52;a;a-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(e?1:0),s.reverse();var u=s.join(""),c="";for(a=0;a<64;a+=8){var h=parseInt(u.substr(a,8),2).toString(16);1===h.length&&(h="0"+h),c+=h}return c.toLowerCase()},L=new RegExp("^-?(0*)\\d{1,10}$"),x=function(t){if(L.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},j=function(t){try{t()}catch(t){setTimeout(function(){var e=t.stack||"";throw S("Exception was thrown by user callback.",e),t},Math.floor(0))}},F=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},U=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},V=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=N(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),q=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(o.E)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Object(o.E)(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Object(o.E)(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),B="long_polling",W=function(){function t(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=l.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&l.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(Object(o.f)("string"==typeof t,"typeof type must == string"),Object(o.f)("object"==typeof e,"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==B)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return P(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var K,H,Q,G,z,Y=function(t){var e=X(t),n=e.namespace;"firebase"===e.domain&&E(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||E("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&S("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new W(e.host,e.secure,n,r,"",n!==e.subdomain),path:new V(e.pathString)}},X=function(t){var e="",n="",r="",o="",a="",s=!0,u="https",c=443;if("string"==typeof t){var h=t.indexOf("//");h>=0&&(u=t.substring(0,h-1),t=t.substring(h+2));var l=t.indexOf("/");-1===l&&(l=t.length);var f=t.indexOf("?");-1===f&&(f=t.length),e=t.substring(0,Math.min(l,f)),l<f&&(o=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(l,f)));var p=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var o=Object(i.h)(t.split("&")),a=o.next();!a.done;a=o.next()){var s=a.value;if(0!==s.length){var u=s.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):S("Invalid query segment '"+s+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,f)));(h=e.indexOf(":"))>=0?(s="https"===u||"wss"===u,c=parseInt(e.substring(h+1),10)):h=t.length;var d=e.split(".");3===d.length?(n=d[1],a=r=d[0].toLowerCase()):2===d.length?n=d[0]:"localhost"===d[0].slice(0,h).toLowerCase()&&(n="localhost"),"ns"in p&&(a=p.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:s,scheme:u,pathString:o,namespace:a}},J=/[\[\].#$\/\u0000-\u001F\u007F]/,$=/[\[\].#$\u0000-\u001F\u007F]/,Z=function(t){return"string"==typeof t&&0!==t.length&&!J.test(t)},tt=function(t){return"string"==typeof t&&0!==t.length&&!$.test(t)},et=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!I(t)||t&&"object"==typeof t&&Object(o.j)(t,".sv")},nt=function(t,e,n,r,i){i&&void 0===n||rt(Object(o.n)(t,e,i),n,r)},rt=function(t,e,n){var r=n instanceof V?new q(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(I(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>10485760/3&&Object(o.E)(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,a=!1;if(P(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(a=!0,!Z(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),rt(t,n,r),r.pop()}),i&&a)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},it=function(t,e,n,r,i){if(!i||void 0!==n){var a=Object(o.n)(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(a+" must be an object containing the children to replace.");var s=[];P(n,function(t,e){var n=new V(t);if(rt(a,e,r.child(n)),".priority"===n.getBack()&&!et(e))throw new Error(a+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Z(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(V.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(a,s)}},ot=function(t,e,n,r){if(!r||void 0!==n){if(I(n))throw new Error(Object(o.n)(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!et(n))throw new Error(Object(o.n)(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},at=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(o.n)(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},st=function(t,e,n,r){if(!(r&&void 0===n||Z(n)))throw new Error(Object(o.n)(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ut=function(t,e,n,r){if(!(r&&void 0===n||tt(n)))throw new Error(Object(o.n)(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ct=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},ht=function(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Z(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),tt(t)}(r))throw new Error(Object(o.n)(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},lt=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){Object(o.H)("OnDisconnect.cancel",0,1,arguments.length),Object(o.I)("OnDisconnect.cancel",1,t,!0);var e=new o.b;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){Object(o.H)("OnDisconnect.remove",0,1,arguments.length),ct("OnDisconnect.remove",this.path_),Object(o.I)("OnDisconnect.remove",1,t,!0);var e=new o.b;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){Object(o.H)("OnDisconnect.set",1,2,arguments.length),ct("OnDisconnect.set",this.path_),nt("OnDisconnect.set",1,t,this.path_,!1),Object(o.I)("OnDisconnect.set",2,e,!0);var n=new o.b;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){Object(o.H)("OnDisconnect.setWithPriority",2,3,arguments.length),ct("OnDisconnect.setWithPriority",this.path_),nt("OnDisconnect.setWithPriority",1,t,this.path_,!1),ot("OnDisconnect.setWithPriority",2,e,!1),Object(o.I)("OnDisconnect.setWithPriority",3,n,!0);var r=new o.b;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(Object(o.H)("OnDisconnect.update",1,2,arguments.length),ct("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,S("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}it("OnDisconnect.update",1,t,this.path_,!1),Object(o.I)("OnDisconnect.update",2,e,!0);var i=new o.b;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),ft=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Object(o.H)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),pt=(K="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",H=0,Q=[],function(t){var e,n=t===H;H=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=K.charAt(t%64),t=Math.floor(t/64);Object(o.f)(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;e>=0&&63===Q[e];e--)Q[e]=0;Q[e]++}else for(e=0;e<12;e++)Q[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=K.charAt(Q[e]);return Object(o.f)(20===i.length,"nextPushId: Length should be 20."),i}),dt=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),mt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new dt(C,t),r=new dt(C,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return dt.MIN},t}(),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return G},set:function(t){G=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return N(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw Object(o.g)("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return dt.MIN},e.prototype.maxPost=function(){return new dt(O,G)},e.prototype.makePost=function(t,e){return Object(o.f)("string"==typeof t,"KeyIndex indexValue must always be a string."),new dt(t,G)},e.prototype.toString=function(){return".key"},e}(mt),yt=new gt;var vt,bt,wt,_t=function(t){return"number"==typeof t?"number:"+M(t):"string:"+t},Tt=function(t){if(t.isLeafNode()){var e=t.val();Object(o.f)("string"==typeof e||"number"==typeof e||"object"==typeof e&&Object(o.j)(e,".sv"),"Priority must be a string or number.")}else Object(o.f)(t===z||t.isEmpty(),"priority of unexpected type.");Object(o.f)(t===z||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Et=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Object(o.f)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Tt(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return vt},set:function(t){vt=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(o.f)(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+_t(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?M(this.value_):this.value_,this.lazyHash_=m(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(Object(o.f)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(n),a=t.VALUE_TYPE_ORDER.indexOf(r);return Object(o.f)(i>=0,"Unknown leaf type: "+n),Object(o.f)(a>=0,"Unknown leaf type: "+r),i===a?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:a-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}();var St,It,Ct=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?N(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return dt.MIN},e.prototype.maxPost=function(){return new dt(O,new Et("[PRIORITY-POST]",wt))},e.prototype.makePost=function(t,e){var n=bt(t);return new dt(e,new Et("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(mt)),Ot=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),Nt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:Dt.EMPTY_NODE,this.right=null!=o?o:Dt.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Dt.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Dt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),At=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Nt(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Dt=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Nt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Nt.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new Ot(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new Ot(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new Ot(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new Ot(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new At,t}(),kt=Math.log(2),Rt=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/kt,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Pt=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0===s)return null;if(1===s)return o=t[e],a=n?n(o):o,new Nt(a,o.node,Nt.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new Nt(a,o.node,Nt.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(o+1,s),h=t[o],l=n?n(h):h;u(new Nt(l,h.node,r,null,c))},u=function(t){r?(r.left=t,r=t):(o=t,r=t)},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,Nt.BLACK):(s(l,Nt.BLACK),s(l,Nt.RED))}return o}(new Rt(t.length));return new Dt(r||e,o)},Mt={},Lt=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return Object(o.f)(Mt&&Ct,"ChildrenNode.ts has not been loaded"),St=St||new t({".priority":Mt},{".priority":Ct})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=Object(o.D)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Dt?e:null},t.prototype.hasIndex=function(t){return Object(o.j)(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){Object(o.f)(e!==yt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,a=[],s=!1,u=n.getIterator(dt.Wrap),c=u.getNext();c;)s=s||e.isDefinedOn(c.node),a.push(c),c=u.getNext();r=s?Pt(a,e.getCompare()):Mt;var h=e.toString(),l=Object(i.a)({},this.indexSet_);l[h]=e;var f=Object(i.a)({},this.indexes_);return f[h]=r,new t(f,l)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(Object(o.B)(this.indexes_,function(t,i){var a=Object(o.D)(r.indexSet_,i);if(Object(o.f)(a,"Missing index implementation for "+i),t===Mt){if(a.isDefinedOn(e.node)){for(var s=[],u=n.getIterator(dt.Wrap),c=u.getNext();c;)c.name!==e.name&&s.push(c),c=u.getNext();return s.push(e),Pt(s,a.getCompare())}return Mt}var h=n.get(e.name),l=t;return h&&(l=l.remove(new dt(e.name,h))),l.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(Object(o.B)(this.indexes_,function(t){if(t===Mt)return t;var r=n.get(e.name);return r?t.remove(new dt(e.name,r)):t}),this.indexSet_)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function xt(t,e){return N(t.name,e.name)}function jt(t,e){return N(t,e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ft=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Tt(this.priorityNode_),this.children_.isEmpty()&&Object(o.f)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return It||(It=new t(new Dt(jt),null,Lt.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||It},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?It:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(Object(o.f)(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new dt(e,n),i=void 0,a=void 0;n.isEmpty()?(i=this.children_.remove(e),a=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),a=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?It:this.priorityNode_;return new t(i,s,a)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;Object(o.f)(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Ct,function(a,s){n[a]=s.val(e),r++,o&&t.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),!e&&o&&i<2*r){var a=[];for(var s in n)a[s]=n[s];return a}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+_t(this.getPriority().val())+":"),this.forEachChild(Ct,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":m(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new dt(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new dt(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new dt(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,dt.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,dt.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ut?-1:0},t.prototype.withIndex=function(e){if(e===yt||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===yt||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(Ct),r=e.getIterator(Ct),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===yt?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),Ut=new(function(t){function e(){return t.call(this,new Dt(jt),Ft.EMPTY_NODE,Lt.Default)||this}return Object(i.c)(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Ft.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Ft));Object.defineProperties(dt,{MIN:{value:new dt(C,Ft.EMPTY_NODE)},MAX:{value:new dt(O,Ut)}}),gt.__EMPTY_NODE=Ft.EMPTY_NODE,Et.__childrenNodeConstructor=Ft,z=Ut,function(t){wt=t}(Ut);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Vt=!0;function qt(t,e){if(void 0===e&&(e=null),null===t)return Ft.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),Object(o.f)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Et(t,qt(e));if(t instanceof Array||!Vt){var n=Ft.EMPTY_NODE;return P(t,function(e,r){if(Object(o.j)(t,e)&&"."!==e.substring(0,1)){var i=qt(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}}),n.updatePriority(qt(e))}var r=[],i=!1;if(P(t,function(t,e){if("."!==t.substring(0,1)){var n=qt(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new dt(t,n)))}}),0===r.length)return Ft.EMPTY_NODE;var a=Pt(r,xt,function(t){return t.name},jt);if(i){var s=Pt(r,Ct.getCompare());return new Ft(a,qt(e),new Lt({".priority":s},{".priority":Ct}))}return new Ft(a,qt(e),Lt.Default)}!function(t){bt=t}(qt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Bt,Wt,Kt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?N(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return dt.MIN},e.prototype.maxPost=function(){return dt.MAX},e.prototype.makePost=function(t,e){var n=qt(t);return new dt(e,n)},e.prototype.toString=function(){return".value"},e}(mt)),Ht=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,Object(o.f)(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(i.c)(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?N(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=qt(t),r=Ft.EMPTY_NODE.updateChild(this.indexPath_,n);return new dt(e,r)},e.prototype.maxPost=function(){var t=Ft.EMPTY_NODE.updateChild(this.indexPath_,Ut);return new dt(O,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(mt),Qt=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return Object(o.H)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return Object(o.H)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return Object(o.H)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return Object(o.H)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){Object(o.H)("DataSnapshot.child",0,1,arguments.length),e=String(e),ut("DataSnapshot.child",1,e,!1);var n=new V(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,Ct)},t.prototype.hasChild=function(t){Object(o.H)("DataSnapshot.hasChild",1,1,arguments.length),ut("DataSnapshot.hasChild",1,t,!1);var e=new V(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return Object(o.H)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;return Object(o.H)("DataSnapshot.forEach",1,1,arguments.length),Object(o.I)("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return e(new t(i,n.ref_.child(r),Ct))})},t.prototype.hasChildren=function(){return Object(o.H)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return Object(o.H)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return Object(o.H)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Gt=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(o.G)(this.snapshot.exportVal())},t}(),zt=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Yt=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Gt("value",this,new Qt(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Object(o.f)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new zt(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Xt=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Object(o.j)(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new zt(this,t,e):null},t.prototype.createEvent=function(t,e){Object(o.f)(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Gt(t.type,this,new Qt(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Object(o.f)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){var n=this;if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var r=Object.keys(e.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var a=r[0],s=i[0];return!(s!==a||e.callbacks_[a]&&this.callbacks_[s]&&e.callbacks_[a]!==this.callbacks_[s])}return i.every(function(t){return e.callbacks_[t]===n.callbacks_[t]})}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Jt=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return Object(o.f)(Bt,"Reference.ts has not been loaded"),Bt},set:function(t){Bt=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===yt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==C)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==O)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Ct){if(null!=e&&!et(e)||null!=n&&!et(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(o.f)(t.getIndex()instanceof Ht||t.getIndex()===Kt,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return Object(o.H)("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){Object(o.H)("Query.on",2,4,arguments.length),at("Query.on",1,e,!1),Object(o.I)("Query.on",2,n,!1);var a=t.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(n,a.cancel,a.context);else{var s={};s[e]=n,this.onChildEvent(s,a.cancel,a.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Yt(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new Xt(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){Object(o.H)("Query.off",0,3,arguments.length),at("Query.off",1,t,!0),Object(o.I)("Query.off",2,e,!0),Object(o.J)("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Yt(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Xt(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var a=this;Object(o.H)("Query.once",1,4,arguments.length),at("Query.once",1,e,!1),Object(o.I)("Query.once",2,n,!0);var s=t.getCancelAndContextArgs_("Query.once",r,i),u=!0,c=new o.b;c.promise.catch(function(){});var h=function(t){u&&(u=!1,a.off(e,h),n&&n.bind(s.context)(t),c.resolve(t))};return this.on(e,h,function(t){a.off(e,h),s.cancel&&s.cancel.bind(s.context)(t),c.reject(t)}),c.promise},t.prototype.limitToFirst=function(e){if(Object(o.H)("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(Object(o.H)("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(Object(o.H)("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ut("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new V(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Ht(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){Object(o.H)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(yt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){Object(o.H)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(Ct);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){Object(o.H)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Kt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),Object(o.H)("Query.startAt",0,2,arguments.length),nt("Query.startAt",1,e,this.path,!0),st("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),Object(o.H)("Query.endAt",0,2,arguments.length),nt("Query.endAt",1,e,this.path,!0),st("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(Object(o.H)("Query.equalTo",1,2,arguments.length),nt("Query.equalTo",1,t,this.path,!1),st("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return Object(o.H)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return Object(o.H)("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=k(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(Object(o.H)("Query.isEqual",1,1,arguments.length),!(e instanceof t)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var n=this.repo===e.repo,r=this.path.equals(e.path),i=this.queryIdentifier()===e.queryIdentifier();return n&&r&&i},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Object(o.I)(t,3,r.cancel,!0),r.context=n,Object(o.J)(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Object(o.n)(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),$t=function(){function t(){this.value=null,this.children=new Map}return t.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&this.children.size>0){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,n);else{var r=e.getFront();this.children.has(r)||this.children.set(r,new t);var i=this.children.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Ct,function(t,e){n.remember(new V(t),e)}),this.forget(t)}if(this.children.size>0){var r=t.getFront();if(t=t.popFront(),this.children.has(r))this.children.get(r).forget(t)&&this.children.delete(r);return 0===this.children.size}return!0},t.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild(function(n,r){var i=new V(t.toString()+"/"+n);r.forEachTree(i,e)})},t.prototype.forEachChild=function(t){this.children.forEach(function(e,n){t(n,e)})},t}(),Zt=function(t,e){return t&&"object"==typeof t?(Object(o.f)(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},te=function(t,e){var n,r=t.getPriority().val(),i=Zt(r,e);if(t.isLeafNode()){var o=t,a=Zt(o.getValue(),e);return a!==o.getValue()||i!==o.getPriority().val()?new Et(a,qt(i)):t}var s=t;return n=s,i!==s.getPriority().val()&&(n=n.updatePriority(new Et(i))),s.forEachChild(Ct,function(t,r){var i=te(r,e);i!==r&&(n=n.updateImmediateChild(t,i))}),n};!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Wt||(Wt={}));var ee,ne,re=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,Object(o.f)(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),ie=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Wt.ACK_USER_WRITE,this.source=re.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(o.f)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new V(e));return new t(V.Empty,n,this.revert)}return Object(o.f)(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),oe=function(){return ee||(ee=new Dt(A)),ee},ae=function(){function t(t,e){void 0===e&&(e=oe()),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return P(e,function(t,e){n=n.set(new V(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:V.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new V(n).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r=e.getFront(),i=(this.children.get(r)||t.Empty).setTree(e.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new t(this.value,o)},t.prototype.fold=function(t){return this.fold_(V.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,V.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,V.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(V.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t.Empty=new t(null),t}(),se=function(){function t(t,e){this.source=t,this.path=e,this.type=Wt.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,V.Empty):new t(this.source,this.path.popFront())},t}(),ue=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Wt.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,V.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),ce=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Wt.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new V(e));return n.isEmpty()?null:n.value?new ue(this.source,V.Empty,n.value):new t(this.source,V.Empty,n)}return Object(o.f)(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),he=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),le=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new he(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new he(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new he(Ft.EMPTY_NODE,!1,!1),new he(Ft.EMPTY_NODE,!1,!1)),t}(),fe=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),pe=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,a){Object(o.f)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=t.getImmediateChild(e);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?t:(null!=a&&(n.isEmpty()?t.hasChild(e)?a.trackChildChange(fe.childRemovedChange(e,s)):Object(o.f)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?a.trackChildChange(fe.childAddedChange(e,n)):a.trackChildChange(fe.childChangedChange(e,n,s))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Ct,function(t,r){e.hasChild(t)||n.trackChildChange(fe.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(Ct,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(fe.childChangedChange(e,r,i))}else n.trackChildChange(fe.childAddedChange(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Ft.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),de=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;Object(o.f)(e===fe.CHILD_ADDED||e===fe.CHILD_CHANGED||e===fe.CHILD_REMOVED,"Only child changes supported for tracking"),Object(o.f)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e===fe.CHILD_ADDED&&i===fe.CHILD_REMOVED)this.changeMap.set(n,fe.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e===fe.CHILD_REMOVED&&i===fe.CHILD_ADDED)this.changeMap.delete(n);else if(e===fe.CHILD_REMOVED&&i===fe.CHILD_CHANGED)this.changeMap.set(n,fe.childRemovedChange(n,r.oldSnap));else if(e===fe.CHILD_CHANGED&&i===fe.CHILD_ADDED)this.changeMap.set(n,fe.childAddedChange(n,t.snapshotNode));else{if(e!==fe.CHILD_CHANGED||i!==fe.CHILD_CHANGED)throw Object(o.g)("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,fe.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),me=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),ge=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new he(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),ye=function(){return function(t,e){this.viewCache=t,this.changes=e}}(),ve=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){Object(o.f)(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(o.f)(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,i){var a,s,u=new de;if(n.type===Wt.OVERWRITE){var c=n;c.source.fromUser?a=this.applyUserOverwrite_(e,c.path,c.snap,r,i,u):(Object(o.f)(c.source.fromServer,"Unknown source."),s=c.source.tagged||e.getServerCache().isFiltered()&&!c.path.isEmpty(),a=this.applyServerOverwrite_(e,c.path,c.snap,r,i,s,u))}else if(n.type===Wt.MERGE){var h=n;h.source.fromUser?a=this.applyUserMerge_(e,h.path,h.children,r,i,u):(Object(o.f)(h.source.fromServer,"Unknown source."),s=h.source.tagged||e.getServerCache().isFiltered(),a=this.applyServerMerge_(e,h.path,h.children,r,i,s,u))}else if(n.type===Wt.ACK_USER_WRITE){var l=n;a=l.revert?this.revertUserWrite_(e,l.path,r,i,u):this.ackUserWrite_(e,l.path,l.affectedTree,r,i,u)}else{if(n.type!==Wt.LISTEN_COMPLETE)throw Object(o.g)("Unknown operation type: "+n.type);a=this.listenComplete_(e,n.path,r,u)}var f=u.getChanges();return t.maybeAddValueEvent_(e,a,f),new ye(a,f)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(fe.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var a=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var s=void 0,u=void 0;if(e.isEmpty())if(Object(o.f)(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var c=t.getCompleteServerSnap(),h=c instanceof Ft?c:Ft.EMPTY_NODE,l=n.calcCompleteEventChildren(h);s=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=n.calcCompleteEventCache(t.getCompleteServerSnap());s=this.filter_.updateFullNode(t.getEventCache().getNode(),f,i)}else{var p=e.getFront();if(".priority"===p){Object(o.f)(1===e.getLength(),"Can't have a priority with additional path components");var d=a.getNode();u=t.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(e,d,u);s=null!=m?this.filter_.updatePriority(d,m):a.getNode()}else{var g=e.popFront(),y=void 0;if(a.isCompleteForChild(p)){u=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,a.getNode(),u);y=null!=v?a.getNode().getImmediateChild(p).updateChild(g,v):a.getNode().getImmediateChild(p)}else y=n.calcCompleteChild(p,t.getServerCache());s=null!=y?this.filter_.updateChild(a.getNode(),p,y,g,r,i):a.getNode()}}return t.updateEventSnap(s,a.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&e.getLength()>1)return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"===l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,me,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),m=new ge(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,m,a)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new ge(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Ft.EMPTY_NODE}if(f.equals(p))a=t;else{var m=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(m,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,a){var s=this,u=e;return r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())&&(u=s.applyUserOverwrite_(u,h,c,i,o,a))}),r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())||(u=s.applyUserOverwrite_(u,h,c,i,o,a))}),u},t.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:ae.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal(function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new V(e),l,r,i,o,a)}}),u.children.inorderTraversal(function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new V(e),f,r,i,o,a)}}),c},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=ae.Empty;return s.getNode().forEachChild(yt,function(t,e){u=u.set(new V(t),e)}),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=ae.Empty;return n.foreach(function(t,n){var r=e.child(t);s.isCompleteForPath(r)&&(c=c.set(t,s.getNode().getChild(r)))}),this.applyServerMerge_(t,e,c,r,i,a,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,me,r)},t.prototype.revertUserWrite_=function(t,e,n,r,i){var a;if(null!=n.shadowingWrite(e))return t;var s=new ge(n,t,r),u=t.getEventCache().getNode(),c=void 0;if(e.isEmpty()||".priority"===e.getFront()){var h=void 0;if(t.getServerCache().isFullyInitialized())h=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var l=t.getServerCache().getNode();Object(o.f)(l instanceof Ft,"serverChildren would be complete if leaf node"),h=n.calcCompleteEventChildren(l)}h=h,c=this.filter_.updateFullNode(u,h,i)}else{var f=e.getFront(),p=n.calcCompleteChild(f,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(f)&&(p=u.getImmediateChild(f)),(c=null!=p?this.filter_.updateChild(u,f,p,e.popFront(),s,i):t.getEventCache().getNode().hasChild(f)?this.filter_.updateChild(u,f,Ft.EMPTY_NODE,e.popFront(),s,i):u).isEmpty()&&t.getServerCache().isFullyInitialized()&&(a=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(c=this.filter_.updateFullNode(c,a,i))}return a=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(V.Empty),t.updateEventSnap(c,a,this.filter_.filtersNodes())},t}(),be=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===fe.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(fe.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,fe.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,fe.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,fe.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,fe.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,fe.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter(function(t){return t.type===e});a.sort(this.compareChanges_.bind(this)),a.forEach(function(e){var n=o.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t)},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw Object(o.g)("Should only compare child_ events.");var n=new dt(t.childName,t.snapshotNode),r=new dt(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),we=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new pe(n.getIndex()),i=n.getNodeFilter();this.processor_=new ve(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(Ft.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ft.EMPTY_NODE,a.getNode(),null),c=new he(s,o.isFullyInitialized(),r.filtersNodes()),h=new he(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new le(h,c),this.eventGenerator_=new be(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){Object(o.f)(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var i=[],a=0;a<this.eventRegistrations_.length;++a){var s=this.eventRegistrations_[a];if(s.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(a+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===Wt.MERGE&&null!==t.source.queryId&&(Object(o.f)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(o.f)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),Object(o.f)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Ct,function(t,e){n.push(fe.childAddedChange(t,e))});return e.isFullyInitialized()&&n.push(fe.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),_e=function(){function t(){this.views=new Map}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return Object(o.f)(ne,"Reference.ts has not been loaded"),ne},set:function(t){Object(o.f)(!ne,"__referenceConstructor has already been defined"),ne=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.views.size},t.prototype.applyOperation=function(t,e,n){var r,a,s=t.source.queryId;if(null!==s){var u=this.views.get(s);return Object(o.f)(null!=u,"SyncTree gave us an op for an invalid query."),u.applyOperation(t,e,n)}var c=[];try{for(var h=Object(i.h)(this.views.values()),l=h.next();!l.done;l=h.next()){u=l.value;c=c.concat(u.applyOperation(t,e,n))}}catch(t){r={error:t}}finally{try{l&&!l.done&&(a=h.return)&&a.call(h)}finally{if(r)throw r.error}}return c},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;s?u=!0:r instanceof Ft?(s=n.calcCompleteEventChildren(r),u=!1):(s=Ft.EMPTY_NODE,u=!1);var c=new le(new he(s,u,!1),new he(r,i,!1));a=new we(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var o,a,s=e.queryIdentifier(),u=[],c=[],h=this.hasCompleteView();if("default"===s)try{for(var l=Object(i.h)(this.views.entries()),f=l.next();!f.done;f=l.next()){var p=Object(i.e)(f.value,2),d=p[0],m=p[1];c=c.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(d),m.getQuery().getQueryParams().loadsAllData()||u.push(m.getQuery()))}}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}else(m=this.views.get(s))&&(c=c.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(s),m.getQuery().getQueryParams().loadsAllData()||u.push(m.getQuery())));return h&&!this.hasCompleteView()&&u.push(new t.__referenceConstructor(e.repo,e.path)),{removed:u,events:c}},t.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=Object(i.h)(this.views.values()),o=r.next();!o.done;o=r.next()){var a=o.value;a.getQuery().getQueryParams().loadsAllData()||n.push(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var o=Object(i.h)(this.views.values()),a=o.next();!a.done;a=o.next()){var s=a.value;r=r||s.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;try{for(var n=Object(i.h)(this.views.values()),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.getQuery().getQueryParams().loadsAllData())return o}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},t}(),Te=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new ae(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,a=V.relativePath(i,e);return o=o.updateChild(a,n),new t(this.writeTree_.set(i,o))}var s=new ae(n);return new t(this.writeTree_.setTree(e,s))},t.prototype.addWrites=function(t,e){var n=this;return P(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,ae.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(V.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ct,function(e,n){t.push(new dt(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new dt(e,n.value))}),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new ae(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal(function(n,a){".priority"===n?(Object(o.f)(null!==a.value,"Priority writes must always be leaf nodes"),i=a.value):r=t(e.child(n),a,r)}),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(V.Empty,this.writeTree_,t)},t.Empty=new t(new ae(null)),t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ee=function(){function t(){this.visibleWrites_=Te.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Se(t,this)},t.prototype.addOverwrite=function(t,e,n,r){Object(o.f)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){Object(o.f)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});Object(o.f)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,a=!1,s=this.allWrites_.length-1;i&&s>=0;){var u=this.allWrites_[s];u.visible&&(s>=n&&this.recordContainsPath_(u,r.path)?i=!1:r.path.contains(u.path)&&(a=!0)),s--}if(i){if(a)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):P(r.children,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))});return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(V.Empty)){var a=t.layerTree_(this.allWrites_,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);c=n||Ft.EMPTY_NODE;return a.apply(c)}return null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var u=this.visibleWrites_.childCompoundWrite(e);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(V.Empty)){var c=n||Ft.EMPTY_NODE;return u.apply(c)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=Ft.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Ct,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ct,function(t,e){var r=i.childCompoundWrite(new V(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){Object(o.f)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var a=this.visibleWrites_.childCompoundWrite(i);return a.isEmpty()?r.getChild(e):a.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(V.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},t.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,V.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=Te.Empty,i=0;i<t.length;++i){var a=t[i];if(e(a)){var s=a.path,u=void 0;if(a.snap)n.contains(s)?(u=V.relativePath(n,s),r=r.addWrite(u,a.snap)):s.contains(n)&&(u=V.relativePath(s,n),r=r.addWrite(V.Empty,a.snap.getChild(u)));else{if(!a.children)throw Object(o.g)("WriteRecord should have .snap or .children");if(n.contains(s))u=V.relativePath(n,s),r=r.addWrites(u,a.children);else if(s.contains(n))if((u=V.relativePath(s,n)).isEmpty())r=r.addWrites(V.Empty,a.children);else{var c=Object(o.D)(a.children,u.getFront());if(c){var h=c.getChild(u.popFront());r=r.addWrite(V.Empty,h)}}}}}return r},t}(),Se=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),Ie=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=ae.Empty,this.pendingWriteTree_=new Ee,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new ue(re.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=ae.fromObject(e);return this.applyOperationToSyncPoints_(new ce(re.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=ae.Empty;return null!=n.snap?r=r.set(V.Empty,!0):P(n.children,function(t,e){r=r.set(new V(t),e)}),this.applyOperationToSyncPoints_(new ie(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new ue(re.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=ae.fromObject(e);return this.applyOperationToSyncPoints_(new ce(re.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new se(re.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=V.relativePath(a,e),c=new ue(re.forServerTaggedQuery(s),u,n);return this.applyTaggedOperation_(a,c)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=V.relativePath(a,e),c=ae.fromObject(n),h=new ce(re.forServerTaggedQuery(s),u,c);return this.applyTaggedOperation_(a,h)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,a=i.queryId,s=V.relativePath(o,e),u=new se(re.forServerTaggedQuery(a),s);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,a=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=V.relativePath(t,r);i=i||e.getCompleteServerCache(n),a=a||e.hasCompleteView()});var s,u=this.syncPointTree_.get(r);(u?(a=a||u.hasCompleteView(),i=i||u.getCompleteServerCache(V.Empty)):(u=new _e,this.syncPointTree_=this.syncPointTree_.set(r,u)),null!=i)?s=!0:(s=!1,i=Ft.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(V.Empty);n&&(i=i.updateImmediateChild(t,n))}));var c=u.viewExistsForQuery(e);if(!c&&!e.getQueryParams().loadsAllData()){var h=t.makeQueryKey_(e);Object(o.f)(!this.queryToTagMap.has(h),"View does not exist, but we have a tag");var l=t.getNextQueryTag_();this.queryToTagMap.set(h,l),this.tagToQueryMap.set(l,h)}var f=this.pendingWriteTree_.childWrites(r),p=u.addEventRegistration(e,n,f,i,s);if(!c&&!a){var d=u.viewForQuery(e);p=p.concat(this.setupListener_(e,d))}return p},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,a=this.syncPointTree_.get(o),s=[];if(a&&("default"===e.queryIdentifier()||a.viewExistsForQuery(e))){var u=a.removeEventRegistration(e,n,r);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;s=u.events;var h=-1!==c.findIndex(function(t){return t.getQueryParams().loadsAllData()}),l=this.syncPointTree_.findOnPath(o,function(t,e){return e.hasCompleteView()});if(h&&!l){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var m=p[d],g=m.getQuery(),y=this.createListenerForView_(m);this.listenProvider_.startListening(t.queryForListening_(g),this.tagForQuery_(g),y.hashFn,y.onComplete)}}if(!l&&c.length>0&&!r)if(h){this.listenProvider_.stopListening(t.queryForListening_(e),null)}else c.forEach(function(e){var n=i.queryToTagMap.get(t.makeQueryKey_(e));i.listenProvider_.stopListening(t.queryForListening_(e),n)});this.removeTags_(c)}return s},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=V.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),P(n,function(t,e){r=r.concat(e)}),r})},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),a=this.createListenerForView_(n),s=this.listenProvider_.startListening(t.queryForListening_(e),i,a.hashFn,a.onComplete),u=this.syncPointTree_.subtree(r);if(i)Object(o.f)(!u.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var c=u.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),P(n,function(t,e){r=r.concat(e)}),r}),h=0;h<c.length;++h){var l=c[h];this.listenProvider_.stopListening(t.queryForListening_(l),this.tagForQuery_(l))}return s},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Ft.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return Object(o.f)(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new V(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return this.queryToTagMap.get(n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);Object(o.f)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(V.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(V.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(V.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(V.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(V.Empty));var a=[];return e.children.inorderTraversal(function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))}),o&&(a=a.concat(o.applyOperation(t,r,n))),a},t.nextQueryTag_=1,t}(),Ce=function(){function t(){this.rootNode_=Ft.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),Oe=function(){function t(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then(function(t){return n.auth_=t})}return t.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch(function(t){return t&&"auth/token-not-initialized"===t.code?(w("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)}):Promise.resolve(null)},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout(function(){return t(null)},0),this.authProvider_.get().then(function(e){return e.addAuthTokenListener(t)}))},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then(function(e){return e.removeAuthTokenListener(t)})},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',S(t)},t}(),Ne=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Object(o.j)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return Object(o.l)(this.counters_)},t}(),Ae=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Ne),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),De=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=Object(i.a)({},t);return this.last_&&P(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),ke=1e4,Re=3e4,Pe=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new De(t);var n=ke+(Re-ke)*Math.random();U(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;P(e,function(e,i){i>0&&Object(o.j)(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),U(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Me=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Le(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Le=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();y&&w("event: "+e.toString()),j(n)}}},t.prototype.getPath=function(){return this.path_},t}(),xe=function(){function t(t){this.allowedEvents_=t,this.listeners_={},Object(o.f)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=Object(i.f)(this.listeners_[t]),o=0;o<r.length;o++)r[o].callback.apply(r[o].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){Object(o.f)(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),je=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return Object(i.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(o.f)("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(xe),Fe=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(o.u)()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return Object(i.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(o.f)("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(xe),Ue=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&j(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},t}(),Ve="pLPCommand",qe="pRTLPCB",Be=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=_(t),this.stats_=Ae.getCollection(e),this.urlFn=function(t){return e.connectionURL(B,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Ue(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(Object(o.w)()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new We(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(i.e)(t,5),o=r[0],a=r[1],s=r[2];r[3],r[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===o)n.id=a,n.password=s;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(i.e)(t,2),o=r[0],a=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(o,a)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!Object(o.w)()&&(!!t.forceAllow_||!(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=Object(o.G)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=Object(o.i)(e),r=R(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!Object(o.w)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=Object(o.G)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),We=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(o.w)())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=d(),window[Ve+this.uniqueCallbackIdentifier]=e,window[qe+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))a='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(t){w("frame writing exception"),t.stack&&w(t.stack),w(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||w("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},t.prototype.addTag=function(t,e){var n=this;Object(o.w)()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){w("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},t}(),Ke="";
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var He=null;"undefined"!=typeof MozWebSocket?He=MozWebSocket:"undefined"!=typeof WebSocket&&(He=WebSocket);var Qe=function(){function t(e,n,r,i){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=_(this.connId),this.stats_=Ae.getCollection(n),this.connURL=t.connectionURL_(n,r,i)}return t.connectionURL_=function(t,e,n){var r={v:"5"};return!Object(o.w)()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL("websocket",r)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,l.set("previous_websocket_failure",!0);try{if(Object(o.w)()){var r=o.a.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+Ke+"/"+process.platform+"/"+r}},a=process.env,s=0===this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;s&&(i.proxy={origin:s}),this.mySock=new He(this.connURL,[],i)}else this.mySock=new He(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var u=t.message||t.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==He&&!t.forceDisallow_},t.previouslyFailed=function(){return l.isInMemoryStorage||!0===l.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){l.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Object(o.A)(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(Object(o.f)(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=Object(o.G)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=R(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Ge=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[Be,Qe]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var n,r,o=Qe&&Qe.isAvailable(),a=o&&!Qe.previouslyFailed();if(e.webSocketOnly&&(o||S("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[Qe];else{var s=this.transports_=[];try{for(var u=Object(i.h)(t.ALL_TRANSPORTS),c=u.next();!c.done;c=u.next()){var h=c.value;h&&h.isAvailable()&&s.push(h)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),ze=function(){function t(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=_("c:"+this.id+":"),this.transportManager_=new Ge(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=U(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=D("t",t),n=D("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=D("t",t),n=D("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=D("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?T("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):T("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&S("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),U(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):U(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(l.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Ye=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Xe=1e3,Je=3e5,$e=function(t){function e(n,r,i,a,s,u){var c=t.call(this)||this;if(c.repoInfo_=n,c.onDataUpdate_=r,c.onConnectStatus_=i,c.onServerInfoUpdate_=a,c.authTokenProvider_=s,c.authOverride_=u,c.id=e.nextPersistentConnectionId_++,c.log_=_("p:"+c.id+":"),c.interruptReasons_={},c.listens=new Map,c.outstandingPuts_=[],c.outstandingPutCount_=0,c.onDisconnectRequestQueue_=[],c.connected_=!1,c.reconnectDelay_=Xe,c.maxReconnectDelay_=Je,c.securityDebugCallback_=null,c.lastSessionId=null,c.establishConnectionTimer_=null,c.visible_=!1,c.requestCBHash_={},c.requestNumber_=0,c.realtime_=null,c.authToken_=null,c.forceTokenRefresh_=!1,c.invalidAuthTokenCount_=0,c.firstConnection_=!0,c.lastConnectionAttemptTime_=null,c.lastConnectionEstablishedTime_=null,u&&!Object(o.w)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return c.scheduleConnect_(0),je.getInstance().on("visible",c.onVisible_,c),-1===n.host.indexOf("fblocal")&&Fe.getInstance().on("online",c.onOnline_,c),c}return Object(i.c)(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Object(o.G)(i)),Object(o.f)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),a=t.path.toString();this.log_("Listen called for "+a+" "+i),this.listens.has(a)||this.listens.set(a,new Map),Object(o.f)(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(o.f)(!this.listens.get(a).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(a).set(i,s),this.connected_&&this.sendListen_(s)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};t.tag&&(a.q=r.queryObject(),a.t=t.tag),a.h=t.hashFn(),this.sendRequest("q",a,function(a){var s=a.d,u=a.s;e.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(o))===t&&(n.log_("listen response",a),"ok"!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,s))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Object(o.j)(t,"w")){var n=Object(o.D)(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();S("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||Object(o.p)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=Object(o.z)(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))})}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(o.f)(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Object(o.G)(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):T("Unrecognized action received from server: "+Object(o.G)(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;Object(o.f)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Xe,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Xe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Xe),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,a=this,s=this.lastSessionId,u=!1,c=null,h=function(){c?c.close():(u=!0,r())};this.realtime_={close:h,sendRequest:function(t){Object(o.f)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(t)}};var l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(l).then(function(e){u?w("getToken() completed but was canceled"):(w("getToken() completed. Creating connection."),a.authToken_=e&&e.accessToken,c=new ze(i,a.repoInfo_,t,n,r,function(t){S(t+" ("+a.repoInfo_.toString()+")"),a.interrupt("server_kill")},s))}).then(null,function(t){a.log_("Failed to get token: "+t),u||(o.a.NODE_ADMIN&&S(t),h())})}},e.prototype.interrupt=function(t){w("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){w("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Object(o.s)(this.interruptReasons_)&&(this.reconnectDelay_=Xe,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return k(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new V(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},e.prototype.onAuthRevoked_=function(t,e){w("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var o=Object(i.h)(this.listens.values()),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,Object(i.h)(s.values())),c=u.next();!c.done;c=u.next()){var h=c.value;this.sendListen_(h)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}for(var l=0;l<this.outstandingPuts_.length;l++)this.outstandingPuts_[l]&&this.sendPut_(l);for(;this.onDisconnectRequestQueue_.length;){var f=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(f.action,f.pathString,f.data,f.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";o.a.NODE_ADMIN?e="admin_node":o.a.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+Ke.replace(/\./g,"-")]=1,Object(o.u)()?t["framework.cordova"]=1:Object(o.x)()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=Fe.getInstance().currentlyOnline();return Object(o.s)(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Ye),Ze=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=_("p:rest:"),i.listens_={},i}return Object(i.c)(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(Object(o.f)(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var a=this,s=t.path.toString();this.log_("Listen called for "+s+" "+t.queryIdentifier());var u=e.getListenId_(t,r),c={};this.listens_[u]=c;var h=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",h,function(t,e){var n=e;(404===t&&(n=null,t=null),null===t&&a.onDataUpdate_(s,n,!1,r),Object(o.D)(a.listens_,u)===c)&&i(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var a=i&&i.accessToken;a&&(e.auth=a);var s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+Object(o.C)(e);r.log_("Sending REST request for "+s);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+s+" received. status:",u.status,"response:",u.responseText);var t=null;if(u.status>=200&&u.status<300){try{t=Object(o.A)(u.responseText)}catch(t){S("Failed to parse JSON response for "+s+": "+u.responseText)}n(null,t)}else 401!==u.status&&404!==u.status&&S("Got unsuccessful REST response for "+s+" Status: "+u.status),n(u.status);n=null}},u.open("GET",s,!0),u.send()})},e}(Ye),tn=function(){function t(t,e,n,r){var i=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Me,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new $t,this.persistentConnection_=null;var a=new Oe(n,r);if(this.stats_=Ae.getCollection(t),e||F())this.server_=new Ze(this.repoInfo_,this.onDataUpdate_.bind(this),a),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=n.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(o.G)(s)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new $e(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),a,s),this.server_=this.persistentConnection_}a.addTokenChangeListener(function(t){i.server_.refreshAuthToken(t)}),this.statsReporter_=Ae.getOrCreateReporter(t,function(){return new Pe(i.stats_,i.server_)}),this.transactionsInit_(),this.infoData_=new Ce,this.infoSyncTree_=new Ie({startListening:function(t,e,n,r){var o=[],a=i.infoData_.getNode(t.path);return a.isEmpty()||(o=i.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout(function(){r("ok")},0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Ie({startListening:function(t,e,n,r){return i.server_.listen(t,n,e,function(e,n){var o=r(e,n);i.eventQueue_.raiseEventsForChangedPath(t.path,o)}),[]},stopListening:function(t,e){i.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new V(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new V(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var a=[];if(r)if(n){var s=Object(o.B)(e,function(t){return qt(t)});a=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var u=qt(e);a=this.serverSyncTree_.applyTaggedQueryOverwrite(i,u,r)}else if(n){var c=Object(o.B)(e,function(t){return qt(t)});a=this.serverSyncTree_.applyServerMerge(i,c)}else{var h=qt(e);a=this.serverSyncTree_.applyServerOverwrite(i,h)}var l=i;a.length>0&&(l=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(l,a)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;P(t,function(t,n){e.updateInfo_(t,n)})},t.prototype.updateInfo_=function(t,e){var n=new V("/.info/"+t),r=qt(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=qt(e,n),s=te(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),function(e,n){var o="ok"===e;o||S("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)});var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(P(e,function(t,e){i=!1;var n=qt(e);a[t]=te(n,o)}),i)w("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||S("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=a.length>0?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)}),P(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=function(t,e){var n=new $t;return t.forEachTree(new V(""),function(t,r){n.remember(t,te(r,e))}),n}(this.onDisconnect_,e),r=[];n.forEachTree(V.Empty,function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)}),this.onDisconnect_=new $t,this.eventQueue_.raiseEventsForChangedPath(V.Empty,r)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=qt(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)})},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=qt(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)})},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Object(o.s)(e))return w("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&P(e,function(e,n){var i=qt(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,i,o)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new De(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);P(e,function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),w.apply(void 0,Object(i.f)([n],t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&j(function(){if("ok"===e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new ln(this))},enumerable:!0,configurable:!0}),t}(),en=function(){function t(e){this.indexedFilter_=new pe(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new dt(e,n))||(n=Ft.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Ft.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Ft.EMPTY_NODE);var i=this;return e.forEachChild(Ct,function(t,e){i.matches(new dt(t,e))||(r=r.updateImmediateChild(t,Ft.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),nn=function(){function t(t){this.rangedFilter_=new en(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new dt(e,n))||(n=Ft.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Ft.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Ft.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Ft.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();){a=i.getNext();!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,Ft.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var a;if(this.reverse_){var s=this.index_.getCompare();a=function(t,e){return s(e,t)}}else a=this.index_.getCompare();var u=t;Object(o.f)(u.numChildren()===this.limit_,"");var c=new dt(e,n),h=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(u.hasChild(e)){for(var f=u.getImmediateChild(e),p=r.getChildAfterChild(this.index_,h,this.reverse_);null!=p&&(p.name===e||u.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:a(p,c);if(l&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(fe.childChangedChange(e,n,f)),u.updateImmediateChild(e,n);null!=i&&i.trackChildChange(fe.childRemovedChange(e,f));var m=u.updateImmediateChild(e,Ft.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(fe.childAddedChange(p.name,p.node)),m.updateImmediateChild(p.name,p.node)):m}return n.isEmpty()?t:l&&a(h,c)>=0?(null!=i&&(i.trackChildChange(fe.childRemovedChange(h.name,h.node)),i.trackChildChange(fe.childAddedChange(e,n))),u.updateImmediateChild(e,n).updateImmediateChild(h.name,Ft.EMPTY_NODE)):t},t}(),rn=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ct}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return Object(o.f)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return Object(o.f)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:C},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return Object(o.f)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return Object(o.f)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:O},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return Object(o.f)(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==Ct&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Ct},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new pe(this.getIndex()):this.hasLimit()?new nn(this):new en(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===Ct?e=n.PRIORITY_INDEX:this.index_===Kt?e=n.VALUE_INDEX:this.index_===yt?e=n.KEY_INDEX:(Object(o.f)(this.index_ instanceof Ht,"Unrecognized index type!"),e=this.index_.toString()),r[n.ORDER_BY]=Object(o.G)(e),this.startSet_&&(r[n.START_AT]=Object(o.G)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(o.G)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(o.G)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(o.G)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r)},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),on=function(t){function e(e,n){if(!(e instanceof tn))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,rn.DEFAULT,!1)||this}return Object(i.c)(e,t),e.prototype.getKey=function(){return Object(o.H)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return Object(o.H)("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof V||(null===this.path.getFront()?function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ut(t,e,n,r)}("Reference.child",1,t,!1):ut("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){Object(o.H)("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){Object(o.H)("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){Object(o.H)("Reference.set",1,2,arguments.length),ct("Reference.set",this.path),nt("Reference.set",1,t,this.path,!1),Object(o.I)("Reference.set",2,e,!0);var n=new o.b;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(Object(o.H)("Reference.update",1,2,arguments.length),ct("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,S("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}it("Reference.update",1,t,this.path,!1),Object(o.I)("Reference.update",2,e,!0);var i=new o.b;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(Object(o.H)("Reference.setWithPriority",2,3,arguments.length),ct("Reference.setWithPriority",this.path),nt("Reference.setWithPriority",1,t,this.path,!1),ot("Reference.setWithPriority",2,e,!1),Object(o.I)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new o.b;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return Object(o.H)("Reference.remove",0,1,arguments.length),ct("Reference.remove",this.path),Object(o.I)("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(Object(o.H)("Reference.transaction",1,3,arguments.length),ct("Reference.transaction",this.path),Object(o.I)("Reference.transaction",1,t,!1),Object(o.I)("Reference.transaction",2,e,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(o.n)(t,e,r)+"must be a boolean.")}("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new o.b;"function"==typeof e&&r.promise.catch(function(){});return this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new ft(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},e.prototype.setPriority=function(t,e){Object(o.H)("Reference.setPriority",1,2,arguments.length),ct("Reference.setPriority",this.path),ot("Reference.setPriority",1,t,!1),Object(o.I)("Reference.setPriority",2,e,!0);var n=new o.b;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){Object(o.H)("Reference.push",0,2,arguments.length),ct("Reference.push",this.path),nt("Reference.push",1,t,this.path,!0),Object(o.I)("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=pt(r),a=this.child(i),s=this.child(i);return n=null!=t?a.set(t,e).then(function(){return s}):Promise.resolve(s),a.then=n.then.bind(n),a.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),a},e.prototype.onDisconnect=function(){return ct("Reference.onDisconnect",this.path),new lt(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Jt);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jt.__referenceConstructor=on,_e.__referenceConstructor=on;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var an,sn=function(){return function(){this.children={},this.childCount=0,this.value=null}}(),un=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new sn),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n=e instanceof V?e:new V(e),r=this,i=n.getFront();null!==i;){r=new t(i,r,Object(o.D)(r.node_.children,i)||new sn),i=(n=n.popFront()).getFront()}return r},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){Object(o.f)(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;P(this.node_.children,function(r,i){e(new t(r,n,i))})},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},t.prototype.path=function(){return new V(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Object(o.j)(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}(an||(an={})),tn.MAX_TRANSACTION_RETRIES_=25,tn.prototype.transactionsInit_=function(){this.transactionQueueTree_=new un},tn.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},a=new on(this,t);a.on("value",i);var s={path:t,update:e,onComplete:n,status:null,order:d(),applyLocally:r,retryCount:0,unwatcher:function(){a.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=this.getLatestState_(t);s.currentInputSnapshot=u;var c=s.update(u.val());if(void 0===c){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var h=new Qt(s.currentInputSnapshot,new on(this,s.path),Ct);s.onComplete(null,!1,h)}}else{rt("transaction failed: Data returned ",c,s.path),s.status=an.RUN;var l=this.transactionQueueTree_.subTree(t),f=l.getValue()||[];f.push(s),l.setValue(f);var p=void 0;if("object"==typeof c&&null!==c&&Object(o.j)(c,".priority"))p=Object(o.D)(c,".priority"),Object(o.f)(et(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(t)||Ft.EMPTY_NODE).getPriority().val();p=p;var m=this.generateServerValues(),g=qt(c,p),y=te(g,m);s.currentOutputSnapshotRaw=g,s.currentOutputSnapshotResolved=y,s.currentWriteId=this.getNextWriteId_();var v=this.serverSyncTree_.applyUserOverwrite(t,y,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,v),this.sendReadyTransactions_()}},tn.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Ft.EMPTY_NODE},tn.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);Object(o.f)(n.length>0,"Sending zero length transaction queue"),n.every(function(t){return t.status===an.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},tn.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),i=this.getLatestState_(t,r),a=i,s=i.hash(),u=0;u<e.length;u++){var c=e[u];Object(o.f)(c.status===an.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=an.SENT,c.retryCount++;var h=V.relativePath(t,c.path);a=a.updateChild(h,c.currentOutputSnapshotRaw)}var l=a.val(!0),f=t;this.server_.put(f.toString(),l,function(r){n.log_("transaction put response",{path:f.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=an.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new on(n,e[a].path),c=new Qt(s,u,Ct);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i);for(a=0;a<o.length;a++)j(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status===an.SENT_NEEDS_ABORT?e[a].status=an.NEEDS_ABORT:e[a].status=an.RUN;else{S("transaction at "+f.toString()+" failed: "+r);for(a=0;a<e.length;a++)e[a].status=an.NEEDS_ABORT,e[a].abortReason=r}n.rerunTransactions_(t)}},s)},tn.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},tn.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],a=t.filter(function(t){return t.status===an.RUN}).map(function(t){return t.currentWriteId}),s=0;s<t.length;s++){var u=t[s],c=V.relativePath(e,u.path),h=!1,l=void 0;if(Object(o.f)(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===an.NEEDS_ABORT)h=!0,l=u.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else if(u.status===an.RUN)if(u.retryCount>=tn.MAX_TRANSACTION_RETRIES_)h=!0,l="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else{var f=this.getLatestState_(u.path,a);u.currentInputSnapshot=f;var p=t[s].update(f.val());if(void 0!==p){rt("transaction failed: Data returned ",p,u.path);var d=qt(p);"object"==typeof p&&null!=p&&Object(o.j)(p,".priority")||(d=d.updatePriority(f.getPriority()));var m=u.currentWriteId,g=this.generateServerValues(),y=te(d,g);u.currentOutputSnapshotRaw=d,u.currentOutputSnapshotResolved=y,u.currentWriteId=this.getNextWriteId_(),a.splice(a.indexOf(m),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(u.path,y,u.currentWriteId,u.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(m,!0))}else h=!0,l="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],h&&(t[s].status=an.COMPLETED,n=t[s].unwatcher,setTimeout(n,Math.floor(0)),t[s].onComplete))if("nodata"===l){var v=new on(this,t[s].path),b=t[s].currentInputSnapshot,w=new Qt(b,v,Ct);r.push(t[s].onComplete.bind(null,null,!1,w))}else r.push(t[s].onComplete.bind(null,new Error(l),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<r.length;s++)j(r[s]);this.sendReadyTransactions_()}},tn.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n},tn.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},tn.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},tn.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==an.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(n.length>0?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},tn.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},tn.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,a=0;a<e.length;a++)if(e[a].status===an.SENT_NEEDS_ABORT);else if(e[a].status===an.SENT)Object(o.f)(i===a-1,"All SENT items should be at beginning of queue."),i=a,e[a].status=an.SENT_NEEDS_ABORT,e[a].abortReason="set";else if(Object(o.f)(e[a].status===an.RUN,"Unexpected transaction status in abort"),e[a].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[a].currentWriteId,!0)),e[a].onComplete){n.push(e[a].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(a=0;a<n.length;a++)j(n[a])}};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var cn,hn=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return cn||(cn=new t),cn},t.prototype.interrupt=function(){var t,e,n,r;try{for(var o=Object(i.h)(Object.keys(this.repos_)),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,Object(i.h)(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next()){var h=c.value;this.repos_[s][h].interrupt()}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t.prototype.resume=function(){var t,e,n,r;try{for(var o=Object(i.h)(Object.keys(this.repos_)),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var u=(n=void 0,Object(i.h)(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next()){var h=c.value;this.repos_[s][h].resume()}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t.prototype.databaseFromApp=function(t,e,n){var r=n||t.options.databaseURL;void 0===r&&E("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var i=Y(r),o=i.repoInfo,a=void 0;return"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a&&(r="http://"+a+"?ns="+o.namespace,o=(i=Y(r)).repoInfo),ht("Invalid Firebase Database URL",1,i),i.path.isEmpty()||E("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t,e).database},t.prototype.deleteRepo=function(t){var e=Object(o.D)(this.repos_,t.app.name);e&&Object(o.D)(e,t.repoInfo_.toURLString())===t||E("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e,n){var r=Object(o.D)(this.repos_,e.name);r||(r={},this.repos_[e.name]=r);var i=Object(o.D)(r,t.toURLString());return i&&E("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new tn(t,this.useRestClient_,e,n),r[t.toURLString()]=i,i},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),ln=function(){function t(t){this.repo_=t,t instanceof tn||E("Don't call new Database() directly - please use firebase.database()."),this.root_=new on(t,V.Empty),this.INTERNAL=new fn(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),Object(o.H)("database.ref",0,1,arguments.length),t instanceof on?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Object(o.H)(e,1,1,arguments.length);var n=Y(t);ht(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&E(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&E("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){Object(o.H)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){Object(o.H)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),fn=function(){function t(t){this.database=t}return t.prototype.delete=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){return this.database.checkDeleted_("delete"),hn.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),pn=Object.freeze({__proto__:null,forceLongPolling:function(){Qe.forceDisallow(),Be.forceAllow()},forceWebSockets:function(){Be.forceDisallow()},isWebSocketsAvailable:function(){return Qe.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),dn=$e;$e.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},$e.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var mn=ze,gn=W,yn=Object.freeze({__proto__:null,DataConnection:dn,RealTimeConnection:mn,hijackHash:function(t){var e=$e.prototype.put;return $e.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){$e.prototype.put=e}},ConnectionTarget:gn,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){hn.getInstance().forceRestClient(t)}}),vn="@firebase/database",bn="0.5.18",wn=ln.ServerValue;!function(e){!function(t){Ke=t}(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new s.a("database",function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return hn.getInstance().databaseFromApp(n,r,e)},"PUBLIC").setServiceProps({Reference:on,Query:Jt,Database:ln,DataSnapshot:Qt,enableLogging:b,INTERNAL:pn,ServerValue:wn,TEST_ACCESS:yn}).setMultipleInstances(!0));e.registerVersion(vn,bn),Object(o.w)()&&(t.exports=n)}(r.a)}).call(this,n(9)(t))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){"use strict";n.r(e);n(5)},,function(t,e,n){"use strict";n.r(e);var r=n(2);(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function i(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function o(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:i(t)}}!function(t,r){if(r){var i=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(r=r(o=i[t=t[t.length-1]]))!=o&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Promise",function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function r(){this.a=null}function i(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;r.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var a=n.setTimeout;r.prototype.c=function(t){a(t,0)},r.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},r.prototype.f=function(t){this.c(function(){throw t})},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.o(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.h(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new r;return e.prototype.o=function(t){var e=this.f();t.La(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){o(t)}}:e}var i,o,a=new e(function(t,e){i=t,o=e});return this.La(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.La=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=i,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=o(t),a=r.next();!a.done;a=r.next())i(a.value).La(e,n)})},e.all=function(t){var n=o(t),r=n.next();return r.done?i([]):new e(function(t,e){function o(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,i(r.value).La(o(a.length-1),e),r=n.next()}while(!r.done)})},e});var a=a||{},s=this||self;function u(t){return"string"==typeof t}function c(t){return"boolean"==typeof t}var h=/^[\w+\/_-]+[=]{0,2}$/,l=null;function f(){}function p(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function d(t){return null===t}function m(t){return"array"==p(t)}function g(t){var e=p(t);return"array"==e||"object"==e&&"number"==typeof t.length}function y(t){return"function"==p(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var b="closure_uid_"+(1e9*Math.random()>>>0),w=0;function _(t,e,n){return t.call.apply(t.bind,arguments)}function T(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function E(t,e,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:T).apply(null,arguments)}function S(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var I=Date.now||function(){return+new Date};function C(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.gd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function O(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function N(t){if(Error.captureStackTrace)Error.captureStackTrace(this,N);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function A(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");N.call(this,n+t[r])}function D(t,e){throw new A("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function R(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function P(){this.b=this.a=null}C(N,Error),N.prototype.name="CustomError",C(A,N),A.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var M=new k(function(){return new x},function(t){t.reset()});function L(){var t=Wt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function x(){this.next=this.b=this.a=null}function j(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||s).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;D("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}P.prototype.add=function(t,e){var n=M.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},x.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},x.prototype.reset=function(){this.next=this.b=this.a=null};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(u(t))return u(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=u(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var V=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=u(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},q=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=u(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function B(t,e){return 0<=F(t,e)}function W(t,e){var n;return(n=0<=(e=F(t,e)))&&Array.prototype.splice.call(t,e,1),n}function K(t,e){!function(t,e){for(var n=u(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,function(n,r){e.call(void 0,n,r,t)&&1==Array.prototype.splice.call(t,r,1).length&&0})}function H(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function z(t){for(var e in t)return!1;return!0}function Y(t){var e,n={};for(e in t)n[e]=t[e];return n}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<X.length;o++)n=X[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function $(t,e){this.a=t===et&&e||"",this.b=tt}function Z(t){return t instanceof $&&t.constructor===$&&t.b===tt?t.a:(D("expected object of type Const, got '"+t+"'"),"type_error:Const")}$.prototype.qa=!0,$.prototype.pa=function(){return this.a},$.prototype.toString=function(){return"Const{"+this.a+"}"};var tt={},et={},nt=new $(et,"");function rt(){this.a="",this.b=ut}function it(t){return t instanceof rt&&t.constructor===rt&&t.b===ut?t.a:(D("expected object of type TrustedResourceUrl, got '"+t+"' of type "+p(t)),"type_error:TrustedResourceUrl")}function ot(t,e){var n=Z(t);if(!st.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return ct(t=n.replace(at,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof $?Z(t):encodeURIComponent(String(t))}))}rt.prototype.qa=!0,rt.prototype.pa=function(){return this.a.toString()},rt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var at=/%{(\w+)}/g,st=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^\/\\]|[^:\/\\%]+\/|[^:\/\\%]*[?#]|about:blank#)/i,ut={};function ct(t){var e=new rt;return e.a=t,e}var ht=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},lt=/&/g,ft=/</g,pt=/>/g,dt=/"/g,mt=/'/g,gt=/\x00/g,yt=/[\x00&<>"']/;function vt(t,e){return-1!=t.indexOf(e)}function bt(t,e){return t<e?-1:t>e?1:0}function wt(){this.a="",this.b=It}function _t(t){return t instanceof wt&&t.constructor===wt&&t.b===It?t.a:(D("expected object of type SafeUrl, got '"+t+"' of type "+p(t)),"type_error:SafeUrl")}wt.prototype.qa=!0,wt.prototype.pa=function(){return this.a.toString()},wt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Tt=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function Et(t){return t instanceof wt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),Tt.test(t)||(t="about:invalid#zClosurez"),Ct(t))}var St,It={};function Ct(t){var e=new wt;return e.a=t,e}Ct("about:blank");t:{var Ot=s.navigator;if(Ot){var Nt=Ot.userAgent;if(Nt){St=Nt;break t}}St=""}function At(t){return vt(St,t)}function Dt(){this.a="",this.b=Rt}function kt(t){return t instanceof Dt&&t.constructor===Dt&&t.b===Rt?t.a:(D("expected object of type SafeHtml, got '"+t+"' of type "+p(t)),"type_error:SafeHtml")}Dt.prototype.qa=!0,Dt.prototype.pa=function(){return this.a.toString()},Dt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Rt={};function Pt(t){var e=new Dt;return e.a=t,e}Pt("<!DOCTYPE html>");var Mt,Lt,xt=Pt("");function jt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Ft(t){return yt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(lt,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ft,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(pt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(dt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(mt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(gt,"&#0;"))),t}function Ut(t){s.setTimeout(function(){throw t},0)}function Vt(){var t=s.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!At("Presto")&&(t=function(){var t,e,n=document.createElement("IFRAME");n.style.display="none",t=n,e=ct(Z(nt)),j(t,"HTMLIFrameElement"),t.src=it(e).toString(),document.documentElement.appendChild(n);var r=n.contentWindow;(n=r.document).open(),n.write(kt(xt)),n.close();var i="callImmediate"+Math.random(),o="file:"==r.location.protocol?"*":r.location.protocol+"//"+r.location.host;n=E(function(t){"*"!=o&&t.origin!=o||t.data!=i||this.port1.onmessage()},this),r.addEventListener("message",n,!1),this.port1={},this.port2={postMessage:function(){r.postMessage(i,o)}}}),void 0!==t&&!At("Trident")&&!At("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){s.setTimeout(t,0)}}function qt(t,e){Lt||function(){if(s.Promise&&s.Promise.resolve){var t=s.Promise.resolve(void 0);Lt=function(){t.then(Kt)}}else Lt=function(){var t=Kt;!y(s.setImmediate)||s.Window&&s.Window.prototype&&!At("Edge")&&s.Window.prototype.setImmediate==s.setImmediate?(Mt||(Mt=Vt()),Mt(t)):s.setImmediate(t)}}(),Bt||(Lt(),Bt=!0),Wt.add(t,e)}Pt("<br>");var Bt=!1,Wt=new P;function Kt(){for(var t;t=L();){try{t.a.call(t.b)}catch(t){Ut(t)}R(M,t)}Bt=!1}function Ht(t,e){if(this.a=Qt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=f)try{var n=this;t.call(e,function(t){ie(n,Gt,t)},function(t){if(!(t instanceof le))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ie(n,zt,t)})}catch(t){ie(this,zt,t)}}var Qt=0,Gt=2,zt=3;function Yt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Yt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Xt=new k(function(){return new Yt},function(t){t.reset()});function Jt(t,e,n){var r=Xt.get();return r.g=t,r.b=e,r.f=n,r}function $t(t){if(t instanceof Ht)return t;var e=new Ht(f);return ie(e,Gt,t),e}function Zt(t){return new Ht(function(e,n){n(t)})}function te(t,e,n){oe(t,e,n,null)||qt(S(e,t))}function ee(t){return new Ht(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Gb:!0,value:o}:{Gb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)te(t[o],S(i,o,!0),S(i,o,!1));else e(r)})}function ne(t,e){t.b||t.a!=Gt&&t.a!=zt||ae(t),t.f?t.f.next=e:t.b=e,t.f=e}function re(t,e,n,r){var i=Jt(null,null,null);return i.a=new Ht(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(t){o(t)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof le?o(e):t(i)}catch(t){o(t)}}:o}),i.a.c=t,ne(t,i),i.a}function ie(t,e,n){t.a==Qt&&(t===n&&(e=zt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,oe(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,ae(t),e!=zt||n instanceof le||function(t,e){t.g=!0,qt(function(){t.g&&he.call(null,e)})}(t,n)))}function oe(t,e,n,r){if(t instanceof Ht)return ne(t,Jt(e||f,n||null,r)),!0;if(O(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(y(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function ae(t){t.h||(t.h=!0,qt(t.Zb,t))}function se(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function ue(t,e,n,r){if(n==zt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ce(e,n,r);else try{e.c?e.g.call(e.f):ce(e,n,r)}catch(t){he.call(null,t)}R(Xt,e)}function ce(t,e,n){e==Gt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}Ht.prototype.then=function(t,e,n){return re(this,y(t)?t:null,y(e)?e:null,n)},Ht.prototype.$goog_Thenable=!0,(t=Ht.prototype).ka=function(t,e){return(t=Jt(t,t,e)).c=!0,ne(this,t),this},t.s=function(t,e){return re(this,null,t,e)},t.cancel=function(t){this.a==Qt&&qt(function(){!function t(e,n){if(e.a==Qt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Qt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):se(r),ue(r,o,zt,n)))}e.c=null}else ie(e,zt,n)}(this,new le(t))},this)},t.Oc=function(t){this.a=Qt,ie(this,Gt,t)},t.Pc=function(t){this.a=Qt,ie(this,zt,t)},t.Zb=function(){for(var t;t=se(this);)ue(this,t,this.a,this.i);this.h=!1};var he=Ut;function le(t){N.call(this,t)}function fe(){0!=pe&&(de[this[b]||(this[b]=++w)]=this),this.va=this.va,this.la=this.la}C(le,N),le.prototype.name="cancel";var pe=0,de={};function me(t){if(!t.va&&(t.va=!0,t.za(),0!=pe)){var e=t[b]||(t[b]=++w);if(0!=pe&&t.la&&0<t.la.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete de[e]}}function ge(t){return ge[" "](t),t}fe.prototype.va=!1,fe.prototype.za=function(){if(this.la)for(;this.la.length;)this.la.shift()()},ge[" "]=f;var ye,ve,be=At("Opera"),we=At("Trident")||At("MSIE"),_e=At("Edge"),Te=_e||we,Ee=At("Gecko")&&!(vt(St.toLowerCase(),"webkit")&&!At("Edge"))&&!(At("Trident")||At("MSIE"))&&!At("Edge"),Se=vt(St.toLowerCase(),"webkit")&&!At("Edge");function Ie(){var t=s.document;return t?t.documentMode:void 0}t:{var Ce="",Oe=(ve=St,Ee?/rv:([^\);]+)(\)|;)/.exec(ve):_e?/Edge\/([\d\.]+)/.exec(ve):we?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ve):Se?/WebKit\/(\S+)/.exec(ve):be?/(?:Version)[ \/]?(\S+)/.exec(ve):void 0);if(Oe&&(Ce=Oe?Oe[1]:""),we){var Ne=Ie();if(null!=Ne&&Ne>parseFloat(Ce)){ye=String(Ne);break t}}ye=Ce}var Ae,De={};function ke(t){return function(t,e){var n=De;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=ht(String(ye)).split("."),r=ht(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=bt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||bt(0==a[2].length,0==s[2].length)||bt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}Ae=s.document&&we?Ie():void 0;var Re=Object.freeze||function(t){return t},Pe=!we||9<=Number(Ae),Me=we&&!ke("9"),Le=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{s.addEventListener("test",f,e),s.removeEventListener("test",f,e)}catch(t){}return t}();function xe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function je(t,e){if(xe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Ee){t:{try{ge(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=u(t.pointerType)?t.pointerType:Fe[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}xe.prototype.preventDefault=function(){this.Mb=!1},C(je,xe);var Fe=Re({2:"touch",3:"pen",4:"mouse"});je.prototype.preventDefault=function(){je.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Me)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},je.prototype.f=function(){return this.a};var Ue="closure_listenable_"+(1e6*Math.random()|0),Ve=0;function qe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Pa=i,this.key=++Ve,this.ta=this.Ka=!1}function Be(t){t.ta=!0,t.listener=null,t.proxy=null,t.src=null,t.Pa=null}function We(t){this.src=t,this.a={},this.b=0}function Ke(t,e){var n=e.type;n in t.a&&W(t.a[n],e)&&(Be(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function He(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ta&&o.listener==e&&o.capture==!!n&&o.Pa==r)return i}return-1}We.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=He(t,e,r,i);return-1<a?(e=t[a],n||(e.Ka=!1)):((e=new qe(e,this.src,o,!!r,i)).Ka=n,t.push(e)),e};var Qe="closure_lm_"+(1e6*Math.random()|0),Ge={};function ze(t,e,n,r,i){if(r&&r.once)Xe(t,e,n,r,i);else if(m(e))for(var o=0;o<e.length;o++)ze(t,e[o],n,r,i);else n=an(n),t&&t[Ue]?un(t,e,n,v(r)?!!r.capture:!!r,i):Ye(t,e,n,!1,r,i)}function Ye(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=rn(t);if(s||(t[Qe]=s=new We(t)),!(n=s.add(e,n,r,a,o)).proxy){if(r=function(){var t=nn,e=Pe?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Le||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ze(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}0}}function Xe(t,e,n,r,i){if(m(e))for(var o=0;o<e.length;o++)Xe(t,e[o],n,r,i);else n=an(n),t&&t[Ue]?cn(t,e,n,v(r)?!!r.capture:!!r,i):Ye(t,e,n,!0,r,i)}function Je(t,e,n,r,i){if(m(e))for(var o=0;o<e.length;o++)Je(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=an(n),t&&t[Ue]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=He(o=t.a[e],n,r,i))&&(Be(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=rn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=He(e,n,r,i)),(n=-1<t?e[t]:null)&&$e(n))}function $e(t){if("number"!=typeof t&&t&&!t.ta){var e=t.src;if(e&&e[Ue])Ke(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ze(n),r):e.addListener&&e.removeListener&&e.removeListener(r),0,(n=rn(e))?(Ke(n,t),0==n.b&&(n.src=null,e[Qe]=null)):Be(t)}}}function Ze(t){return t in Ge?Ge[t]:Ge[t]="on"+t}function tn(t,e,n,r){var i=!0;if((t=rn(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ta&&(o=en(o,r),i=i&&!1!==o)}return i}function en(t,e){var n=t.listener,r=t.Pa||t.src;return t.Ka&&$e(t),n.call(r,e)}function nn(t,e){if(t.ta)return!0;if(!Pe){if(!e)t:{e=["window","event"];for(var n=s,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new je(r=e,this),n=!0,!(0>r.keyCode||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=tn(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=tn(r[i],t,!1,e),n=n&&o}return n}return en(t,new je(e,this))}function rn(t){return(t=t[Qe])instanceof We?t:null}var on="__closure_events_fn_"+(1e9*Math.random()>>>0);function an(t){return y(t)?t:(t[on]||(t[on]=function(e){return t.handleEvent(e)}),t[on])}function sn(){fe.call(this),this.u=new We(this),this.Sb=this,this.Xa=null}function un(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function cn(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function hn(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ta&&a.capture==n){var s=a.listener,u=a.Pa||a.src;a.Ka&&Ke(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function ln(t,e,n){if(y(t))n&&(t=E(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=E(t.handleEvent,t)}return 2147483647<Number(e)?-1:s.setTimeout(t,e||0)}function fn(t){var e=null;return new Ht(function(n,r){-1==(e=ln(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw s.clearTimeout(e),t})}function pn(t){if(t.U&&"function"==typeof t.U)return t.U();if(u(t))return t.split("");if(g(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function dn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(g(t)||u(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function mn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof mn)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function gn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];yn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)yn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function yn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}C(sn,fe),sn.prototype[Ue]=!0,sn.prototype.addEventListener=function(t,e,n,r){ze(this,t,e,n,r)},sn.prototype.removeEventListener=function(t,e,n,r){Je(this,t,e,n,r)},sn.prototype.dispatchEvent=function(t){var e,n=this.Xa;if(n)for(e=[];n;n=n.Xa)e.push(n);n=this.Sb;var r=t.type||t;if(u(t))t=new xe(t,n);else if(t instanceof xe)t.target=t.target||n;else{var i=t;J(t=new xe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=hn(a,r,!0,t)&&i}if(i=hn(a=t.b=n,r,!0,t)&&i,i=hn(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=hn(a=t.b=e[o],r,!1,t)&&i;return i},sn.prototype.za=function(){if(sn.qb.za.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)0,Be(n[r]);delete e.a[t],e.b--}}this.Xa=null},(t=mn.prototype).U=function(){gn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return gn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return yn(this.b,t)?this.b[t]:e},t.set=function(t,e){yn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var vn=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function bn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof bn?(this.h=void 0!==e?e:t.h,wn(this,t.f),this.i=t.i,this.b=t.b,_n(this,t.l),this.c=t.c,Tn(this,qn(t.a)),this.g=t.g):t&&(n=String(t).match(vn))?(this.h=!!e,wn(this,n[1]||"",!0),this.i=On(n[2]||""),this.b=On(n[3]||"",!0),_n(this,n[4]),this.c=On(n[5]||"",!0),Tn(this,n[6]||"",!0),this.g=On(n[7]||"")):(this.h=!!e,this.a=new Ln(null,this.h))}function wn(t,e,n){t.f=n?On(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function _n(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.l=e}else t.l=null}function Tn(t,e,n){e instanceof Ln?(t.a=e,function(t,e){e&&!t.f&&(xn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Fn(this,e),Vn(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Nn(e,Pn)),t.a=new Ln(e,t.h))}function En(t,e,n){t.a.set(e,n)}function Sn(t,e){return t.a.get(e)}function In(t){return t instanceof bn?new bn(t):new bn(t,void 0)}function Cn(t,e){var n=new bn(null,void 0);return wn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function On(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Nn(t,e,n){return u(t)?(t=encodeURI(t).replace(e,An),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function An(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}bn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Nn(e,Dn,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(Nn(e,Dn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Nn(n,"/"==n.charAt(0)?Rn:kn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Nn(n,Mn)),t.join("")},bn.prototype.resolve=function(t){var e=new bn(this),n=!!t.f;n?wn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)_n(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(vt(i,"./")||vt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?Tn(e,qn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Dn=/[#\/\?@]/g,kn=/[#\?:]/g,Rn=/[#\?]/g,Pn=/[#\?@]/g,Mn=/#/g;function Ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function xn(t){t.a||(t.a=new mn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function jn(t){var e=dn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Ln(null,void 0);t=pn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];m(o)?Vn(n,i,o):n.add(i,o)}return n}function Fn(t,e){xn(t),e=Bn(t,e),yn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,yn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&gn(t)))}function Un(t,e){return xn(t),e=Bn(t,e),yn(t.a.b,e)}function Vn(t,e,n){Fn(t,e),0<n.length&&(t.c=null,t.a.set(Bn(t,e),Q(n)),t.b+=n.length)}function qn(t){var e=new Ln;return e.c=t.c,t.a&&(e.a=new mn(t.a),e.b=t.b),e}function Bn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Ln.prototype).add=function(t,e){xn(this),this.c=null,t=Bn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){xn(this),this.a.forEach(function(n,r){U(n,function(n){t.call(e,n,r,this)},this)},this)},t.X=function(){xn(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){xn(this);var e=[];if(u(t))Un(this,t)&&(e=H(e,this.a.get(Bn(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=H(e,t[n])}return e},t.set=function(t,e){return xn(this),this.c=null,Un(this,t=Bn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var Wn=!we||9<=Number(Ae);function Kn(t){var e=document;return u(t)?e.getElementById(t):t}function Hn(t,e){G(e,function(e,n){e&&"object"==typeof e&&e.qa&&(e=e.pa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Qn.hasOwnProperty(n)?t.setAttribute(Qn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}var Qn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Gn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!Wn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Ft(a.name),'"'),a.type){o.push(' type="',Ft(a.type),'"');var s={};J(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(u(a)?o.className=a:m(a)?o.className=a.join(" "):Hn(o,a)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(u(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!g(o)||v(o)&&0<o.nodeType?r(o):U(zn(o)?Q(o):o,r)}}(i,o,r),o}function zn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(y(t))return"function"==typeof t.item}return!1}function Yn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(m(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Zn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Zn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Xn,t,e),e.join("")}function Xn(){}var Jn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},$n=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Zn(t,e){e.push('"',t.replace($n,function(t){var e=Jn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Jn[t]=e),e}),'"')}function tr(){var t=br();return we&&!!Ae&&11==Ae||/Edge\/\d+/.test(t)}function er(){return s.window&&s.window.location.href||self&&self.location&&self.location.href||""}function nr(t,e){e=e||s.window;var n="about:blank";t&&(n=_t(Et(t)).toString()),e.location.href=n}function rr(t){return!!((t=(t||br()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function ir(t){t=t||s.window;try{t.close()}catch(t){}}function or(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=br().toLowerCase(),r&&(e.target=r,vt(n,"crios/")&&(e.target="_blank")),gr(br())==dr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof wt?n:Et(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((At("iPhone")&&!At("iPod")&&!At("iPad")||At("iPad")||At("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(j(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof wt||e instanceof wt||(e="object"==typeof e&&e.qa?e.pa():String(e),Tt.test(e)||(e="about:invalid#zClosurez"),e=Ct(e)),a.href=_t(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=_t(e).toString(),a&&(Te&&vt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Pt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Ft(t)+'">'),a.document.write(kt(t)),a.document.close())):(a=r.open(_t(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var ar=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,sr=/^[^@]+@[^@]+$/;function ur(){var t=null;return new Ht(function(e){"complete"==s.document.readyState?e():(t=function(){e()},Xe(window,"load",t))}).s(function(e){throw Je(window,"load",t),e})}function cr(t){return t=t||br(),!("file:"!==Sr()&&"ionic:"!==Sr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function hr(){var t=s.window;try{return!(!t||t==t.top)}catch(t){return!1}}function lr(){return void 0!==s.WorkerGlobalScope&&"function"==typeof s.importScripts}function fr(){return r.a.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":r.a.INTERNAL.hasOwnProperty("node")?"Node":lr()?"Worker":"Browser"}function pr(){var t=fr();return"ReactNative"===t||"Node"===t}var dr="Firefox",mr="Chrome";function gr(t){var e=t.toLowerCase();return vt(e,"opera/")||vt(e,"opr/")||vt(e,"opios/")?"Opera":vt(e,"iemobile")?"IEMobile":vt(e,"msie")||vt(e,"trident/")?"IE":vt(e,"edge/")?"Edge":vt(e,"firefox/")?dr:vt(e,"silk/")?"Silk":vt(e,"blackberry")?"Blackberry":vt(e,"webos")?"Webos":!vt(e,"safari/")||vt(e,"chrome/")||vt(e,"crios/")||vt(e,"android")?!vt(e,"chrome/")&&!vt(e,"crios/")||vt(e,"edge/")?vt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":mr:"Safari"}var yr={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function vr(t,e){e=e||[];var n,r=[],i={};for(n in yr)i[yr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=fr())?r=gr(i=br()):"Worker"===r&&(r=gr(i=br())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function br(){return s.navigator&&s.navigator.userAgent||""}function wr(t,e){t=t.split("."),e=e||s;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function _r(){try{var t=s.localStorage,e=Ar();if(t)return t.setItem(e,"1"),t.removeItem(e),!tr()||!!s.indexedDB}catch(t){return lr()&&!!s.indexedDB}return!1}function Tr(){return(Er()||"chrome-extension:"===Sr()||cr())&&!pr()&&_r()&&!lr()}function Er(){return"http:"===Sr()||"https:"===Sr()}function Sr(){return s.location&&s.location.protocol||null}function Ir(t){return!rr(t=t||br())&&gr(t)!=dr}function Cr(t){return void 0===t?null:Yn(t)}function Or(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Nr(t){if(null!==t)return JSON.parse(t)}function Ar(t){return t||Math.floor(1e9*Math.random()).toString()}function Dr(t){return"Safari"!=gr(t=t||br())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function kr(){var t=s.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Rr(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=br(),e=fr(),this.b=rr(t)||"ReactNative"===e}function Pr(){var t=s.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Mr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Lr(){return!(!wr("fireauth.oauthhelper",s)&&!wr("fireauth.iframe",s))}Rr.prototype.get=function(){var t=s.navigator;return!t||"boolean"!=typeof t.onLine||!Er()&&"chrome-extension:"!==Sr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var xr,jr={};function Fr(t){jr[t]||(jr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Ur={};Object.defineProperty(Ur,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Ur,"abcd",{configurable:!0,enumerable:!0,value:2}),xr=2==Ur.abcd}catch(ve){xr=!1}function Vr(t,e,n){xr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function qr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Vr(t,n,e[n])}function Br(t){var e={};return qr(e,t),e}function Wr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Vr(e,n,Wr(t[n]));return e}function Kr(t){var e={},n=t[Qr],r=t[Gr];if(!(t=t[zr])||t!=Hr&&!n)throw Error("Invalid provider user info!");e[Xr]=r||null,e[Yr]=n||null,Vr(this,$r,t),Vr(this,Jr,Wr(e))}var Hr="EMAIL_SIGNIN",Qr="email",Gr="newEmail",zr="requestType",Yr="email",Xr="fromEmail",Jr="data",$r="operation";function Zr(t,e){this.code=ei+t,this.message=e||ni[t]||""}function ti(t){var e=t&&t.code;return e?new Zr(e.substring(ei.length),t.message):null}C(Zr,Error),Zr.prototype.A=function(){return{code:this.code,message:this.message}},Zr.prototype.toJSON=function(){return this.A()};var ei="auth/",ni={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function ri(t){var e=Sn(t=In(t),ii)||null,n=Sn(t,oi)||null,r=Sn(t,ui)||null;if(r=r&&hi[r]||null,!e||!n||!r)throw new Zr("argument-error",ii+", "+oi+"and "+ui+" are required in a valid action code URL.");qr(this,{apiKey:e,operation:r,code:n,continueUrl:Sn(t,ai)||null,languageCode:Sn(t,si)||null,tenantId:Sn(t,ci)||null})}var ii="apiKey",oi="oobCode",ai="continueUrl",si="languageCode",ui="mode",ci="tenantId",hi={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Hr,verifyEmail:"VERIFY_EMAIL"};function li(t){try{return new ri(t)}catch(t){return null}}function fi(t){var e=t[yi];if(void 0===e)throw new Zr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Zr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[pi];if(n&&"object"==typeof n){e=n[wi];var r=n[vi];if(n=n[bi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Zr("argument-error",vi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Zr("argument-error",bi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Zr("argument-error",wi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Zr("missing-android-pkg-name")}}else if(void 0!==n)throw new Zr("argument-error",pi+" property must be a non null object when specified.");if(this.f=null,(e=t[gi])&&"object"==typeof e){if("string"==typeof(e=e[_i])&&e.length)this.f=e;else if(void 0!==e)throw new Zr("argument-error",_i+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Zr("argument-error",gi+" property must be a non null object when specified.");if(void 0!==(e=t[mi])&&"boolean"!=typeof e)throw new Zr("argument-error",mi+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[di])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Zr("argument-error",di+" property must be a non empty string when specified.");this.i=t||null}var pi="android",di="dynamicLinkDomain",mi="handleCodeInApp",gi="iOS",yi="url",vi="installApp",bi="minimumVersion",wi="packageName",_i="bundleId";function Ti(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var Ei=null,Si=null;function Ii(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=Si[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!Ei){Ei={},Si={};for(var t=0;65>t;t++)Ei[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),Si[Ei[t]]=t,62<=t&&(Si["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Ci(t){this.f=t.sub,I(),this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Oi(t){return(t=Ni(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ci(t):null}function Ni(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(Ii(t))}catch(t){}return null}Ci.prototype.R=function(){return this.c},Ci.prototype.g=function(){return this.b};var Ai,Di={bd:{cb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{cb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{cb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function ki(t){for(var e in Di)if(Di[e].id===t)return{firebaseEndpoint:(t=Di[e]).cb,secureTokenEndpoint:t.ib};return null}Ai=ki("__EID__")?"__EID__":void 0;var Ri="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Pi=["client_id","response_type","scope","redirect_uri","state"],Mi={Xc:{Ea:"locale",sa:700,ra:600,Fa:"facebook.com",Qa:Pi},Zc:{Ea:null,sa:500,ra:750,Fa:"github.com",Qa:Pi},$c:{Ea:"hl",sa:515,ra:680,Fa:"google.com",Qa:Pi},fd:{Ea:"lang",sa:485,ra:705,Fa:"twitter.com",Qa:Ri},Vc:{Ea:"locale",sa:600,ra:600,Fa:"apple.com",Qa:[]}};function Li(t){for(var e in Mi)if(Mi[e].Fa==t)return Mi[e];return null}function xi(t){var e={};e["facebook.com"]=qi,e["google.com"]=Wi,e["github.com"]=Bi,e["twitter.com"]=Ki;var n=t&&t[Fi];try{if(n)return e[n]?new e[n](t):new Vi(t);if(void 0!==t[ji])return new Ui(t)}catch(t){}return null}var ji="idToken",Fi="providerId";function Ui(t){var e=t[Fi];if(!e&&t[ji]){var n=Oi(t[ji]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Vr(this,"providerId",e),Vr(this,"isNewUser",n)}function Vi(t){Ui.call(this,t),Vr(this,"profile",Wr((t=Nr(t.rawUserInfo||"{}"))||{}))}function qi(t){if(Vi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Bi(t){if(Vi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Vr(this,"username",this.profile&&this.profile.login||null)}function Wi(t){if(Vi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ki(t){if(Vi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Vr(this,"username",t.screenName||null)}function Hi(t){var e=In(t),n=Sn(e,"link"),r=Sn(In(n),"link");return e=Sn(e,"deep_link_id"),Sn(In(e),"link")||e||r||n||t}function Qi(){}function Gi(t,e){return t.then(function(t){if(t[La]){var n=Oi(t[La]);if(!n||e!=n.f)throw new Zr("user-mismatch");return t}throw new Zr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==ei+"user-not-found"?new Zr("user-mismatch"):t})}function zi(t,e){if(!e)throw new Zr("internal-error","failed to construct a credential");this.a=e,Vr(this,"providerId",t),Vr(this,"signInMethod",t)}function Yi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Xi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new zi(t.providerId,t.pendingToken)}catch(t){}return null}function Ji(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Vr(this,"idToken",e.idToken),e.accessToken&&Vr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Vr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Zr("internal-error","failed to construct a credential");Vr(this,"accessToken",e.oauthToken),Vr(this,"secret",e.oauthTokenSecret)}Vr(this,"providerId",t),Vr(this,"signInMethod",n)}function $i(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:jn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Zi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Ji(t.providerId,e,t.signInMethod)}catch(t){}}return null}function to(t,e){this.Fc=e||[],qr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Li(t)||{}).Ea||null,this.bb=null}function eo(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Zr("argument-error",'SAML provider IDs must be prefixed with "saml."');to.call(this,t,[])}function no(t){to.call(this,t,Pi),this.a=[]}function ro(){no.call(this,"facebook.com")}function io(t){if(!t)throw new Zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new ro).credential({accessToken:e})}function oo(){no.call(this,"github.com")}function ao(t){if(!t)throw new Zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new oo).credential({accessToken:e})}function so(){no.call(this,"google.com"),this.ya("profile")}function uo(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new so).credential({idToken:n,accessToken:e})}function co(){to.call(this,"twitter.com",Ri)}function ho(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Zr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Ji("twitter.com",n,"twitter.com")}function lo(t,e,n){this.a=t,this.c=e,Vr(this,"providerId","password"),Vr(this,"signInMethod",n===po.EMAIL_LINK_SIGN_IN_METHOD?po.EMAIL_LINK_SIGN_IN_METHOD:po.EMAIL_PASSWORD_SIGN_IN_METHOD)}function fo(t){return t&&t.email&&t.password?new lo(t.email,t.password,t.signInMethod):null}function po(){qr(this,{providerId:"password",isOAuthProvider:!1})}function mo(t,e){if(!(e=go(e)))throw new Zr("argument-error","Invalid email link!");return new lo(t,e.code,po.EMAIL_LINK_SIGN_IN_METHOD)}function go(t){return(t=li(t=Hi(t)))&&t.operation===Hr?t:null}function yo(t){if(!(t.Va&&t.Ua||t.Ha&&t.ba))throw new Zr("internal-error");this.a=t,Vr(this,"providerId","phone"),Vr(this,"signInMethod","phone")}function vo(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return U(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new yo(e)}return null}function bo(t){return t.a.Ha&&t.a.ba?{temporaryProof:t.a.Ha,phoneNumber:t.a.ba}:{sessionInfo:t.a.Va,code:t.a.Ua}}function wo(t){try{this.a=t||r.a.auth()}catch(t){throw new Zr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}qr(this,{providerId:"phone",isOAuthProvider:!1})}function _o(t,e){if(!t)throw new Zr("missing-verification-id");if(!e)throw new Zr("missing-verification-code");return new yo({Va:t,Ua:e})}function To(t){if(t.temporaryProof&&t.phoneNumber)return new yo({Ha:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return uo(o,n);case"facebook.com":return io(n);case"github.com":return ao(n);case"twitter.com":return ho(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new zi(e,a):new Ji(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new no(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function Eo(t){if(!t.isOAuthProvider)throw new Zr("invalid-oauth-provider")}function So(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Zr("invalid-auth-event");if(this.g&&this.a)throw new Zr("invalid-auth-event");if(this.g&&!this.f)throw new Zr("invalid-auth-event")}function Io(t){return(t=t||{}).type?new So(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&ti(t.error),t.postBody,t.tenantId):null}function Co(){this.b=null,this.a=[]}C(Vi,Ui),C(qi,Vi),C(Bi,Vi),C(Wi,Vi),C(Ki,Vi),zi.prototype.na=function(t){return Za(t,Yi(this))},zi.prototype.b=function(t,e){var n=Yi(this);return n.idToken=e,ts(t,n)},zi.prototype.f=function(t,e){return Gi(es(t,Yi(this)),e)},zi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Ji.prototype.na=function(t){return Za(t,$i(this))},Ji.prototype.b=function(t,e){var n=$i(this);return n.idToken=e,ts(t,n)},Ji.prototype.f=function(t,e){return Gi(es(t,$i(this)),e)},Ji.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},to.prototype.Ga=function(t){return this.zb=Y(t),this},C(eo,to),C(no,to),no.prototype.ya=function(t){return B(this.a,t)||this.a.push(t),this},no.prototype.Hb=function(){return Q(this.a)},no.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Zr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Ji(this.providerId,n,this.providerId)},C(ro,no),Vr(ro,"PROVIDER_ID","facebook.com"),Vr(ro,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),C(oo,no),Vr(oo,"PROVIDER_ID","github.com"),Vr(oo,"GITHUB_SIGN_IN_METHOD","github.com"),C(so,no),Vr(so,"PROVIDER_ID","google.com"),Vr(so,"GOOGLE_SIGN_IN_METHOD","google.com"),C(co,to),Vr(co,"PROVIDER_ID","twitter.com"),Vr(co,"TWITTER_SIGN_IN_METHOD","twitter.com"),lo.prototype.na=function(t){return this.signInMethod==po.EMAIL_LINK_SIGN_IN_METHOD?Ds(t,cs,{email:this.a,oobCode:this.c}):Ds(t,Cs,{email:this.a,password:this.c})},lo.prototype.b=function(t,e){return this.signInMethod==po.EMAIL_LINK_SIGN_IN_METHOD?Ds(t,hs,{idToken:e,email:this.a,oobCode:this.c}):Ds(t,ws,{idToken:e,email:this.a,password:this.c})},lo.prototype.f=function(t,e){return Gi(this.na(t),e)},lo.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},qr(po,{PROVIDER_ID:"password"}),qr(po,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),qr(po,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),yo.prototype.na=function(t){return t.Wa(bo(this))},yo.prototype.b=function(t,e){var n=bo(this);return n.idToken=e,Ds(t,Ns,n)},yo.prototype.f=function(t,e){var n=bo(this);return n.operation="REAUTH",Gi(t=Ds(t,As,n),e)},yo.prototype.A=function(){var t={providerId:"phone"};return this.a.Va&&(t.verificationId=this.a.Va),this.a.Ua&&(t.verificationCode=this.a.Ua),this.a.Ha&&(t.temporaryProof=this.a.Ha),this.a.ba&&(t.phoneNumber=this.a.ba),t},wo.prototype.Wa=function(t,e){var n=this.a.b;return $t(e.verify()).then(function(r){if(!u(r))throw new Zr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return Ds(t,vs,e)}(n,{phoneNumber:t,recaptchaToken:r}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new Zr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},qr(wo,{PROVIDER_ID:"phone"}),qr(wo,{PHONE_SIGN_IN_METHOD:"phone"}),So.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},So.prototype.R=function(){return this.h},So.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var Oo,No=null;function Ao(t){var e="unauthorized-domain",n=void 0,r=In(t);t=r.b,"chrome-extension"==(r=r.f)?n=jt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=jt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Zr.call(this,e,n)}function Do(t,e,n){Zr.call(this,t,n),(t=e||{}).Ab&&Vr(this,"email",t.Ab),t.ba&&Vr(this,"phoneNumber",t.ba),t.credential&&Vr(this,"credential",t.credential),t.Qb&&Vr(this,"tenantId",t.Qb)}function ko(t){if(t.code){var e=t.code||"";0==e.indexOf(ei)&&(e=e.substring(ei.length));var n={credential:To(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Zr(e,t.message||void 0);return new Do(e,n,t.message)}return null}function Ro(){}function Po(t){return t.c||(t.c=t.b())}function Mo(){}function Lo(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function xo(){}function jo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=E(this.fc,this),this.a.onerror=E(this.Ib,this),this.a.onprogress=E(this.gc,this),this.a.ontimeout=E(this.kc,this)}function Fo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Uo(t,e,n){this.reset(t,e,n,void 0,void 0)}C(Ao,Zr),C(Do,Zr),Do.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&J(t,e),t},Do.prototype.toJSON=function(){return this.A()},Ro.prototype.c=null,C(Mo,Ro),Mo.prototype.a=function(){var t=Lo(this);return t?new ActiveXObject(t):new XMLHttpRequest},Mo.prototype.b=function(){var t={};return Lo(this)&&(t[0]=!0,t[1]=!0),t},Oo=new Mo,C(xo,Ro),xo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new jo;throw Error("Unsupported browser")},xo.prototype.b=function(){return{}},(t=jo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Fo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Fo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Fo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Uo.prototype.a=null;function Vo(t){this.f=t,this.b=this.c=this.a=null}function qo(t,e){this.name=t,this.value=e}Uo.prototype.reset=function(t,e,n,r,i){"number"==typeof i||0,r||I(),delete this.a},qo.prototype.toString=function(){return this.name};var Bo=new qo("SEVERE",1e3),Wo=new qo("WARNING",900),Ko=new qo("CONFIG",700),Ho=new qo("FINE",500);Vo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(D("Root logger has no level set."),null)}(this).value)for(y(e)&&(e=e()),t=new Uo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Qo={},Go=null;function zo(t){var e;if(Go||(Go=new Vo(""),Qo[""]=Go,Go.c=Ko),!(e=Qo[t])){e=new Vo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=zo(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,Qo[t]=e}return e}function Yo(t,e){t&&t.log(Ho,e,void 0)}function Xo(t){this.f=t}function Jo(t){sn.call(this),this.o=t,this.readyState=$o,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=zo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}C(Xo,Ro),Xo.prototype.a=function(){return new Jo(this.f)},Xo.prototype.b=function(t){return function(){return t}}({}),C(Jo,sn);var $o=0;function Zo(t){t.c.read().then(t.ec.bind(t)).catch(t.Oa.bind(t))}function ta(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,ea(t)}function ea(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function na(t){sn.call(this),this.headers=new mn,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ra,this.v=this.P=!1}(t=Jo.prototype).open=function(t,e){if(this.readyState!=$o)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,ea(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Oa.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,ta(this,!1)),this.readyState=$o},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,ea(this)),this.a&&(this.readyState=3,ea(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Oa.bind(this)):void 0!==s.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Zo(this)):t.text().then(this.ic.bind(this),this.Oa.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?ta(this,!0):ea(this),3==this.readyState&&Zo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,ta(this,!0))},t.hc=function(t){this.a&&(this.response=t,ta(this,!0))},t.Oa=function(t){var e=this.h;e&&e.log(Wo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&ta(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Wo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Wo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},C(na,sn);var ra="";na.prototype.b=zo("goog.net.XhrIo");var ia=/^https?$/i,oa=["POST","PUT"];function aa(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.O=n,t.I=!1,t.c=!0,t.a=t.B?t.B.a():Oo.a(),t.w=t.B?Po(t.B):Po(Oo),t.a.onreadystatechange=E(t.Lb,t);try{Yo(t.b,ma(t,"Opening Xhr")),t.J=!0,t.a.open(n,String(e),!0),t.J=!1}catch(e){return Yo(t.b,ma(t,"Error opening Xhr: "+e.message)),void ua(t,e)}e=r||"";var o=new mn(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(g(t)||u(t))U(t,e,void 0);else for(var n=dn(t),r=pn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=sa,n=t.length,r=u(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:u(t)?t.charAt(e):t[e]}(o.X()),r=s.FormData&&e instanceof s.FormData,!B(oa,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.P&&(t.a.withCredentials=t.P);try{fa(t),0<t.g&&(t.v=function(t){return we&&ke(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),Yo(t.b,ma(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=E(t.Ia,t)):t.o=ln(t.Ia,t.g,t)),Yo(t.b,ma(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Yo(t.b,ma(t,"Send error: "+e.message)),ua(t,e)}}function sa(t){return"content-type"==t.toLowerCase()}function ua(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,ca(t),la(t)}function ca(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function ha(t){if(t.c&&void 0!==a)if(t.w[1]&&4==pa(t)&&2==da(t))Yo(t.b,ma(t,"Local request error detected and ignored"));else if(t.i&&4==pa(t))ln(t.Lb,0,t);else if(t.dispatchEvent("readystatechange"),4==pa(t)){Yo(t.b,ma(t,"Request complete")),t.c=!1;try{var e,n=da(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.l).match(vn)[1]||null;if(!o&&s.self&&s.self.location){var u=s.self.location.protocol;o=u.substr(0,u.length-1)}i=!ia.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<pa(t)?t.a.statusText:""}catch(e){Yo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+da(t)+"]",ca(t)}}finally{la(t)}}}function la(t,e){if(t.a){fa(t);var n=t.a,r=t.w[0]?f:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(Bo,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function fa(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(s.clearTimeout(t.o),t.o=null)}function pa(t){return t.a?t.a.readyState:0}function da(t){try{return 2<pa(t)?t.a.status:-1}catch(t){return-1}}function ma(t,e){return e+" ["+t.O+" "+t.l+" "+da(t)+"]"}function ga(t){var e=Oa;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function ya(t,e,n){t.a=!0,t.c=n,t.f=!e,_a(t)}function va(t){if(t.a){if(!t.u)throw new Ta(t);t.u=!1}}function ba(t,e,n,r){t.g.push([e,n,r]),t.a&&_a(t)}function wa(t){return q(t.g,function(t){return y(t[1])})}function _a(t){if(t.h&&t.a&&wa(t)){var e=t.h,n=Ia[e];n&&(s.clearTimeout(n.a),delete Ia[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],a=i[1];if(i=i[2],o=t.f?a:o)try{var u=o.call(i||t.o,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(O(e)||"function"==typeof s.Promise&&e instanceof s.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,wa(t)||(n=!0)}}t.c=e,r&&(u=E(t.m,t,!0),r=E(t.m,t,!1),e instanceof ga?(ba(e,u,r),e.w=!0):e.then(u,r)),n&&(e=new Sa(e),Ia[e.a]=e,t.h=e.a)}function Ta(){N.call(this)}function Ea(){N.call(this)}function Sa(t){this.a=s.setTimeout(E(this.c,this),0),this.b=t}(t=na.prototype).Ia=function(){void 0!==a&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Yo(this.b,ma(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Yo(this.b,ma(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),la(this))},t.za=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),la(this,!0)),na.qb.za.call(this)},t.Lb=function(){this.va||(this.J||this.i||this.f?ha(this):this.yc())},t.yc=function(){ha(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ra:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Bo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Yo(this.b,"Can not get response: "+t.message),null}},ga.prototype.cancel=function(t){if(this.a)this.c instanceof ga&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new Ea(this),va(this),ya(this,!1,t))}},ga.prototype.m=function(t,e){this.i=!1,ya(this,t,e)},ga.prototype.then=function(t,e,n){var r,i,o=new Ht(function(t,e){r=t,i=e});return ba(this,r,function(t){t instanceof Ea?o.cancel():i(t)}),o.then(t,e,n)},ga.prototype.$goog_Thenable=!0,C(Ta,N),Ta.prototype.message="Deferred has already fired",Ta.prototype.name="AlreadyCalledError",C(Ea,N),Ea.prototype.message="Deferred was canceled",Ea.prototype.name="CanceledError",Sa.prototype.c=function(){throw delete Ia[this.a],this.b};var Ia={};function Ca(t){var e={},n=e.document||document,r=it(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ia:void 0},a=new ga(o),u=null,c=null!=e.timeout?e.timeout:5e3;return 0<c&&(u=window.setTimeout(function(){Na(i,!0);var t=new ka(Da,"Timeout reached for loading script "+r);va(a),ya(a,!1,t)},c),o.Ia=u),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Na(i,e.hd||!1,u),va(a),ya(a,!0,null))},i.onerror=function(){Na(i,!0,u);var t=new ka(Aa,"Error while loading script "+r);va(a),ya(a,!1,t)},J(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),Hn(i,o),function(t,e){j(t,"HTMLScriptElement"),t.src=it(e),null===l&&(l=(e=(e=s.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&h.test(e)?e:""),(e=l)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function Oa(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Na(t,!0,this.Ia)}}function Na(t,e,n){null!=n&&s.clearTimeout(n),t.onload=f,t.onerror=f,t.onreadystatechange=f,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Aa=0,Da=1;function ka(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),N.call(this,n),this.code=t}function Ra(t){this.f=t}function Pa(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||xa,this.g=Y(t.secureTokenHeaders||ja),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||Fa,this.a=Y(t.firebaseHeaders||Ua),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==fr(),!(n=s.XMLHttpRequest||n&&r.a.INTERNAL.node&&r.a.INTERNAL.node.XMLHttpRequest)&&!lr())throw new Zr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,lr()?this.f=new Xo(self):pr()?this.f=new Ra(n):this.f=new xo,this.b=null}C(ka,N),C(Ra,Ro),Ra.prototype.a=function(){return new this.f},Ra.prototype.b=function(){return{}};var Ma,La="idToken",xa=new Rr(3e4,6e4),ja={"Content-Type":"application/x-www-form-urlencoded"},Fa=new Rr(3e4,6e4),Ua={"Content-Type":"application/json"};function Va(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function qa(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Ba(t,e,n,r,i,o,a){(function(){var t=br();return!((t=gr(t)!=mr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||we&&Ae&&!(9<Ae))})()||lr()?t=E(t.o,t):(Ma||(Ma=new Ht(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{s[Ka]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=ot(Wa,{onload:Ka});!function(t,e){ba(t,null,e,void 0)}(Ca(n),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=E(t.m,t)),t(e,n,r,i,o,a)}Pa.prototype.R=function(){return this.b},Pa.prototype.o=function(t,e,n,r,i,o){if(lr()&&(void 0===s.fetch||void 0===s.Headers||void 0===s.Request))throw new Zr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new na(this.f);if(o){a.g=Math.max(0,o);var u=setTimeout(function(){a.dispatchEvent("timeout")},o)}un(a,"complete",function(){u&&clearTimeout(u);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return Yo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)}),cn(a,"ready",function(){u&&clearTimeout(u),me(this)}),cn(a,"timeout",function(){u&&clearTimeout(u),me(this),e&&e(null)}),aa(a,t,n,r,i)};var Wa=new $(et,"https://apis.google.com/js/client.js?onload=%{onload}"),Ka="__fcb"+Math.floor(1e6*Math.random()).toString();function Ha(t){if(!u(t=t.email)||!sr.test(t))throw new Zr("invalid-email")}function Qa(t){"email"in t&&Ha(t)}function Ga(t){if(!t[La])throw new Zr("internal-error")}function za(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Zr("internal-error")}else{if(!t.sessionInfo)throw new Zr("missing-verification-id");if(!t.code)throw new Zr("missing-verification-code")}}Pa.prototype.m=function(t,e,n,r,i){var o=this;Ma.then(function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Pa.prototype.ob=function(){return Ds(this,_s,{})},Pa.prototype.rb=function(t,e){return Ds(this,bs,{idToken:t,email:e})},Pa.prototype.sb=function(t,e){return Ds(this,ws,{idToken:t,password:e})};var Ya={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Xa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Zr("internal-error")}function Ja(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Un(t=new Ln(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function $a(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=ko(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=ko(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=ko(t)):t.errorMessage&&(e=ks(t.errorMessage)),e)throw e;if(!t[La])throw new Zr("internal-error")}function Za(t,e){return e.returnIdpCredential=!0,Ds(t,Ts,e)}function ts(t,e){return e.returnIdpCredential=!0,Ds(t,Ss,e)}function es(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ds(t,Es,e)}function ns(t){if(!t.oobCode)throw new Zr("invalid-action-code")}(t=Pa.prototype).tb=function(t,e){var n={idToken:t},r=[];return G(Ya,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),Ds(this,bs,n)},t.kb=function(t,e){return J(t={requestType:"PASSWORD_RESET",email:t},e),Ds(this,ds,t)},t.lb=function(t,e){return J(t={requestType:"EMAIL_SIGNIN",email:t},e),Ds(this,fs,t)},t.jb=function(t,e){return J(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ds(this,ps,t)},t.Wa=function(t){return Ds(this,Os,t)},t.ab=function(t,e){return Ds(this,ys,{oobCode:t,newPassword:e})},t.Ma=function(t){return Ds(this,is,{oobCode:t})},t.Ya=function(t){return Ds(this,rs,{oobCode:t})};var rs={endpoint:"setAccountInfo",D:ns,fa:"email",F:!0},is={endpoint:"resetPassword",D:ns,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Zr("internal-error")},F:!0},os={endpoint:"signupNewUser",D:function(t){if(Ha(t),!t.password)throw new Zr("weak-password")},K:Ga,T:!0,F:!0},as={endpoint:"createAuthUri",F:!0},ss={endpoint:"deleteAccount",V:["idToken"]},us={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!m(t.deleteProvider))throw new Zr("internal-error")}},cs={endpoint:"emailLinkSignin",V:["email","oobCode"],D:Ha,K:Ga,T:!0,F:!0},hs={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:Ha,K:Ga,T:!0},ls={endpoint:"getAccountInfo"},fs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Zr("internal-error");Ha(t)},fa:"email",F:!0},ps={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Zr("internal-error")},fa:"email",F:!0},ds={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Zr("internal-error");Ha(t)},fa:"email",F:!0},ms={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},gs={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Zr("internal-error")}},ys={endpoint:"resetPassword",D:ns,fa:"email",F:!0},vs={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},bs={endpoint:"setAccountInfo",V:["idToken"],D:Qa,T:!0},ws={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Qa(t),!t.password)throw new Zr("weak-password")},K:Ga,T:!0},_s={endpoint:"signupNewUser",K:Ga,T:!0,F:!0},Ts={endpoint:"verifyAssertion",D:Xa,Ra:Ja,K:$a,T:!0,F:!0},Es={endpoint:"verifyAssertion",D:Xa,Ra:Ja,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Zr("user-not-found");if(t.errorMessage)throw ks(t.errorMessage);if(!t[La])throw new Zr("internal-error")},T:!0,F:!0},Ss={endpoint:"verifyAssertion",D:function(t){if(Xa(t),!t.idToken)throw new Zr("internal-error")},Ra:Ja,K:$a,T:!0},Is={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Zr("invalid-custom-token")},K:Ga,T:!0,F:!0},Cs={endpoint:"verifyPassword",D:function(t){if(Ha(t),!t.password)throw new Zr("wrong-password")},K:Ga,T:!0,F:!0},Os={endpoint:"verifyPhoneNumber",D:za,K:Ga,F:!0},Ns={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Zr("internal-error");za(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",ko(t);Ga(t)}},As={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:za,K:Ga,F:!0};function Ds(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Zt(new Zr("internal-error"));var r,i=e.Kb||"POST";return $t(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,n,r,i,o){var a=In(t.h+e);En(a,"key",t.c),o&&En(a,"cb",I().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&En(a,u,r[u]);return new Ht(function(e,o){Ba(t,a.toString(),function(t){t?t.error?o(Rs(t,i||{})):e(t):o(new Zr("network-request-failed"))},n,s?void 0:Yn(Or(r)),t.a,t.i.get())})}(t,e.endpoint,i,n,e.Yb,e.wb||!1)}).then(function(t){return r=t,e.Ra?e.Ra(n,r):r}).then(e.K).then(function(){if(!e.fa)return r;if(!(e.fa in r))throw new Zr("internal-error");return r[e.fa]})}function ks(t){return Rs({error:{errors:[{message:t}],code:400,message:t}})}function Rs(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Zr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",J(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Zr(r[i],e);return!e&&t&&(e=Cr(t)),new Zr("internal-error",e)}function Ps(t){this.b=t,this.a=null,this.gb=function(t){return(js||(js=new Ht(function(t,e){function n(){kr(),wr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){kr(),e(Error("Network Error"))},timeout:Ls.get()})}if(wr("gapi.iframes.Iframe"))t();else if(wr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();s[r]=function(){wr("gapi.load")?n():e(Error("Network Error"))},$t(Ca(r=ot(Ms,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw js=null,t}))).then(function(){return new Ht(function(e,n){wr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:wr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},xs.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}var Ms=new $(et,"https://apis.google.com/js/api.js?onload=%{onload}"),Ls=new Rr(3e4,6e4),xs=new Rr(5e3,15e3),js=null;function Fs(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Cn(this.i,"/__/auth/iframe"),En(this.a,"apiKey",this.g),En(this.a,"appName",this.h),this.b=null,this.c=[]}function Us(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Vs(t){try{return r.a.app(t).auth().Ca()}catch(t){return[]}}function qs(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Bs(t){var e=er();return function(t){return Ds(t,ms,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=In(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(0==o.indexOf("chrome-extension://")?a=In(o).b==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:ar.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){t=!0;break t}}t=!1}if(!t)throw new Ao(er())})}function Ws(t){return t.l?t.l:(t.l=ur().then(function(){if(!t.o){var e=t.c,n=t.h,r=Vs(t.b),i=new Fs(t.u,t.f,t.b);i.f=e,i.b=n,i.c=Q(r||[]),t.o=i.toString()}t.i=new Ps(t.o),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then(function(){t.a.register("authEvent",e,wr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=Io(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",$t(n)}return n.status="ERROR",$t(n)})}(t)}),t.l)}function Ks(t){return t.m||(t.v=t.c?vr(t.c,Vs(t.b)):null,t.m=new Pa(t.f,ki(t.h),t.v)),t.m}function Hs(t,e,n,r,i,o,a,s,u,c,h){return(t=new Us(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=Y(u||null),t.f=c,t.nb(h).toString()}function Qs(t){if(this.a=t||r.a.INTERNAL.reactNative&&r.a.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Zr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Gs(t){this.b=t,this.a={},this.f=E(this.c,this)}Fs.prototype.toString=function(){return this.f?En(this.a,"v",this.f):Fn(this.a.a,"v"),this.b?En(this.a,"eid",this.b):Fn(this.a.a,"eid"),this.c.length?En(this.a,"fw",this.c.join(",")):Fn(this.a.a,"fw"),this.a.toString()},Us.prototype.nb=function(t){return this.h=t,this},Us.prototype.toString=function(){var t=Cn(this.o,"/__/auth/handler");if(En(t,"apiKey",this.m),En(t,"appName",this.c),En(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=r.a.app(this.c).auth().ha()}catch(t){n=null}for(var i in e.bb=n,En(t,"providerId",this.a.providerId),n=Or((e=this.a).zb))n[i]=n[i].toString();i=e.Fc,n=Y(n);for(var o=0;o<i.length;o++){var a=i[o];a in n&&delete n[a]}e.eb&&e.bb&&!n[e.eb]&&(n[e.eb]=e.bb),z(n)||En(t,"customParameters",Cr(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&En(t,"scopes",e.join(","))),this.l?En(t,"redirectUrl",this.l):Fn(t.a,"redirectUrl"),this.g?En(t,"eventId",this.g):Fn(t.a,"eventId"),this.i?En(t,"v",this.i):Fn(t.a,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Sn(t,s)&&En(t,s,this.b[s]);return this.h?En(t,"tid",this.h):Fn(t.a,"tid"),this.f?En(t,"eid",this.f):Fn(t.a,"eid"),(s=Vs(this.c)).length&&En(t,"fw",s.join(",")),t.toString()},(t=qs.prototype).Fb=function(t,e,n){var r=new Zr("popup-closed-by-user"),i=new Zr("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return Ws(t).then(function(){return function(t,e){return t.gb.then(function(){return new Ht(function(n){t.a.send(e.type,e,n,wr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&ir(t),e(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(t){return new Ht(function(e){return function n(){fn(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!a)return fn(n).then(function(){e(r)})})},t.Ob=function(){var t=br();return!Ir(t)&&!Dr(t)},t.Jb=function(){return!1},t.Db=function(t,e,n,r,i,o,a,s){if(!t)return Zt(new Zr("popup-blocked"));if(a&&!Ir())return this.ia().s(function(e){ir(t),i(e)}),r(),$t();this.a||(this.a=Bs(Ks(this)));var u=this;return this.a.then(function(){var e=u.ia().s(function(e){throw ir(t),i(e),e});return r(),e}).then(function(){(Eo(n),a)||nr(Hs(u.u,u.f,u.b,e,n,null,o,u.c,void 0,u.h,s),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,r){this.a||(this.a=Bs(Ks(this)));var i=this;return this.a.then(function(){Eo(e),nr(Hs(i.u,i.f,i.b,t,e,er(),n,i.c,void 0,i.h,r))}).s(function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t})},t.ia=function(){var t=this;return Ws(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new Zr("network-request-failed")})},t.Rb=function(){return!0},t.Aa=function(t){this.g.push(t)},t.Na=function(t){K(this.g,function(e){return e==t})},(t=Qs.prototype).get=function(t){return $t(this.a.getItem(t)).then(function(t){return t&&Nr(t)})},t.set=function(t,e){return $t(this.a.setItem(t,Cr(e)))},t.S=function(t){return $t(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var zs,Ys=[];function Xs(t,e,n){z(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Js(t){this.a=t}function $s(t){this.c=t,this.b=!1,this.a=[]}function Zs(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Zt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new Ht(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return tu(t,c),e}).s(function(e){throw tu(t,c),e})}function tu(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),K(t.a,function(t){return t==e})}}function eu(){if(!iu())throw new Zr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=s.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var t=this;lr()&&self?(this.l=function(){var t=lr()?self:null;if(U(Ys,function(n){n.b==t&&(e=n)}),!e){var e=new Gs(t);Ys.push(e)}return e}(),Xs(this.l,"keyChanged",function(e,n){return cu(t).then(function(e){return 0<e.length&&U(t.a,function(t){t(e)}),{keyProcessed:B(e,n.key)}})}),Xs(this.l,"ping",function(){return $t(["keyChanged"])})):function(){var t=s.navigator;return t&&t.serviceWorker?$t().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):$t(null)}().then(function(e){(t.h=e)&&(t.g=new $s(new Js(e)),Zs(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&B(e[0].value,"keyChanged")&&(t.o=!0)}).s(function(){}))})}function nu(t){return new Ht(function(e,n){var r=t.u.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):function(t){return new Ht(function(e,n){var r=t.u.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(t).then(function(){return nu(t)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function ru(t){return t.m||(t.m=nu(t)),t.m}function iu(){try{return!!s.indexedDB}catch(t){return!1}}function ou(t){return t.objectStore("firebaseLocalStorage")}function au(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function su(t){return new Ht(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function uu(t,e){return t.g&&t.h&&function(){var t=s.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Zs(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):$t()}function cu(t){return ru(t).then(function(t){var e=ou(au(t,!1));return e.getAll?su(e.getAll()):new Ht(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function hu(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function lu(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=$t().then(function(){if(iu()){var t=Ar(),r="__sak"+t;return zs||(zs=new eu),(n=zs).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.S(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.$(function(t){U(e.a,function(e){e(t)})}),t})}function fu(){this.a={},this.type="inMemory"}function pu(){if(!function(){var t="Node"==fr();if(!(t=du()||t&&r.a.INTERNAL.node&&r.a.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==fr())throw new Zr("internal-error","The LocalStorage compatibility library was not found.");throw new Zr("web-storage-unsupported")}this.a=du()||r.a.INTERNAL.node.localStorage,this.type="localStorage"}function du(){try{var t=s.localStorage,e=Ar();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function mu(){this.type="nullStorage"}function gu(){if(!function(){var t="Node"==fr();if(!(t=yu()||t&&r.a.INTERNAL.node&&r.a.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==fr())throw new Zr("internal-error","The SessionStorage compatibility library was not found.");throw new Zr("web-storage-unsupported")}this.a=yu()||r.a.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function yu(){try{var t=s.sessionStorage,e=Ar();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function vu(){var t={};t.Browser=_u,t.Node=Tu,t.ReactNative=Eu,t.Worker=Su,this.a=t[fr()]}Gs.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];U(r,function(e){i.push($t().then(function(){return e(t.origin,t.data.data)}))}),ee(i).then(function(r){var i=[];U(r,function(t){i.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),U(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},Js.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},$s.prototype.close=function(){for(;0<this.a.length;)tu(this,this.a[0]);this.b=!0},(t=eu.prototype).set=function(t,e){var n,r=!1,i=this;return ru(this).then(function(e){return su((e=ou(au(n=e,!0))).get(t))}).then(function(o){var a=ou(au(n,!0));return o?(o.value=e,su(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,su(a.add(o)))}).then(function(){return i.c[t]=e,uu(i,t)}).ka(function(){r&&i.b--})},t.get=function(t){return ru(this).then(function(e){return su(ou(au(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.S=function(t){var e=!1,n=this;return ru(this).then(function(r){return e=!0,n.b++,su(ou(au(r,!0)).delete(t))}).then(function(){return delete n.c[t],uu(n,t)}).ka(function(){e&&n.b--})},t.$=function(t){0==this.a.length&&function(t){hu(t),function e(){t.f=setTimeout(function(){t.i=cu(t).then(function(e){0<e.length&&U(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(t){K(this.a,function(e){return e==t}),0==this.a.length&&hu(this)},(t=lu.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.S=function(t){return this.b.then(function(e){return e.S(t)})},t.$=function(t){this.a.push(t)},t.ea=function(t){K(this.a,function(e){return e==t})},(t=fu.prototype).get=function(t){return $t(this.a[t])},t.set=function(t,e){return this.a[t]=e,$t()},t.S=function(t){return delete this.a[t],$t()},t.$=function(){},t.ea=function(){},(t=pu.prototype).get=function(t){var e=this;return $t().then(function(){return Nr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return $t().then(function(){var r=Cr(e);null===r?n.S(t):n.a.setItem(t,r)})},t.S=function(t){var e=this;return $t().then(function(){e.a.removeItem(t)})},t.$=function(t){s.window&&ze(s.window,"storage",t)},t.ea=function(t){s.window&&Je(s.window,"storage",t)},(t=mu.prototype).get=function(){return $t(null)},t.set=function(){return $t()},t.S=function(){return $t()},t.$=function(){},t.ea=function(){},(t=gu.prototype).get=function(t){var e=this;return $t().then(function(){return Nr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return $t().then(function(){var r=Cr(e);null===r?n.S(t):n.a.setItem(t,r)})},t.S=function(t){var e=this;return $t().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var bu,wu,_u={C:pu,Ta:gu},Tu={C:pu,Ta:gu},Eu={C:Qs,Ta:mu},Su={C:pu,Ta:mu},Iu={ad:"local",NONE:"none",cd:"session"};function Cu(){var t=!(Dr(br())||!hr()),e=Ir(),n=_r();this.m=t,this.h=e,this.l=n,this.a={},bu||(bu=new vu),t=bu;try{this.g=!tr()&&Lr()||!s.indexedDB?new t.a.C:new lu(lr()?new fu:new t.a.C)}catch(t){this.g=new fu,this.h=!0}try{this.i=new t.a.Ta}catch(t){this.i=new fu}this.u=new fu,this.f=E(this.Pb,this),this.b={}}function Ou(){return wu||(wu=new Cu),wu}function Nu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Au(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Du(t,e,n){return n=Au(e,n),"local"==e.C&&(t.b[n]=null),Nu(t,e.C).S(n)}function ku(t){t.c&&(clearInterval(t.c),t.c=null)}function Ru(t){this.a=t,this.b=Ou()}(t=Cu.prototype).get=function(t,e){return Nu(this,t.C).get(Au(t,e))},t.set=function(t,e,n){var r=Au(t,n),i=this,o=Nu(this,t.C);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.C&&(i.b[r]=e)})},t.addListener=function(t,e,n){t=Au(t,e),this.l&&(this.b[t]=s.localStorage.getItem(t)),z(this.a)&&(Nu(this,"local").$(this.f),this.h||(tr()||!Lr())&&s.indexedDB||!this.l||function(t){ku(t),t.c=setInterval(function(){for(var e in t.a){var n=s.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new je({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Pb(n))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Au(t,e),this.a[t]&&(K(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),z(this.a)&&(Nu(this,"local").ea(this.f),ku(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=s.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.$a(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Nu(this,"local").ea(this.f):ku(this),this.m)if(n=s.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?s.localStorage.setItem(e,r):s.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===s.localStorage.getItem(e)||(o.b[e]=s.localStorage.getItem(e),o.$a(e))},we&&Ae&&10==Ae&&s.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else U(t,E(this.$a,this))},t.$a=function(t){this.a[t]&&U(this.a[t],function(t){t()})};var Pu,Mu={name:"authEvent",C:"local"};function Lu(){this.a=Ou()}function xu(t,e){this.b=ju,this.f=s.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=s.Int32Array?new Int32Array(64):Array(64),void 0!==Pu||(Pu=s.Int32Array?new Int32Array(Ku):Ku),this.reset()}C(xu,function(){this.b=-1});for(var ju=64,Fu=ju-1,Uu=[],Vu=0;Vu<Fu;Vu++)Uu[Vu]=0;var qu=H(128,Uu);function Bu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Pu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Wu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(u(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Bu(t),i=0);else{if(!g(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Bu(t),i=0)}}t.c=i,t.g+=n}xu.prototype.reset=function(){this.g=this.c=0,this.a=s.Int32Array?new Int32Array(this.h):Q(this.h)};var Ku=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Hu(){xu.call(this,8,Qu)}C(Hu,xu);var Qu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Gu(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Lu,this.g=new Ru(this.h),this.f=null,this.b=[],this.a=this.c=null}function zu(t){return new Zr("invalid-cordova-configuration",t)}function Yu(t){var e=new Hu;Wu(e,t),t=[];var n=8*e.g;56>e.c?Wu(e,qu,56-e.c):Wu(e,qu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Bu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return V(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Xu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Ju(t){return t.f||(t.f=t.ia().then(function(){return new Ht(function(e){t.Aa(function n(r){return e(r),t.Na(n),!1}),function(t){function e(e){r=!0,i&&i.cancel(),$u(t).then(function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=Hi(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Nr(Sn(o=In(i),"firebaseError")||null))?ti(o):null)?new So(r.c,r.b,null,null,o,null,r.R()):new So(r.c,r.b,i,r.f,null,null,r.R())),i=o||n}Xu(t,i)})}var n=new So("unknown",null,null,null,new Zr("no-auth-event")),r=!1,i=fn(500).then(function(){return $u(t).then(function(){r||Xu(t,n)})}),o=s.handleOpenURL;s.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(wr("BuildInfo.packageName",s).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},No||(No=new Co),function(t){var e=No;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=wr("universalLinks.subscribe",s))&&t(null,e.b))}(e)}(t)})})),t.f}function $u(t){var e=null;return function(t){return t.b.get(Mu,t.a).then(function(t){return Io(t)})}(t.g).then(function(n){return e=n,Du((n=t.g).b,Mu,n.a)}).then(function(){return e})}function Zu(t){this.a=t,this.b=Ou()}(t=Gu.prototype).ia=function(){return this.Da?this.Da:this.Da=(cr(void 0)?ur().then(function(){return new Ht(function(t,e){var n=s.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Zt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof wr("universalLinks.subscribe",s))throw zu("cordova-universal-links-plugin-fix is not installed");if(void 0===wr("BuildInfo.packageName",s))throw zu("cordova-plugin-buildinfo is not installed");if("function"!=typeof wr("cordova.plugins.browsertab.openUrl",s))throw zu("cordova-plugin-browsertab is not installed");if("function"!=typeof wr("cordova.InAppBrowser.open",s))throw zu("cordova-plugin-inappbrowser is not installed")},function(){throw new Zr("cordova-not-ready")})},t.Fb=function(t,e){return e(new Zr("operation-not-supported-in-this-environment")),$t()},t.Db=function(){return Zt(new Zr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Zt(new Zr("redirect-operation-pending"));var i=this,o=s.document,a=null,u=null,c=null,h=null;return this.c=$t().then(function(){return Eo(e),Ju(i)}).then(function(){return function(t,e,n,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new So(e,r,null,o,new Zr("no-auth-event"),null,i),u=wr("BuildInfo.packageName",s);if("string"!=typeof u)throw new Zr("invalid-cordova-configuration");var c=wr("BuildInfo.displayName",s),h={};if(br().toLowerCase().match(/iphone|ipad|ipod/))h.ibi=u;else{if(!br().toLowerCase().match(/android/))return Zt(new Zr("operation-not-supported-in-this-environment"));h.apn=u}c&&(h.appDisplayName=c),o=Yu(o),h.sessionId=o;var l=Hs(t.u,t.i,t.l,e,n,null,r,t.m,h,t.o,i);return t.ia().then(function(){var e=t.h;return t.v.a.set(Mu,a.A(),e)}).then(function(){var e=wr("cordova.plugins.browsertab.isAvailable",s);if("function"!=typeof e)throw new Zr("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=wr("cordova.plugins.browsertab.openUrl",s)))throw new Zr("invalid-cordova-configuration");n(l)}else{if("function"!=typeof(n=wr("cordova.InAppBrowser.open",s)))throw new Zr("invalid-cordova-configuration");e=br(),t.a=n(l,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,n,r)}).then(function(){return new Ht(function(t,e){u=function(){var e=wr("cordova.plugins.browsertab.close",s);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Aa(u),c=function(){a||(a=fn(2e3).then(function(){e(new Zr("redirect-cancelled-by-user"))}))},h=function(){Pr()&&c()},o.addEventListener("resume",c,!1),br().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",h,!1)}).s(function(t){return $u(i).then(function(){throw t})})}).ka(function(){c&&o.removeEventListener("resume",c,!1),h&&o.removeEventListener("visibilitychange",h,!1),a&&a.cancel(),u&&i.Na(u),i.c=null})},t.Aa=function(t){this.b.push(t),Ju(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new So("unknown",null,null,null,new Zr("no-auth-event")),t(e))})},t.Na=function(t){K(this.b,function(e){return e==t})};var tc={name:"pendingRedirect",C:"session"};function ec(t){return Du(t.b,tc,t.a)}function nc(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=E(this.o,this),this.b=new gc,this.w=new _c,this.g=new Zu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=rc(this.B,this.u,this.m,Ai)}function rc(t,e,n,i){var o=r.a.SDK_VERSION||null;return cr()?new Gu(t,e,n,o,i):new qs(t,e,n,o,i)}function ic(t){t.f||(t.f=!0,t.a.Aa(t.l));var e=t.a;return t.a.ia().s(function(n){throw t.a==e&&t.reset(),n})}function oc(t){t.a.Ob()&&ic(t).s(function(e){var n=new So("unknown",null,null,null,new Zr("operation-not-supported-in-this-environment"));lc(e)&&t.o(n)}),t.a.Jb()||yc(t.b)}function ac(t,e){B(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(tc,t.a).then(function(t){return"pending"==t})}(t.g).then(function(e){e?ec(t.g).then(function(){ic(t).s(function(e){var n=new So("unknown",null,null,null,new Zr("operation-not-supported-in-this-environment"));lc(e)&&t.o(n)})}):oc(t)}).s(function(){oc(t)})}function sc(t,e){K(t.h,function(t){return t==e})}nc.prototype.reset=function(){this.f=!1,this.a.Na(this.l),this.a=rc(this.B,this.u,this.m),this.i={}},nc.prototype.o=function(t){if(!t)throw new Zr("invalid-auth-event");if(6e5<=I()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=I())),e=!0;break}}return yc(this.b),e};var uc=new Rr(2e3,1e4),cc=new Rr(3e4,6e4);function hc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.Aa(t.l))},function(){t.reset()},i,o,a)}function lc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function fc(t,e,n,r,i){var o;return function(t){return t.b.set(tc,"pending",t.a)}(t.g).then(function(){return t.a.Eb(e,n,r,i).s(function(e){if(lc(e))throw new Zr("operation-not-supported-in-this-environment");return o=e,ec(t.g).then(function(){throw o})}).then(function(){return t.a.Rb()?new Ht(function(){}):ec(t.g).then(function(){return t.oa()}).then(function(){}).s(function(){})})})}function pc(t,e,n,r,i){return t.a.Fb(r,function(t){e.ja(n,null,t,i)},uc.get())}nc.prototype.oa=function(){return this.b.oa()};var dc={};function mc(t,e,n){var r=e+":"+n;return dc[r]||(dc[r]=new nc(t,e,n)),dc[r]}function gc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function yc(t){t.g||(t.g=!0,wc(t,!1,null,null))}function vc(t){t.g&&!t.i&&wc(t,!1,null,null)}function bc(t,e){if(t.b=function(){return $t(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function wc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Zt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):bc(t,n):bc(t,{user:null}),t.f=[],t.c=[]}function _c(){}function Tc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function Ec(t,e){this.a=e,Vr(this,"verificationId",t)}function Sc(t,e,n,r){return new wo(t).Wa(e,n).then(function(t){return new Ec(t,r)})}function Ic(t){var e=Ni(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Zr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");qr(this,{token:t,expirationTime:Mr(1e3*e.exp),authTime:Mr(1e3*e.auth_time),issuedAtTime:Mr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Cc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Oc(t){this.f=t,this.b=this.a=null,this.c=0}function Nc(t,e){var n=e[La],r=e.refreshToken;e=Ac(e.expiresIn),t.b=n,t.c=e,t.a=r}function Ac(t){return I()+1e3*parseInt(t,10)}function Dc(t,e){return function(t,e){return new Ht(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?Ba(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?r(Rs(t)):t.access_token&&t.refresh_token?n(t):r(new Zr("internal-error")):r(new Zr("network-request-failed"))},"POST",jn(e).toString(),t.g,t.u.get()):r(new Zr("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=Ac(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}function kc(t,e){this.a=t||null,this.b=e||null,qr(this,{lastSignInTime:Mr(e||null),creationTime:Mr(t||null)})}function Rc(t,e,n,r,i,o){qr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Pc(t,e){for(var n in xe.call(this,t),e)this[n]=e[n]}function Mc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=r.a.SDK_VERSION?vr(r.a.SDK_VERSION):null,this.a=new Pa(this.l,ki(Ai),t),this.b=new Oc(this.a),qc(this,e[La]),Nc(this.b,e),Vr(this,"refreshToken",this.b.a),Kc(this,n||{}),sn.call(this),this.J=!1,this.o&&Tr()&&(this.i=mc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(t){return new Cc(function(){return t.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.b.c-I()-3e5;return 0<e?e:0})}(this),this.W=E(this.Ja,this);var i=this;this.ga=null,this.xa=function(t){i.ua(t.g)},this.Z=null,this.P=[],this.wa=function(t){xc(i,t.c)},this.Y=null}function Lc(t,e){t.Z&&Je(t.Z,"languageCodeChanged",t.xa),(t.Z=e)&&ze(e,"languageCodeChanged",t.xa)}function xc(t,e){t.P=e,qa(t.a,r.a.SDK_VERSION?vr(r.a.SDK_VERSION,t.P):null)}function jc(t,e){t.Y&&Je(t.Y,"frameworkChanged",t.wa),(t.Y=e)&&ze(e,"frameworkChanged",t.wa)}function Fc(t){try{return r.a.app(t.m).auth()}catch(e){throw new Zr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function Uc(t){t.B||t.w.b||(t.w.start(),Je(t,"tokenChanged",t.W),ze(t,"tokenChanged",t.W))}function Vc(t){Je(t,"tokenChanged",t.W),t.w.stop()}function qc(t,e){t.ma=e,Vr(t,"_lat",e)}function Bc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return ee(e).then(function(){return t})}function Wc(t){t.i&&!t.J&&(t.J=!0,ac(t.i,t))}function Kc(t,e){qr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new kc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Hc(){}function Qc(t){return $t().then(function(){if(t.B)throw new Zr("app-deleted")})}function Gc(t){return V(t.providerData,function(t){return t.providerId})}function zc(t,e){e&&(Yc(t,e.providerId),t.providerData.push(e))}function Yc(t,e){K(t.providerData,function(t){return t.providerId==e})}function Xc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Vr(t,e,n)}function Jc(t,e){t!=e&&(qr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),e.metadata?Vr(t,"metadata",function(t){return new kc(t.a,t.b)}(e.metadata)):Vr(t,"metadata",new kc),U(e.providerData,function(e){zc(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.b,e.b),Vr(t,"refreshToken",t.b.a))}function $c(t){return t.G().then(function(e){var n=t.isAnonymous;return function(t,e){return Ds(t.a,ls,{idToken:e}).then(E(t.zc,t))}(t,e).then(function(){return n||Xc(t,"isAnonymous",!1),e})})}function Zc(t,e){e[La]&&t.ma!=e[La]&&(Nc(t.b,e),t.dispatchEvent(new Pc("tokenChanged")),qc(t,e[La]),Xc(t,"refreshToken",t.b.a))}function th(t,e){return $c(t).then(function(){if(B(Gc(t),e))return Bc(t).then(function(){throw new Zr("provider-already-linked")})})}function eh(t,e,n){return Br({user:t,credential:To(e),additionalUserInfo:e=xi(e),operationType:n})}function nh(t,e){return Zc(t,e),t.reload().then(function(){return t})}function rh(t,e,n,i,o){if(!Tr())return Zt(new Zr("operation-not-supported-in-this-environment"));if(t.h&&!o)return Zt(t.h);var a=Li(n.providerId),s=Ar(t.uid+":::"),u=null;(!Ir()||hr())&&t.o&&n.isOAuthProvider&&(u=Hs(t.o,t.l,t.m,e,n,null,s,r.a.SDK_VERSION||null,null,null,t.tenantId));var c=or(u,a&&a.sa,a&&a.ra);return i=i().then(function(){if(oh(t),!o)return t.G().then(function(){})}).then(function(){return hc(t.i,c,e,n,s,!!u,t.tenantId)}).then(function(){return new Ht(function(n,r){t.ja(e,null,new Zr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=s,t.c=pc(t.i,t,e,c,s)})}).then(function(t){return c&&ir(c),t?Br(t):null}).s(function(t){throw c&&ir(c),t}),ah(t,i,o)}function ih(t,e,n,r,i){if(!Tr())return Zt(new Zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Zt(t.h);var o=null,a=Ar(t.uid+":::");return r=r().then(function(){if(oh(t),!i)return t.G().then(function(){})}).then(function(){return t.ca=a,Bc(t)}).then(function(e){return t.da&&(e=(e=t.da).b.set(ch,t.A(),e.a)),e}).then(function(){return fc(t.i,e,n,a,t.tenantId)}).s(function(e){if(o=e,t.da)return hh(t.da);throw o}).then(function(){if(o)throw o}),ah(t,r,i)}function oh(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Zr("internal-error");throw new Zr("auth-domain-config-required")}}function ah(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Zt(t.h)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new Pc("userInvalidated")),t.h=e),e})}(t,e,n);return t.I.push(r),r.ka(function(){W(t.I,r)}),r}function sh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[La]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-I())/1e3;var r=new Mc(e,n,t);return t.providerData&&U(t.providerData,function(t){t&&zc(r,Br(t))}),t.redirectEventId&&(r.ca=t.redirectEventId),r}function uh(t){this.a=t,this.b=Ou()}gc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},gc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(wc(this,!0,null,t.a),$t()):e.Ba(n,r)?function(t,e,n){n=n.Ba(e.c,e.b);var r=e.g,i=e.f,o=e.i,a=e.R(),s=!!e.c.match(/Redirect$/);n(r,i,a,o).then(function(e){wc(t,s,e,null)}).s(function(e){wc(t,s,null,e)})}(this,t,e):Zt(new Zr("invalid-auth-event")):(wc(this,!1,null,null),$t())}else Zt(new Zr("invalid-auth-event"))},gc.prototype.oa=function(){var t=this;return new Ht(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new Zr("timeout");t.a&&t.a.cancel(),t.a=fn(cc.get()).then(function(){t.b||(t.g=!0,wc(t,!0,null,e))})}(t))})},_c.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),$t()):e.Ba(n,r)?function(t,e){var n=t.b,r=t.c;e.Ba(r,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(r,t,null,n)}).s(function(t){e.ja(r,null,t,n)})}(t,e):Zt(new Zr("invalid-auth-event"))}else Zt(new Zr("invalid-auth-event"))},Ec.prototype.confirm=function(t){return t=_o(this.verificationId,t),this.a(t)},Cc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop();e.b=fn(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then(function(){return t=s.document,e=null,Pr()||!t?$t():new Ht(function(n){e=function(){Pr()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},Cc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Oc.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Oc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Zt(new Zr("user-token-expired")):t||!this.b||I()>this.c-3e4?this.a?Dc(this,{grant_type:"refresh_token",refresh_token:this.a}):$t(null):$t({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},kc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},C(Pc,xe),C(Mc,sn),Mc.prototype.ua=function(t){this.ga=t,Va(this.a,t)},Mc.prototype.ha=function(){return this.ga},Mc.prototype.Ca=function(){return Q(this.P)},Mc.prototype.Ja=function(){this.w.b&&(this.w.stop(),this.w.start())},Vr(Mc.prototype,"providerId","firebase"),(t=Mc.prototype).reload=function(){var t=this;return ah(this,Qc(this).then(function(){return $c(t).then(function(){return Bc(t)}).then(Hc)}))},t.dc=function(t){return this.G(t).then(function(t){return new Ic(t)})},t.G=function(t){var e=this;return ah(this,Qc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Zr("internal-error");return t.accessToken!=e.ma&&(qc(e,t.accessToken),e.dispatchEvent(new Pc("tokenChanged"))),Xc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Zr("internal-error");Kc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?V(t,function(t){return new Rc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)zc(this,e[n]);Xc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Fr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return ah(this,t.f(this.a,this.uid).then(function(t){return Zc(e,t),n=eh(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return Fr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(t){var e=this,n=null;return ah(this,th(this,t.providerId).then(function(){return e.G()}).then(function(n){return t.b(e.a,n)}).then(function(t){return n=eh(e,t,"link"),nh(e,t)}).then(function(){return n}))},t.sc=function(t,e){var n=this;return ah(this,th(this,"phone").then(function(){return Sc(Fc(n),t,e,E(n.fb,n))}))},t.Bc=function(t,e){var n=this;return ah(this,$t().then(function(){return Sc(Fc(n),t,e,E(n.hb,n))}),!0)},t.rb=function(t){var e=this;return ah(this,this.G().then(function(n){return e.a.rb(n,t)}).then(function(t){return Zc(e,t),e.reload()}))},t.Sc=function(t){var e=this;return ah(this,this.G().then(function(n){return t.b(e.a,n)}).then(function(t){return Zc(e,t),e.reload()}))},t.sb=function(t){var e=this;return ah(this,this.G().then(function(n){return e.a.sb(n,t)}).then(function(t){return Zc(e,t),e.reload()}))},t.tb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Qc(this);var e=this;return ah(this,this.G().then(function(n){return e.a.tb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Zc(e,t),Xc(e,"displayName",t.displayName||null),Xc(e,"photoURL",t.photoUrl||null),U(e.providerData,function(t){"password"===t.providerId&&(Vr(t,"displayName",e.displayName),Vr(t,"photoURL",e.photoURL))}),Bc(e)}).then(Hc))},t.Qc=function(t){var e=this;return ah(this,$c(this).then(function(n){return B(Gc(e),t)?function(t,e,n){return Ds(t,us,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then(function(t){var n={};return U(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),U(Gc(e),function(t){n[t]||Yc(e,t)}),n[wo.PROVIDER_ID]||Vr(e,"phoneNumber",null),Bc(e)}):Bc(e).then(function(){throw new Zr("no-such-provider")})}))},t.delete=function(){var t=this;return ah(this,this.G().then(function(e){return Ds(t.a,ss,{idToken:e})}).then(function(){t.dispatchEvent(new Pc("userDeleted"))})).then(function(){for(var e=0;e<t.I.length;e++)t.I[e].cancel("app-deleted");Lc(t,null),jc(t,null),t.I=[],t.B=!0,Vc(t),Vr(t,"refreshToken",null),t.i&&sc(t.i,t)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?E(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?E(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?E(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?E(this.Cb,this):null},t.tc=function(t){var e=this;return rh(this,"linkViaPopup",t,function(){return th(e,t.providerId).then(function(){return Bc(e)})},!1)},t.Cc=function(t){return rh(this,"reauthViaPopup",t,function(){return $t()},!0)},t.uc=function(t){var e=this;return ih(this,"linkViaRedirect",t,function(){return th(e,t.providerId)},!1)},t.Dc=function(t){return ih(this,"reauthViaRedirect",t,function(){return $t()},!0)},t.Bb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return ah(this,this.G().then(function(n){return ts(i.a,{requestUri:t,postBody:r,sessionId:e,idToken:n})}).then(function(t){return o=eh(i,t,"link"),nh(i,t)}).then(function(){return o}))},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return ah(this,$t().then(function(){return Gi(es(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)}).then(function(t){return o=eh(i,t,"reauthenticate"),Zc(i,t),i.h=null,i.reload()}).then(function(){return o}),!0)},t.jb=function(t){var e=this,n=null;return ah(this,this.G().then(function(e){return n=e,void 0===t||z(t)?{}:Ti(new fi(t))}).then(function(t){return e.a.jb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&J(t,this.metadata.A()),U(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var ch={name:"redirectUser",C:"session"};function hh(t){return Du(t.b,ch,t.a)}function lh(t){this.a=t,this.b=Ou(),this.c=null,this.f=function(t){var e=dh("local"),n=dh("session"),r=dh("none");return function(t,e,n){var r=Au(e,n),i=Nu(t,e.C);return t.get(e,n).then(function(o){var a=null;try{a=Nr(s.localStorage.getItem(r))}catch(t){}if(a&&!o)return s.localStorage.removeItem(r),t.set(e,a,n);a&&o&&"localStorage"!=i.type&&s.localStorage.removeItem(r)})}(t.b,e,t.a).then(function(){return t.b.get(n,t.a)}).then(function(i){return i?n:t.b.get(r,t.a).then(function(n){return n?r:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(ph,t.a).then(function(t){return t?dh(t):e})})})}).then(function(e){return t.c=e,fh(t,e.C)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener(dh("local"),this.a,E(this.g,this))}function fh(t,e){var n,r=[];for(n in Iu)Iu[n]!==e&&r.push(Du(t.b,dh(Iu[n]),t.a));return r.push(Du(t.b,ph,t.a)),function(t){return new Ht(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)te(t[s],S(o,s),a);else e(i)})}(r)}lh.prototype.g=function(){var t=this,e=dh("local");vh(this,function(){return $t().then(function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null}).then(function(n){if(n)return fh(t,"local").then(function(){t.c=e})})})};var ph={name:"persistence",C:"session"};function dh(t){return{name:"authUser",C:t}}function mh(t,e){return vh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function gh(t){return vh(t,function(){return Du(t.b,t.c,t.a)})}function yh(t,e){return vh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),sh(t||{})})})}function vh(t,e){return t.f=t.f.then(e,e),t.f}function bh(t){if(this.l=!1,Vr(this,"settings",new Tc),Vr(this,"app",t),!Oh(this).options||!Oh(this).options.apiKey)throw new Zr("invalid-api-key");t=r.a.SDK_VERSION?vr(r.a.SDK_VERSION):null,this.b=new Pa(Oh(this).options&&Oh(this).options.apiKey,ki(Ai),t),this.O=[],this.m=[],this.J=[],this.Ub=r.a.INTERNAL.createSubscribe(E(this.oc,this)),this.W=void 0,this.Vb=r.a.INTERNAL.createSubscribe(E(this.pc,this)),Ih(this,null),this.h=new lh(Oh(this).options.apiKey+":"+Oh(this).name),this.w=new uh(Oh(this).options.apiKey+":"+Oh(this).name),this.Y=kh(this,function(t){var e=Oh(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(ch,t.a).then(function(t){return t&&e&&(t.authDomain=e),sh(t||{})})}(t.w,Oh(t).options.authDomain).then(function(e){return(t.B=e)&&(e.da=t.w),hh(t.w)});return kh(t,e)}(t).then(function(){return yh(t.h,e)}).then(function(e){return e?(e.da=t.w,t.B&&(t.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return mh(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:gh(t.h)})):null}).then(function(e){Ih(t,e||null)});return kh(t,n)}(this)),this.i=kh(this,function(t){return t.Y.then(function(){return Eh(t)}).s(function(){}).then(function(){if(!t.l)return t.ma()}).s(function(){}).then(function(){if(!t.l){t.ga=!0;var e=t.h;e.b.addListener(dh("local"),e.a,t.ma)}})}(this)),this.ga=!1,this.ma=E(this.Nc,this),this.ub=E(this.aa,this),this.wa=E(this.bc,this),this.xa=E(this.mc,this),this.Ja=E(this.nc,this),this.a=null,function(t){var e=Oh(t).options.authDomain,n=Oh(t).options.apiKey;e&&Tr()&&(t.Tb=t.Y.then(function(){if(!t.l){if(t.a=mc(e,n,Oh(t).name),ac(t.a,t),Nh(t)&&Wc(Nh(t)),t.B){Wc(t.B);var r=t.B;r.ua(t.ha()),Lc(r,t),xc(r=t.B,t.I),jc(r,t),t.B=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=E(this.delete,this),this.INTERNAL.logFramework=E(this.vc,this),this.o=0,sn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.ua(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function wh(t){xe.call(this,"languageCodeChanged"),this.g=t}function _h(t){xe.call(this,"frameworkChanged"),this.c=t}function Th(t){return t.Tb||Zt(new Zr("auth-domain-config-required"))}function Eh(t){if(!Tr())return Zt(new Zr("operation-not-supported-in-this-environment"));var e=Th(t).then(function(){return t.a.oa()}).then(function(t){return t?Br(t):null});return kh(t,e)}function Sh(t,e){var n={};return n.apiKey=Oh(t).options.apiKey,n.authDomain=Oh(t).options.authDomain,n.appName=Oh(t).name,t.Y.then(function(){return function(t,e,n,r){var i=new Mc(t,e);return n&&(i.da=n),r&&xc(i,r),i.reload().then(function(){return i})}(n,e,t.w,t.Ca())}).then(function(e){return Nh(t)&&e.uid==Nh(t).uid?(Jc(Nh(t),e),t.aa(e)):(Ih(t,e),Wc(e),t.aa(e))}).then(function(){Dh(t)})}function Ih(t,e){Nh(t)&&(function(t,e){K(t.O,function(t){return t==e})}(Nh(t),t.ub),Je(Nh(t),"tokenChanged",t.wa),Je(Nh(t),"userDeleted",t.xa),Je(Nh(t),"userInvalidated",t.Ja),Vc(Nh(t))),e&&(e.O.push(t.ub),ze(e,"tokenChanged",t.wa),ze(e,"userDeleted",t.xa),ze(e,"userInvalidated",t.Ja),0<t.o&&Uc(e)),Vr(t,"currentUser",e),e&&(e.ua(t.ha()),Lc(e,t),xc(e,t.I),jc(e,t))}function Ch(t,e){var n=null,r=null;return kh(t,e.then(function(e){return n=To(e),r=xi(e),Sh(t,e)}).then(function(){return Br({user:Nh(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Oh(t){return t.app}function Nh(t){return t.currentUser}function Ah(t){return Nh(t)&&Nh(t)._lat||null}function Dh(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Ah(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Ah(t))}}function kh(t,e){return t.O.push(e),e.ka(function(){W(t.O,e)}),e}function Rh(){}function Ph(){this.a={},this.b=1e12}lh.prototype.mb=function(t){var e=null,n=this;return function(t){var e=new Zr("invalid-persistence-type"),n=new Zr("unsupported-persistence-type");t:{for(r in Iu)if(Iu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(fr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!_r()&&"none"!==t)throw n}}(t),vh(this,function(){return t!=n.c.C?n.b.get(n.c,n.a).then(function(r){return e=r,fh(n,t)}).then(function(){if(n.c=dh(t),e)return n.b.set(n.c,e,n.a)}):$t()})},C(bh,sn),C(wh,xe),C(_h,xe),(t=bh.prototype).mb=function(t){return kh(this,t=this.h.mb(t))},t.ua=function(t){this.Z===t||this.l||(this.Z=t,Va(this.b,this.Z),this.dispatchEvent(new wh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=s.navigator;this.ua(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),qa(this.b,r.a.SDK_VERSION?vr(r.a.SDK_VERSION,this.I):null),this.dispatchEvent(new _h(this.I))},t.Ca=function(){return Q(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Oh(this).options.apiKey,authDomain:Oh(this).options.authDomain,appName:Oh(this).name,currentUser:Nh(this)&&Nh(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?E(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Za(i.b,t).then(function(t){return o=To(t),a=xi(t),t});return kh(this,t=i.Y.then(function(){return s}).then(function(t){return Sh(i,t)}).then(function(){return Br({user:Nh(i),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(t){if(!Tr())return Zt(new Zr("operation-not-supported-in-this-environment"));var e=this,n=Li(t.providerId),i=Ar(),o=null;(!Ir()||hr())&&Oh(this).options.authDomain&&t.isOAuthProvider&&(o=Hs(Oh(this).options.authDomain,Oh(this).options.apiKey,Oh(this).name,"signInViaPopup",t,null,i,r.a.SDK_VERSION||null,null,null,this.R()));var a=or(o,n&&n.sa,n&&n.ra);return kh(this,n=Th(this).then(function(n){return hc(n,a,"signInViaPopup",t,i,!!o,e.R())}).then(function(){return new Ht(function(t,n){e.ja("signInViaPopup",null,new Zr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=i,e.c=pc(e.a,e,"signInViaPopup",a,i)})}).then(function(t){return a&&ir(a),t?Br(t):null}).s(function(t){throw a&&ir(a),t}))},t.Mc=function(t){if(!Tr())return Zt(new Zr("operation-not-supported-in-this-environment"));var e=this;return kh(this,Th(this).then(function(){return vh(t=e.h,function(){return t.b.set(ph,t.c.C,t.a)});var t}).then(function(){return fc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var t=this;return Eh(this).then(function(e){return t.a&&vc(t.a.b),e}).s(function(e){throw t.a&&vc(t.a.b),e})},t.Rc=function(t){if(!t)return Zt(new Zr("null-user"));if(this.P!=t.tenantId)return Zt(new Zr("tenant-id-mismatch"));var e=this,n={};n.apiKey=Oh(this).options.apiKey,n.authDomain=Oh(this).options.authDomain,n.appName=Oh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[La]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-I())/1e3,e=new Mc(e,o),n&&(e.da=n),r&&xc(e,r),Jc(e,t),e}(t,n,e.w,e.Ca());return kh(this,this.i.then(function(){if(Oh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Nh(e)&&t.uid==Nh(e).uid?(Jc(Nh(e),t),e.aa(t)):(Ih(e,r),Wc(r),e.aa(r))}).then(function(){Dh(e)}))},t.pb=function(){var t=this;return kh(this,this.i.then(function(){return t.a&&vc(t.a.b),Nh(t)?(Ih(t,null),gh(t.h).then(function(){Dh(t)})):$t()}))},t.Nc=function(){var t=this;return yh(this.h,Oh(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=Nh(t)&&e){n=Nh(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Jc(Nh(t),e),Nh(t).G();(Nh(t)||e)&&(Ih(t,e),e&&(Wc(e),e.da=t.w),t.a&&ac(t.a,t),Dh(t))}})},t.aa=function(t){return mh(this.h,t)},t.bc=function(){Dh(this),this.aa(Nh(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Nh(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),kh(t,t.i.then(function(){!t.l&&B(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Ah(t)))}))}(this,function(){t.next(Nh(e))})},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){y(t)?t(Nh(r)):y(t.next)&&t.next(Nh(r))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){r.W=r.getUid(),y(t)?t(Nh(r)):y(t.next)&&t.next(Nh(r))}),this.Vb(t,e,n)},t.cc=function(t){var e=this;return kh(this,this.i.then(function(){return Nh(e)?Nh(e).G(t).then(function(t){return{accessToken:t}}):null}))},t.Hc=function(t){var e=this;return this.i.then(function(){return Ch(e,Ds(e.b,Is,{token:t}))}).then(function(t){var n=t.user;return Xc(n,"isAnonymous",!1),e.aa(n),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return Ch(n,Ds(n.b,Cs,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return Ch(n,Ds(n.b,os,{email:t,password:e}))})},t.Sa=function(t){var e=this;return this.i.then(function(){return Ch(e,t.na(e.b))})},t.Gc=function(t){return Fr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Sa(t)},t.ob=function(){var t=this;return this.i.then(function(){var e=Nh(t);if(e&&e.isAnonymous){var n=Br({providerId:null,isNewUser:!1});return Br({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return Ch(t,t.b.ob()).then(function(e){var n=e.user;return Xc(n,"isAnonymous",!0),t.aa(n),e})})},t.getUid=function(){return Nh(this)&&Nh(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Nh(this)&&Uc(Nh(this))},t.Ec=function(t){var e=this;U(this.m,function(n){n==t&&e.o--}),0>this.o&&(this.o=0),0==this.o&&Nh(this)&&Vc(Nh(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),kh(this,this.i.then(function(){e.l||B(e.m,t)&&t(Ah(e))}))},t.removeAuthTokenListener=function(t){K(this.m,function(e){return e==t})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(dh("local"),t.a,this.ma),this.a&&(sc(this.a,this),vc(this.a.b)),Promise.resolve()},t.$b=function(t){return kh(this,function(t,e){return Ds(t,as,{identifier:e,continueUri:Er()?er():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!go(t)},t.lb=function(t,e){var n=this;return kh(this,$t().then(function(){var t=new fi(e);if(!t.c)throw new Zr("argument-error",mi+" must be true when sending sign in link to email");return Ti(t)}).then(function(e){return n.b.lb(t,e)}).then(function(){}))},t.Uc=function(t){return this.Ma(t).then(function(t){return t.data.email})},t.ab=function(t,e){return kh(this,this.b.ab(t,e).then(function(){}))},t.Ma=function(t){return kh(this,this.b.Ma(t).then(function(t){return new Kr(t)}))},t.Ya=function(t){return kh(this,this.b.Ya(t).then(function(){}))},t.kb=function(t,e){var n=this;return kh(this,$t().then(function(){return void 0===e||z(e)?{}:Ti(new fi(e))}).then(function(e){return n.b.kb(t,e)}).then(function(){}))},t.Kc=function(t,e){return kh(this,Sc(this,t,e,E(this.Sa,this)))},t.Jc=function(t,e){var n=this;return kh(this,$t().then(function(){var r=e||er(),i=mo(t,r);if(!(r=go(r)))throw new Zr("argument-error","Invalid email link!");if(r.tenantId!==n.R())throw new Zr("tenant-id-mismatch");return n.Sa(i)}))},Rh.prototype.render=function(){},Rh.prototype.reset=function(){},Rh.prototype.getResponse=function(){},Rh.prototype.execute=function(){};var Mh=null;function Lh(t,e){return(e=xh(e))&&t.a[e]||null}function xh(t){return(t=void 0===t?1e12:t)?t.toString():null}function jh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Kn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ze(this.f,"click",this.i)}function Fh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Uh(){}Ph.prototype.render=function(t,e){return this.a[this.b.toString()]=new jh(t,e),this.b++},Ph.prototype.reset=function(t){var e=Lh(this,t);t=xh(t),e&&t&&(e.delete(),delete this.a[t])},Ph.prototype.getResponse=function(t){return(t=Lh(this,t))?t.getResponse():null},Ph.prototype.execute=function(t){(t=Lh(this,t))&&t.execute()},jh.prototype.getResponse=function(){return Fh(this),this.b},jh.prototype.execute=function(){Fh(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(t){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()},6e4)},500))},jh.prototype.delete=function(){Fh(this),this.g=!0,clearTimeout(this.a),this.a=null,Je(this.f,"click",this.i)},Uh.prototype.g=function(){return Mh||(Mh=new Ph),$t(Mh)},Uh.prototype.c=function(){};var Vh=null;function qh(){this.b=s.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Bh=new $(et,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Wh=new Rr(3e4,6e4);qh.prototype.g=function(t){var e=this;return new Ht(function(n,r){var i=setTimeout(function(){r(new Zr("network-request-failed"))},Wh.get());!s.grecaptcha||t!==e.f&&!e.b?(s[e.a]=function(){if(s.grecaptcha){e.f=t;var o=s.grecaptcha.render;s.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(s.grecaptcha)}else clearTimeout(i),r(new Zr("internal-error"));delete s[e.a]},$t(Ca(ot(Bh,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(i),r(new Zr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(i),n(s.grecaptcha))})},qh.prototype.c=function(){this.b--};var Kh=null;function Hh(t,e,n,r,i,o,a){if(Vr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a?(Vh||(Vh=new Uh),a=Vh):(Kh||(Kh=new qh),a=Kh),this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[zh])throw new Zr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Yh],!s.document)throw new Zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Kn(e)||!this.i&&Kn(e).hasChildNodes())throw new Zr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Pa(t,o||null,i||null),this.v=r||function(){return null};var u=this;this.l=[];var c=this.a[Qh];this.a[Qh]=function(t){if(Xh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=wr(c,s);"function"==typeof e&&e(t)}};var h=this.a[Gh];this.a[Gh]=function(){if(Xh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=wr(h,s);"function"==typeof t&&t()}}}var Qh="callback",Gh="expired-callback",zh="sitekey",Yh="size";function Xh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Jh(t,e){return t.h.push(e),e.ka(function(){W(t.h,e)}),e}function $h(t){if(t.B)throw new Zr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Zh(t,e,n){var i=!1;try{this.b=n||r.a.app()}catch(t){throw new Zr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Zr("invalid-api-key");n=this.b.options.apiKey;var o=this,a=null;try{a=this.b.auth().Ca()}catch(t){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}a=r.a.SDK_VERSION?vr(r.a.SDK_VERSION,a):null,Hh.call(this,n,t,e,function(){try{var t=o.b.auth().ha()}catch(e){t=null}return t},a,ki(Ai),i)}function tl(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Zr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],0>i||i>=el.length)throw new Zr("internal-error","Argument validator received an unsupported number of arguments.");n=el[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Zr("argument-error",t+" failed: "+r)}(t=Hh.prototype).Da=function(){var t=this;return this.f?this.f:this.f=Jh(this,$t().then(function(){if(Er()&&!lr())return ur();throw new Zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.m.g(t.v())}).then(function(e){return t.g=e,Ds(t.o,gs,{})}).then(function(e){t.a[zh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){$h(this);var t=this;return Jh(this,this.Da().then(function(){if(null===t.c){var e=t.u;if(!t.i){var n=Kn(e);e=Gn("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){$h(this);var t=this;return Jh(this,this.render().then(function(e){return new Ht(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){K(t.l,function(t){return t==e})}(t,i),n(e))};t.l.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){$h(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){$h(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Kn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},C(Zh,Hh);var el="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function nl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:u}}function rl(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:c}}function il(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:v}}function ol(t,e){return{name:t||"",M:"a function",optional:!!e,N:y}}function al(t,e){return{name:t||"",M:"null",optional:!!e,N:d}}function sl(t){return{name:t?t+"Credential":"credential",M:t?"a valid "+t+" credential":"a valid credential",optional:!1,N:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.na||!n)}}}function ul(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&u(t.type)&&y(t.verify))}}}function cl(t,e,n,r){return{name:n||"",M:t.M+" or "+e.M,optional:!!r,N:function(n){return t.N(n)||e.N(n)}}}function hl(t,e){for(var n in e){var r=e[n].name;t[r]=pl(r,t[n],e[n].j)}}function ll(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:S(function(t){return this[t]},n),set:S(function(t,e,n,r){tl(t,[n],[r],!0),this[e]=r},r,n,e[n].Za),enumerable:!0})}}function fl(t,e,n,r){t[e]=pl(e,n,r)}function pl(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return tl(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}hl(bh.prototype,{Ya:{name:"applyActionCode",j:[nl("code")]},Ma:{name:"checkActionCode",j:[nl("code")]},ab:{name:"confirmPasswordReset",j:[nl("code"),nl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[nl("email"),nl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[nl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[nl("emailLink")]},wc:{name:"onAuthStateChanged",j:[cl(il(),ol(),"nextOrObserver"),ol("opt_error",!0),ol("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[cl(il(),ol(),"nextOrObserver"),ol("opt_error",!0),ol("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[nl("email"),cl(il("opt_actionCodeSettings",!0),al(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[nl("email"),il("actionCodeSettings")]},mb:{name:"setPersistence",j:[nl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[sl()]},ob:{name:"signInAnonymously",j:[]},Sa:{name:"signInWithCredential",j:[sl()]},Hc:{name:"signInWithCustomToken",j:[nl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[nl("email"),nl("password")]},Jc:{name:"signInWithEmailLink",j:[nl("email"),nl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[nl("phoneNumber"),ul()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[cl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Mc)}},al(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[nl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[nl("code")]}}),ll(bh.prototype,{lc:{name:"languageCode",Za:cl(nl(),al(),"languageCode")},ti:{name:"tenantId",Za:cl(nl(),al(),"tenantId")}}),bh.Persistence=Iu,bh.Persistence.LOCAL="local",bh.Persistence.SESSION="session",bh.Persistence.NONE="none",hl(Mc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[rl("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[rl("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[sl()]},fb:{name:"linkWithCredential",j:[sl()]},sc:{name:"linkWithPhoneNumber",j:[nl("phoneNumber"),ul()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[sl()]},hb:{name:"reauthenticateWithCredential",j:[sl()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[nl("phoneNumber"),ul()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[cl(il("opt_actionCodeSettings",!0),al(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[nl(null,!0)]},Qc:{name:"unlink",j:[nl("provider")]},rb:{name:"updateEmail",j:[nl("email")]},sb:{name:"updatePassword",j:[nl("password")]},Sc:{name:"updatePhoneNumber",j:[sl("phone")]},tb:{name:"updateProfile",j:[il("profile")]}}),hl(Ph.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),hl(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),hl(Ht.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),ll(Tc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Za:rl("appVerificationDisabledForTesting")}}),hl(Ec.prototype,{confirm:{name:"confirm",j:[nl("verificationCode")]}}),fl(Qi,"fromJSON",function(t){t=u(t)?JSON.parse(t):t;for(var e,n=[Zi,fo,vo,Xi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[cl(nl(),il(),"json")]),fl(po,"credential",function(t,e){return new lo(t,e)},[nl("email"),nl("password")]),hl(lo.prototype,{A:{name:"toJSON",j:[nl(null,!0)]}}),hl(ro.prototype,{ya:{name:"addScope",j:[nl("scope")]},Ga:{name:"setCustomParameters",j:[il("customOAuthParameters")]}}),fl(ro,"credential",io,[cl(nl(),il(),"token")]),fl(po,"credentialWithLink",mo,[nl("email"),nl("emailLink")]),hl(oo.prototype,{ya:{name:"addScope",j:[nl("scope")]},Ga:{name:"setCustomParameters",j:[il("customOAuthParameters")]}}),fl(oo,"credential",ao,[cl(nl(),il(),"token")]),hl(so.prototype,{ya:{name:"addScope",j:[nl("scope")]},Ga:{name:"setCustomParameters",j:[il("customOAuthParameters")]}}),fl(so,"credential",uo,[cl(nl(),cl(il(),al()),"idToken"),cl(nl(),al(),"accessToken",!0)]),hl(co.prototype,{Ga:{name:"setCustomParameters",j:[il("customOAuthParameters")]}}),fl(co,"credential",ho,[cl(nl(),il(),"token"),nl("secret",!0)]),hl(no.prototype,{ya:{name:"addScope",j:[nl("scope")]},credential:{name:"credential",j:[cl(nl(),cl(il(),al()),"optionsOrIdToken"),cl(nl(),al(),"accessToken",!0)]},Ga:{name:"setCustomParameters",j:[il("customOAuthParameters")]}}),hl(Ji.prototype,{A:{name:"toJSON",j:[nl(null,!0)]}}),hl(zi.prototype,{A:{name:"toJSON",j:[nl(null,!0)]}}),fl(wo,"credential",_o,[nl("verificationId"),nl("verificationCode")]),hl(wo.prototype,{Wa:{name:"verifyPhoneNumber",j:[nl("phoneNumber"),ul()]}}),hl(yo.prototype,{A:{name:"toJSON",j:[nl(null,!0)]}}),hl(Zr.prototype,{toJSON:{name:"toJSON",j:[nl(null,!0)]}}),hl(Do.prototype,{toJSON:{name:"toJSON",j:[nl(null,!0)]}}),hl(Ao.prototype,{toJSON:{name:"toJSON",j:[nl(null,!0)]}}),hl(Zh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),fl(ri,"parseLink",li,[nl("link")]),function(){if(void 0===r.a||!r.a.INTERNAL||!r.a.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Hr,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:bh,AuthCredential:Qi,Error:Zr};fl(t,"EmailAuthProvider",po,[]),fl(t,"FacebookAuthProvider",ro,[]),fl(t,"GithubAuthProvider",oo,[]),fl(t,"GoogleAuthProvider",so,[]),fl(t,"TwitterAuthProvider",co,[]),fl(t,"OAuthProvider",no,[nl("providerId")]),fl(t,"SAMLAuthProvider",eo,[nl("providerId")]),fl(t,"PhoneAuthProvider",wo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof bh)}}]),fl(t,"RecaptchaVerifier",Zh,[cl(nl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),il("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof r.a.app.App)}}]),fl(t,"ActionCodeURL",ri,[]),r.a.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new bh(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),r.a.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:E((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:E(t.cc,t),addAuthTokenListener:E(t.Wb,t),removeAuthTokenListener:E(t.Ec,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),r.a.registerVersion("@firebase/auth","0.13.3"),r.a.INTERNAL.extendNamespace({User:Mc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});n(8),n(5);var i=n(0),o=n(3),a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},s=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return Object(i.c)(e,t),e}(Error);var u=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then(function(t){return n.auth=t},function(){}),this.messaging||e.get().then(function(t){return n.messaging=t},function(){})}return t.prototype.getAuthToken=function(){return Object(i.b)(this,void 0,void 0,function(){var t;return Object(i.d)(this,function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getInstanceIdToken=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]})})},t.prototype.getContext=function(){return Object(i.b)(this,void 0,void 0,function(){var t,e;return Object(i.d)(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var h=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return c(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?c(t,function(t){return e.decode(t)}):t},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var l=function(){function t(t,e,n,r){var i=this;void 0===r&&(r="us-central1"),this.app_=t,this.region_=r,this.serializer=new h,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return i.deleteService()}},this.contextProvider=new u(e,n),this.cancelAllRequests=new Promise(function(t){i.deleteService=function(){return t()}})}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},t.prototype.postJSON=function(t,e,n){return Object(i.b)(this,void 0,void 0,function(){var r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:n.append("Content-Type","application/json"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=i.sent(),[3,4];case 3:return i.sent(),[2,{status:0,json:null}];case 4:o=null,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,r.json()];case 6:return o=i.sent(),[3,8];case 7:return i.sent(),[3,8];case 8:return[2,{status:r.status,json:o}]}})})},t.prototype.call=function(t,e,n){return Object(i.b)(this,void 0,void 0,function(){var r,o,u,c,h,l,f,p;return Object(i.d)(this,function(i){switch(i.label){case 0:return r=this._url(t),e=this.serializer.encode(e),o={data:e},u=new Headers,[4,this.contextProvider.getContext()];case 1:return(c=i.sent()).authToken&&u.append("Authorization","Bearer "+c.authToken),c.instanceIdToken&&u.append("Firebase-Instance-ID-Token",c.instanceIdToken),h=n.timeout||7e4,[4,Promise.race([this.postJSON(r,o,u),(d=h,new Promise(function(t,e){setTimeout(function(){e(new s("deadline-exceeded","deadline-exceeded"))},d)})),this.cancelAllRequests])];case 2:if(!(l=i.sent()))throw new s("cancelled","Firebase Functions instance was deleted.");if(f=function(t,e,n){var r=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var u=e&&e.error;if(u){var c=u.status;if("string"==typeof c){if(!a[c])return new s("internal","internal");r=a[c],i=c}var h=u.message;"string"==typeof h&&(i=h),void 0!==(o=u.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new s(r,i,o)}(l.status,l.json,this.serializer))throw f;if(!l.json)throw new s("internal","Response is not valid JSON object.");if(void 0===(p=l.json.data)&&(p=l.json.result),void 0===p)throw new s("internal","Response is missing data field.");return[2,{data:this.serializer.decode(p)}]}var d})})},t}(),f="functions";
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("messaging");return new l(n,r,i,e)}var d,m;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
d=r.a,m={Functions:l},d.INTERNAL.registerComponent(new o.a(f,p,"PUBLIC").setServiceProps(m).setMultipleInstances(!0)),r.a.registerVersion("@firebase/functions","0.4.29");var g=n(1);function y(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function v(t,e,n){var r,i=new Promise(function(i,o){y(r=t[e].apply(t,n)).then(i,o)});return i.request=r,i}function b(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function w(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return v(this[e],r,arguments)})})}function _(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function T(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return t=this[e],(n=v(t,r,arguments)).then(function(t){if(t)return new S(t,n.request)});var t,n})})}function E(t){this._index=t}function S(t,e){this._cursor=t,this._request=e}function I(t){this._store=t}function C(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function O(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new C(n)}function N(t){this._db=t}b(E,"_index",["name","keyPath","multiEntry","unique"]),w(E,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),T(E,"_index",IDBIndex,["openCursor","openKeyCursor"]),b(S,"_cursor",["direction","key","primaryKey","value"]),w(S,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(S.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,n),y(e._request).then(function(t){if(t)return new S(t,e._request)})})})}),I.prototype.createIndex=function(){return new E(this._store.createIndex.apply(this._store,arguments))},I.prototype.index=function(){return new E(this._store.index.apply(this._store,arguments))},b(I,"_store",["name","keyPath","indexNames","autoIncrement"]),w(I,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),T(I,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),_(I,"_store",IDBObjectStore,["deleteIndex"]),C.prototype.objectStore=function(){return new I(this._tx.objectStore.apply(this._tx,arguments))},b(C,"_tx",["objectStoreNames","mode"]),_(C,"_tx",IDBTransaction,["abort"]),O.prototype.createObjectStore=function(){return new I(this._db.createObjectStore.apply(this._db,arguments))},b(O,"_db",["name","version","objectStoreNames"]),_(O,"_db",IDBDatabase,["deleteObjectStore","close"]),N.prototype.transaction=function(){return new C(this._db.transaction.apply(this._db,arguments))},b(N,"_db",["name","version","objectStoreNames"]),_(N,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[I,E].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,n=(e=arguments,Array.prototype.slice.call(e)),r=n[n.length-1],i=this._store||this._index,o=i[t].apply(i,n.slice(0,-1));o.onsuccess=function(){r(o.result)}})})}),[E,I].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(i){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)})})})});var A,D="@firebase/installations",k="0.3.9",R=1e4,P="w:"+k,M="FIS_v2",L="https://firebaseinstallations.googleapis.com/v1",x=36e5,j=((A={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',A["not-registered"]="Firebase Installation is not registered.",A["installation-not-found"]="Firebase Installation not found.",A["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',A["app-offline"]="Could not process request. Application offline.",A["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",A),F=new g.c("installations","Installations",j);function U(t){return t instanceof g.d&&t.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V(t){var e=t.projectId;return L+"/projects/"+e+"/installations"}function q(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}function B(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),r=n.error,[2,F.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}})})}function W(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function K(t,e){var n=e.refreshToken,r=W(t);return r.append("Authorization",function(t){return M+" "+t}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)),r}function H(t){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.d)(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return(e=n.sent()).status>=500&&e.status<600?[2,t()]:[2,e]}})})}function Q(t,e){var n=e.fid;return Object(i.b)(this,void 0,void 0,function(){var e,r,o,a,s,u;return Object(i.d)(this,function(i){switch(i.label){case 0:return e=V(t),r=W(t),o={fid:n,authVersion:M,appId:t.appId,sdkVersion:P},a={method:"POST",headers:r,body:JSON.stringify(o)},[4,H(function(){return fetch(e,a)})];case 1:return(s=i.sent()).ok?[4,s.json()]:[3,3];case 2:return u=i.sent(),[2,{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:q(u.authToken)}];case 3:return[4,B("Create Installation",s)];case 4:throw i.sent()}})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G(t){return new Promise(function(e){setTimeout(e,t)})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var z=/^[cdef][\w-]{21}$/,Y="";function X(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return(e=t,btoa(String.fromCharCode.apply(String,Object(i.f)(e))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t);return z.test(e)?e:Y}catch(t){return Y}}var J,$="firebase-installations-database",Z=1,tt="firebase-installations-store",et=null;function nt(){var t,e,n;return et||(t=function(t){switch(t.oldVersion){case 0:t.createObjectStore(tt)}},e=v(indexedDB,"open",[$,Z]),(n=e.request)&&(n.onupgradeneeded=function(e){t&&t(new O(n.result,e.oldVersion,n.transaction))}),et=e.then(function(t){return new N(t)})),et}function rt(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return n=at(t),[4,nt()];case 1:return r=i.sent(),[4,(o=r.transaction(tt,"readwrite")).objectStore(tt).put(e,n)];case 2:return i.sent(),[4,o.complete];case 3:return i.sent(),[2,e]}})})}function it(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return e=at(t),[4,nt()];case 1:return n=i.sent(),[4,(r=n.transaction(tt,"readwrite")).objectStore(tt).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}})})}function ot(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r,o,a,s,u;return Object(i.d)(this,function(i){switch(i.label){case 0:return n=at(t),[4,nt()];case 1:return r=i.sent(),o=r.transaction(tt,"readwrite"),[4,(a=o.objectStore(tt)).get(n)];case 2:return s=i.sent(),void 0!==(u=e(s))?[3,4]:[4,a.delete(n)];case 3:return i.sent(),[3,6];case 4:return[4,a.put(u,n)];case 5:i.sent(),i.label=6;case 6:return[4,o.complete];case 7:return i.sent(),[2,u]}})})}function at(t){return t.appName+"!"+t.appId}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function st(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r;return Object(i.d)(this,function(o){switch(o.label){case 0:return[4,ot(t,function(n){var r=function(t){return ht(t||{fid:X(),registrationStatus:0})}(n),o=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine){var n=Promise.reject(F.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},o=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,Q(t,e)];case 1:return n=i.sent(),[2,rt(t,n)];case 2:return U(r=i.sent())&&409===r.serverCode?[4,it(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,rt(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:o}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ut(t)}:{installationEntry:e}}(t,r);return e=o.registrationPromise,o.installationEntry})];case 1:return(n=o.sent()).fid!==Y?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=o.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}})})}function ut(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,ct(t)];case 1:e=i.sent(),i.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,G(100)];case 3:return i.sent(),[4,ct(t)];case 4:return e=i.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,st(t)];case 6:return n=i.sent(),r=n.installationEntry,(o=n.registrationPromise)?[2,o]:[2,r];case 7:return[2,e]}})})}function ct(t){return ot(t,function(t){if(!t)throw F.create("installation-not-found");return ht(t)})}function ht(t){return 1===(e=t).registrationStatus&&e.registrationTime+R<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}function lt(t,e){var n=t.appConfig,r=t.platformLoggerProvider;return Object(i.b)(this,void 0,void 0,function(){var t,o,a,s,u,c,h;return Object(i.d)(this,function(i){switch(i.label){case 0:return t=function(t,e){var n=e.fid;return V(t)+"/"+n+"/authTokens:generate"}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n,e),o=K(n,e),(a=r.getImmediate({optional:!0}))&&o.append("x-firebase-client",a.getPlatformInfoString()),s={installation:{sdkVersion:P}},u={method:"POST",headers:o,body:JSON.stringify(s)},[4,H(function(){return fetch(t,u)})];case 1:return(c=i.sent()).ok?[4,c.json()]:[3,3];case 2:return h=i.sent(),[2,q(h)];case 3:return[4,B("Generate Auth Token",c)];case 4:throw i.sent()}})})}function ft(t,e){return void 0===e&&(e=!1),Object(i.b)(this,void 0,void 0,function(){var n,r,o;return Object(i.d)(this,function(a){switch(a.label){case 0:return[4,ot(t.appConfig,function(r){if(!dt(r))throw F.create("not-registered");var o,a=r.authToken;if(e||2!==(o=a).requestStatus||function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+x}(o)){if(1===a.requestStatus)return n=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,pt(t.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,G(100)];case 3:return i.sent(),[4,pt(t.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,ft(t,e)]:[2,r]}})})}(t,e),r;if(!navigator.onLine)throw F.create("app-offline");var s=function(t){var e={requestStatus:1,requestTime:Date.now()};return Object(i.a)(Object(i.a)({},t),{authToken:e})}(r);return n=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r,o;return Object(i.d)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,8]),[4,lt(t,e)];case 1:return n=a.sent(),o=Object(i.a)(Object(i.a)({},e),{authToken:n}),[4,rt(t.appConfig,o)];case 2:return a.sent(),[2,n];case 3:return!U(r=a.sent())||401!==r.serverCode&&404!==r.serverCode?[3,5]:[4,it(t.appConfig)];case 4:return a.sent(),[3,7];case 5:return o=Object(i.a)(Object(i.a)({},e),{authToken:{requestStatus:0}}),[4,rt(t.appConfig,o)];case 6:a.sent(),a.label=7;case 7:throw r;case 8:return[2]}})})}(t,s),s}return r})];case 1:return r=a.sent(),n?[4,n]:[3,3];case 2:return o=a.sent(),[3,4];case 3:o=r.authToken,a.label=4;case 4:return[2,o]}})})}function pt(t){return ot(t,function(t){if(!dt(t))throw F.create("not-registered");var e,n=t.authToken;return 1===(e=n).requestStatus&&e.requestTime+R<Date.now()?Object(i.a)(Object(i.a)({},t),{authToken:{requestStatus:0}}):t})}function dt(t){return void 0!==t&&2===t.registrationStatus}function mt(t){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.d)(this,function(n){switch(n.label){case 0:return[4,st(t)];case 1:return(e=n.sent().registrationPromise)?[4,e]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gt(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r,o,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return n=function(t,e){var n=e.fid;return V(t)+"/"+n}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e),r=K(t,e),o={method:"DELETE",headers:r},[4,H(function(){return fetch(n,o)})];case 1:return(a=i.sent()).ok?[3,3]:[4,B("Delete Installation",a)];case 2:throw i.sent();case 3:return[2]}})})}function yt(t){return F.create("missing-app-config-values",{valueName:t})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.INTERNAL.registerComponent(new o.a("installations",function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e,n;if(!t||!t.options)throw yt("App Configuration");if(!t.name)throw yt("App Name");try{for(var r=Object(i.h)(["projectId","apiKey","appId"]),o=r.next();!o.done;o=r.next()){var a=o.value;if(!t.options[a])throw yt(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */return function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,st(t.appConfig)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):ft(t).catch(console.error),[2,n.fid]}})})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)},getToken:function(t){return function(t,e){return void 0===e&&(e=!1),Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(n){switch(n.label){case 0:return[4,mt(t.appConfig)];case 1:return n.sent(),[4,ft(t,e)];case 2:return[2,n.sent().token]}})})}(n,t)},delete:function(){return function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,ot(e=t.appConfig,function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw F.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw F.create("app-offline");case 3:return[4,gt(e,n)];case 4:return r.sent(),[4,it(e)];case 5:r.sent(),r.label=6;case 6:return[2]}})})}(n)}}},"PUBLIC")),t.registerVersion(D,k)}(r.a);var vt,bt=((J={})["only-available-in-window"]="This method is available in a Window context.",J["only-available-in-sw"]="This method is available in a service worker context.",J["should-be-overriden"]="This method should be overriden by extended classes.",J["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",J["permission-default"]="The required permissions were not granted and dismissed instead.",J["permission-blocked"]="The required permissions were not granted and blocked instead.",J["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",J["notifications-blocked"]="Notifications have been blocked.",J["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",J["sw-registration-expected"]="A service worker registration was the expected input.",J["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",J["invalid-saved-token"]="Unable to access details of the saved token.",J["sw-reg-redundant"]="The service worker being used for push was made redundant.",J["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",J["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",J["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",J["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",J["token-update-no-token"]="FCM returned no token when updating the user to push.",J["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",J["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",J["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",J["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",J["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",J["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",J["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",J["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",J["failed-to-delete-token"]="Unable to delete the currently saved token.",J["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",J["bad-scope"]="The service worker scope must be a string with at least one character.",J["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",J["bad-subscription"]="The subscription must be a valid PushSubscription.",J["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",J["failed-delete-vapid-key"]="The VAPID key could not be deleted.",J["invalid-public-vapid-key"]="The public VAPID key must be a string.",J["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",J["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",J),wt=new g.c("messaging","Messaging",bt),_t=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),Tt="https://fcmregistrations.googleapis.com/v1";
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Et(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function St(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,Object(i.f)(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.PUSH_MSG_RECEIVED="push-msg-received",t.NOTIFICATION_CLICKED="notification-clicked"}(vt||(vt={}));var It=function(){function t(){}return t.prototype.getToken=function(t,e,n){return Object(i.b)(this,void 0,void 0,function(){var r,o,a,s,u,c;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,Ot(t)];case 1:r=i.sent(),o=Nt(e,n),a={method:"POST",headers:r,body:JSON.stringify(o)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Ct(t.app),a)];case 3:return[4,i.sent().json()];case 4:return s=i.sent(),[3,6];case 5:throw u=i.sent(),wt.create("token-subscribe-failed",{errorInfo:u});case 6:if(s.error)throw c=s.error.message,wt.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw wt.create("token-subscribe-no-token");return[2,s.token]}})})},t.prototype.updateToken=function(t,e,n,r){return Object(i.b)(this,void 0,void 0,function(){var o,a,s,u,c,h;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,Ot(e)];case 1:o=i.sent(),a=Nt(n,r),s={method:"PATCH",headers:o,body:JSON.stringify(a)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Ct(e.app)+"/"+t.fcmToken,s)];case 3:return[4,i.sent().json()];case 4:return u=i.sent(),[3,6];case 5:throw c=i.sent(),wt.create("token-update-failed",{errorInfo:c});case 6:if(u.error)throw h=u.error.message,wt.create("token-update-failed",{errorInfo:h});if(!u.token)throw wt.create("token-update-no-token");return[2,u.token]}})})},t.prototype.deleteToken=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r,o,a,s;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,Ot(t)];case 1:n=i.sent(),r={method:"DELETE",headers:n},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Ct(t.app)+"/"+e.fcmToken,r)];case 3:return[4,i.sent().json()];case 4:if((o=i.sent()).error)throw a=o.error.message,wt.create("token-unsubscribe-failed",{errorInfo:a});return[3,6];case 5:throw s=i.sent(),wt.create("token-unsubscribe-failed",{errorInfo:s});case 6:return[2]}})})},t}();function Ct(t){return Tt+"/projects/"+t.options.projectId+"/registrations"}function Ot(t){var e=t.app,n=t.installations;return Object(i.b)(this,void 0,void 0,function(){var t;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return t=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}})})}function Nt(t,e){var n=St(t.getKey("p256dh")),r=St(t.getKey("auth")),i={web:{endpoint:t.endpoint,p256dh:n,auth:r}};return Et(e.buffer,_t.buffer)||(i.web.applicationPubKey=St(e)),i}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function At(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt="undefined",kt="fcm_token_object_Store";function Rt(t){var e=indexedDB.open(Dt);e.onerror=function(t){},e.onsuccess=function(n){!function(t,e){if(t.objectStoreNames.contains(kt)){var n=t.transaction(kt).objectStore(kt),r=new It,i=n.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var n=i.result;if(n){var o=n.value;r.deleteToken(e,o),n.continue()}else t.close(),indexedDB.deleteDatabase(Dt)}}}(e.result,t)}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pt=function(){function t(){this.dbPromise=null}return t.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},t.prototype.getIndex=function(t,e){return this.createTransaction(function(n){return n.index(t).get(e)})},t.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},t.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},t.prototype.closeDatabase=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),Object(i.b)(this,void 0,void 0,function(){var n,r,o,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,this.getDb()];case 1:return n=i.sent(),r=n.transaction(this.objectStoreName,e),o=r.objectStore(this.objectStoreName),[4,Mt(t(o))];case 2:return a=i.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(a)},r.onerror=function(){e(r.error)}})]}})})},t.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}})),this.dbPromise},t}();function Mt(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lt=function(t){function e(e){var n=t.call(this)||this;return n.services=e,n.dbName="fcm_token_details_db",n.dbVersion=4,n.objectStoreName="fcm_token_object_Store",n}return Object(i.c)(e,t),e.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(o=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),o.createIndex("fcmToken","fcmToken",{unique:!0});case 1:Rt(this.services);case 2:var r=(o=t.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var t=r.result;if(t){var e=t.value,n=Object(i.a)({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=At(e.vapidKey)),"string"==typeof e.auth&&(n.auth=At(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=At(e.p256dh).buffer),"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}};break;case 3:var o,a=(o=t.transaction.objectStore(this.objectStoreName)).openCursor();a.onsuccess=function(){var t=a.result;if(t){var e=t.value,n=Object(i.a)({},e);"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}}}},e.prototype.getTokenDetailsFromToken=function(t){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(e){if(!t)throw wt.create("bad-token");return xt({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},e.prototype.getTokenDetailsFromSWScope=function(t){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(e){if(!t)throw wt.create("bad-scope");return xt({swScope:t}),[2,this.get(t)]})})},e.prototype.saveTokenDetails=function(t){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(e){if(!t.swScope)throw wt.create("bad-scope");if(!t.vapidKey)throw wt.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw wt.create("bad-subscription");if(!t.fcmSenderId)throw wt.create("bad-sender-id");if(!t.fcmToken)throw wt.create("bad-token");return xt(t),[2,this.put(t)]})})},e.prototype.deleteToken=function(t){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.d)(this,function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(wt.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw wt.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}})})},e}(Pt);function xt(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw wt.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw wt.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw wt.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw wt.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw wt.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw wt.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw wt.create("bad-sender-id")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}return Object(i.c)(e,t),e.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},e.prototype.getVapidFromSWScope=function(t){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.d)(this,function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw wt.create("bad-scope");return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}})})},e.prototype.saveVapidDetails=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n;return Object(i.d)(this,function(r){if("string"!=typeof t||0===t.length)throw wt.create("bad-scope");if(null===e||65!==e.length)throw wt.create("bad-vapid-key");return n={swScope:t,vapidKey:e},[2,this.put(n)]})})},e.prototype.deleteVapidDetails=function(t){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.d)(this,function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw wt.create("delete-scope-not-found");return[4,this.delete(t)];case 2:return n.sent(),[2,e]}})})},e}(Pt),Ft=function(){function t(t){var e=this;this.services=t,this.vapidDetailsModel=new jt,this.subscriptionManager=new It;var n=t.app;if(this.app=n,!n.options.messagingSenderId||"string"!=typeof n.options.messagingSenderId)throw wt.create("bad-sender-id");this.INTERNAL={delete:function(){return e.delete()}},this.tokenDetailsModel=new Lt(t)}return t.prototype.getToken=function(){return Object(i.b)(this,void 0,void 0,function(){var t,e,n,r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return"default"!==(t=this.getNotificationPermission())?[3,2]:[4,this.requestNotificationPermission()];case 1:t=i.sent(),i.label=2;case 2:if("granted"!==t)throw wt.create("notifications-blocked");return[4,this.getSWRegistration_()];case 3:return e=i.sent(),[4,this.getPublicVapidKey_()];case 4:return n=i.sent(),[4,this.getPushSubscription(e,n)];case 5:return r=i.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 6:return(o=i.sent())?[2,this.manageExistingToken(e,r,n,o)]:[2,this.getNewToken(e,r,n)]}})})},t.prototype.manageExistingToken=function(t,e,n,r){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!Et(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=Et(t.getKey("auth"),n.auth),o=Et(t.getKey("p256dh"),n.p256dh);return r&&i&&o}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[3,1];case 1:return[4,this.deleteTokenFromDB(r.fcmToken)];case 2:return i.sent(),[2,this.getNewToken(t,e,n)];case 3:return[2]}})})},t.prototype.updateToken=function(t,e,n,r){return Object(i.b)(this,void 0,void 0,function(){var o,a,s;return Object(i.d)(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(r,this.services,e,n)];case 1:return o=i.sent(),a={swScope:t.scope,vapidKey:n,fcmSenderId:this.services.app.options.messagingSenderId,fcmToken:o,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(a)];case 2:return i.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return i.sent(),[2,o];case 4:return s=i.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw i.sent(),s;case 6:return[2]}})})},t.prototype.getNewToken=function(t,e,n){return Object(i.b)(this,void 0,void 0,function(){var r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,this.subscriptionManager.getToken(this.services,e,n)];case 1:return r=i.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.app.options.messagingSenderId,fcmToken:r,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return i.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return i.sent(),[2,r]}})})},t.prototype.deleteToken=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:e=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.subscriptionManager.deleteToken(this.services,e)];case 3:return r.sent(),[3,5];case 4:return n=r.sent(),console.error(n),[3,5];case 5:return[2]}})})},t.prototype.getPushSubscription=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,t.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})]}})})},t.prototype.requestPermission=function(){throw wt.create("only-available-in-window")},t.prototype.useServiceWorker=function(t){throw wt.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){throw wt.create("only-available-in-window")},t.prototype.onMessage=function(t,e,n){throw wt.create("only-available-in-window")},t.prototype.onTokenRefresh=function(t,e,n){throw wt.create("only-available-in-window")},t.prototype.setBackgroundMessageHandler=function(t){throw wt.create("only-available-in-sw")},t.prototype.delete=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission=function(){return Notification.permission},t.prototype.requestNotificationPermission=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){return Notification.requestPermission?[2,Notification.requestPermission()]:[2,Notification.permission]})})},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getSubscriptionManager=function(){return this.subscriptionManager},t}();var Ut=function(t){function e(e){var n=t.call(this,e)||this;return n.bgMessageHandler=null,self.addEventListener("push",function(t){n.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){n.onSubChange(t)}),self.addEventListener("notificationclick",function(t){n.onNotificationClick(t)}),n}return Object(i.c)(e,t),e.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},e.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},e.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},e.prototype.onPush_=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r,o,a,s;return Object(i.d)(this,function(i){switch(i.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return i.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return o=i.sent(),a=n.actions,s=Notification.maxActions,a&&s&&a.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,o.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return i.sent(),[2];case 5:return[2]}})})},e.prototype.onSubChange_=function(t){return Object(i.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),wt.create("unable-to-resubscribe",{errorInfo:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}})})},e.prototype.onNotificationClick_=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:if(!(t.notification&&t.notification.data&&t.notification.data.FCM_MSG))return[2];if(t.action)return[2];if(t.stopImmediatePropagation(),t.notification.close(),!(e=t.notification.data.FCM_MSG).notification)return[2];if(!(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)){if(!(e.data&&"google.c.a.c_id"in e.data))return[2];n=self.location.origin}return[4,this.getWindowClient_(n)];case 1:return(r=i.sent())?[3,4]:[4,self.clients.openWindow(n)];case 2:return r=i.sent(),[4,(a=3e3,new Promise(function(t){setTimeout(t,a)}))];case 3:return i.sent(),[3,6];case 4:return[4,r.focus()];case 5:r=i.sent(),i.label=6;case 6:return r?(delete e.notification,delete e.fcmOptions,o=qt(vt.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,o)]):[2]}var a;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})})},e.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=Object(i.a)({},t.notification);return n.data=Object(i.a)(Object(i.a)({},t.notification.data),((e={}).FCM_MSG=t,e)),n}},e.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw wt.create("bg-handler-function-expected");this.bgMessageHandler=t},e.prototype.getWindowClient_=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return e=new URL(t,self.location.href).href,[4,Vt()];case 1:for(n=i.sent(),r=null,o=0;o<n.length;o++)if(new URL(n[o].url,self.location.href).href===e){r=n[o];break}return[2,r]}})})},e.prototype.attemptToMessageClient_=function(t,e){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(n){if(!t)throw wt.create("no-window-client-to-msg");return t.postMessage(e),[2]})})},e.prototype.hasVisibleClients_=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){switch(t.label){case 0:return[4,Vt()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},e.prototype.sendMessageToWindowClients_=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r=this;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,Vt()];case 1:return e=i.sent(),n=qt(vt.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return i.sent(),[2]}})})},e.prototype.getSWRegistration_=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){return[2,self.registration]})})},e.prototype.getPublicVapidKey_=function(){return Object(i.b)(this,void 0,void 0,function(){var t,e;return Object(i.d)(this,function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw wt.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,_t]:[2,e]}})})},e}(Ft);function Vt(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function qt(t,e){return{firebaseMessagingType:t,firebaseMessagingData:e}}var Bt=function(t){function e(e){var n=t.call(this,e)||this;return n.registrationToUse=null,n.publicVapidKeyToUse=null,n.messageObserver=null,n.tokenRefreshObserver=null,n.onMessageInternal=Object(g.k)(function(t){n.messageObserver=t}),n.onTokenRefreshInternal=Object(g.k)(function(t){n.tokenRefreshObserver=t}),n.setupSWMessageListener_(),n}return Object(i.c)(e,t),e.prototype.requestPermission=function(){return Object(i.b)(this,void 0,void 0,function(){var t;return Object(i.d)(this,function(e){switch(e.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?wt.create("permission-blocked"):wt.create("permission-default")}})})},e.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw wt.create("sw-registration-expected");if(null!=this.registrationToUse)throw wt.create("use-sw-before-get-token");this.registrationToUse=t},e.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw wt.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw wt.create("use-public-key-before-get-token");var e=At(t);if(65!==e.length)throw wt.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},e.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},e.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},e.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise(function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){var i=function(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(wt.create("sw-reg-redundant"))}e.removeEventListener("statechange",i)};e.addEventListener("statechange",i)}else r(wt.create("sw-reg-redundant"));else n(t);else r(wt.create("no-sw-in-reg"))})},e.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw wt.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return t.registrationToUse=e,e.update(),e})}))},e.prototype.getPublicVapidKey_=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,_t]})})},e.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(e){return Object(i.b)(t,void 0,void 0,function(){var t,n,r,o,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return e.data&&e.data.firebaseMessagingType&&e.data.firebaseMessagingData?(t=e.data,n=t.firebaseMessagingType,r=t.firebaseMessagingData,this.messageObserver&&this.messageObserver.next(r),(o=r.data)&&"google.c.a.c_id"in o&&"1"===o["google.c.a.e"]?(a=function(t){switch(t){case vt.NOTIFICATION_CLICKED:return"notification_open";case vt.PUSH_MSG_RECEIVED:return"notification_foreground";default:throw new Error}}(n),[4,this.services.analyticsProvider.get()]):[3,2]):[2];case 1:i.sent().logEvent(a,{message_name:o["google.c.a.c_l"],message_id:o["google.c.a.c_id"],message_time:o["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),i.label=2;case 2:return[2]}})})},!1)},e}(Ft);var Wt="@firebase/messaging",Kt="0.6.1";function Ht(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}!
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e={isSupported:Ht};t.INTERNAL.registerComponent(new o.a("messaging",function(t){var e={app:t.getProvider("app").getImmediate(),installations:t.getProvider("installations").getImmediate(),analyticsProvider:t.getProvider("analytics-internal")};if(!Ht())throw wt.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new Ut(e):new Bt(e)},"PUBLIC").setServiceProps(e)),t.registerVersion(Wt,Kt)}(r.a);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Qt="firebasestorage.googleapis.com",Gt="storageBucket",zt=12e4,Yt=6e5,Xt=-9007199254740991,Jt=function(){function t(t,e){this.code_=Zt(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return Zt(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),$t={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function Zt(t){return"storage/"+t}function te(){return new Jt($t.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ee(){return new Jt($t.CANCELED,"User canceled the upload/download.")}function ne(){return new Jt($t.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function re(t,e,n){return new Jt($t.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function ie(){return new Jt($t.APP_DELETED,"The Firebase app was deleted.")}function oe(t,e){return new Jt($t.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function ae(t){throw new Jt($t.INTERNAL_ERROR,"Internal error: "+t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var se={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function ue(t){switch(t){case se.RAW:case se.BASE64:case se.BASE64URL:case se.DATA_URL:return;default:throw"Expected one of the event types: ["+se.RAW+", "+se.BASE64+", "+se.BASE64URL+", "+se.DATA_URL+"]."}}var ce=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function he(t,e){switch(t){case se.RAW:return new ce(le(e));case se.BASE64:case se.BASE64URL:return new ce(fe(t,e));case se.DATA_URL:return new ce((n=new pe(e)).base64?fe(se.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw oe(se.DATA_URL,"Malformed data URL.")}return le(e)}(n.rest),function(t){return new pe(t).contentType}(e))}var n;throw te()}function le(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function fe(t,e){switch(t){case se.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw oe(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case se.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw oe(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw oe(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var pe=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw oe(se.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1);var r,i;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}}();var de,me={STATE_CHANGED:"state_changed"},ge={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},ye={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function ve(t){switch(t){case ge.RUNNING:case ge.PAUSING:case ge.CANCELING:return ye.RUNNING;case ge.PAUSED:return ye.PAUSED;case ge.SUCCESS:return ye.SUCCESS;case ge.CANCELED:return ye.CANCELED;case ge.ERROR:default:return ye.ERROR}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(t){return null!=t}function we(t){return void 0!==t}function _e(t){return"function"==typeof t}function Te(t){return"object"==typeof t}function Ee(t){return Te(t)&&null!==t}function Se(t){return"string"==typeof t||t instanceof String}function Ie(t){return Ce(t)&&Number.isInteger(t)}function Ce(t){return"number"==typeof t||t instanceof Number}function Oe(t){return Ne()&&t instanceof Blob}function Ne(){return"undefined"!=typeof Blob}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(de||(de={}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ae=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=de.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=de.ABORT,e(t)}),t.xhr_.addEventListener("error",function(){t.errorCode_=de.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(){e(t)})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw ae("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),be(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return be(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw ae("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw ae("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw ae("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){be(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){be(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),De=function(){function t(){}return t.prototype.createXhrIo=function(){return new Ae},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ke(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Re=function(){function t(t,e){var n=0,r="";Oe(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Oe(this.data_)){var r=this.data_,i=(a=e,s=n,(o=r).webkitSlice?o.webkitSlice(a,s):o.mozSlice?o.mozSlice(a,s):o.slice?o.slice(a,s):null);return null===i?null:new t(i)}var o,a,s;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Ne()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ke();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Ne())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}.apply(null,r))}var i=e.map(function(t){return Se(t)?he(se.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var a=new Uint8Array(o),s=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)a[s++]=t[e]}),new t(a,!0)},t.prototype.uploadData=function(){return this.data_},t}(),Pe=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n,r;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw r=e,new Jt($t.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")},t.makeFromUrl=function(e){var n=null;var r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");for(var i=Qt.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(e);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];h||(h=""),n=new t(c,h),s.postModify(n);break}}if(null==n)throw function(t){return new Jt($t.INVALID_URL,"Invalid URL '"+t+"'.")}(e);return n},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Me(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return Te(n=e)&&!Array.isArray(n)?e:null}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Le(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(t){return"https://"+Qt+"/v0"+t}function je(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fe(t,e){return e}var Ue=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Fe}}(),Ve=null;function qe(){if(Ve)return Ve;var t=[];t.push(new Ue("bucket")),t.push(new Ue("generation")),t.push(new Ue("metageneration")),t.push(new Ue("name","fullPath",!0));var e=new Ue("name");e.xform=function(t,e){return function(t){return!Se(t)||t.length<2?t:Le(t)}(e)},t.push(e);var n=new Ue("size");return n.xform=function(t,e){return be(e)?Number(e):e},t.push(n),t.push(new Ue("timeCreated")),t.push(new Ue("updated")),t.push(new Ue("md5Hash",null,!0)),t.push(new Ue("cacheControl",null,!0)),t.push(new Ue("contentDisposition",null,!0)),t.push(new Ue("contentEncoding",null,!0)),t.push(new Ue("contentLanguage",null,!0)),t.push(new Ue("contentType",null,!0)),t.push(new Ue("metadata","customMetadata",!0)),Ve=t}function Be(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new Pe(n,r);return e.makeStorageReference(i)}})}(r,t),r}function We(t,e,n){var r=Me(e);return null===r?null:Be(t,r,n)}function Ke(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function He(t){if(!Te(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!Te(n))throw"Expected object for 'customMetadata' mapping."}else if(Ee(n))throw"Mapping for '"+e+"' cannot be an object."}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qe="maxResults",Ge=1e3,ze="pageToken",Ye="prefixes",Xe="items";function Je(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new Jt($t.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Gt+"' property when initializing the app?");if(e[Ye])for(var i=0,o=e[Ye];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new Pe(r,a));n.prefixes.push(s)}if(e[Xe])for(var u=0,c=e[Xe];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new Pe(r,h.name));n.items.push(s)}return n}function $e(t){if(!Te(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===Qe){if(!Ie(t[Qe])||t[Qe]<=0)throw"Expected maxResults to be a positive number.";if(t[Qe]>1e3)throw"Expected maxResults to be less than or equal to "+Ge+"."}else{if(e!==ze)throw"Unknown option: "+e;if(t[ze]&&!Se(t[ze]))throw"Expected pageToken to be string."}}var Ze=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(t){if(!t)throw te()}function en(t,e){return function(n,r){var i=We(t,r,e);return tn(null!==i),i}}function nn(t){return function(e,n){var r=function(t,e){var n=Me(e);return null===n?null:Je(t,n)}(t,n);return tn(null!==r),r}}function rn(t,e){return function(n,r){var i=We(t,r,e);return tn(null!==i),function(t,e){var n=Me(e);if(null===n)return null;if(!Se(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return xe("/b/"+i(n)+"/o/"+i(r))+je({alt:"media",token:e})})[0]}(i,r)}}function on(t){return function(e,n){var r,i,o;return 401===e.getStatus()?r=new Jt($t.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,r=new Jt($t.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new Jt($t.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function an(t){var e=on(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new Jt($t.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),o.setServerResponseProp(r.serverResponseProp()),o}}function sn(t,e,n){var r=xe(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new Ze(r,"GET",en(t,n),i);return o.errorHandler=an(e),o}function un(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var cn=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function hn(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){tn(!1)}return tn(!!n&&-1!==(e||["active"]).indexOf(n)),n}function ln(t,e,n,r,i,o,a,s){var u=new cn(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new Jt($t.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw ne();var m=e.maxUploadRetryTime(),g=new Ze(n,"POST",function(t,n){var i,a=hn(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?en(e,o)(t,n):null,new cn(s,c,"final"===a,i)},m);return g.headers=p,g.body=d.uploadData(),g.progressCallback=s||null,g.errorHandler=on(t),g}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fn=function(){return function(t,e,n){if(_e(t)||be(e)||be(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}}}(),pn=function(){return function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o}}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function dn(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}var a,s,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw a=r,s=i,u=t,c=n.length,a===s?(h=a,l=1===a?"argument":"arguments"):(h="between "+a+" and "+s,l="arguments"),new Jt($t.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?re(o,t,e.message):re(o,t,e)}}var mn=function(){return function(t,e){var n=this;this.validator=function(e){n.optional&&!we(e)||t(e)},this.optional=!!e}}();function gn(t,e){function n(t){if(!Se(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new mn(r,e)}function yn(){return new mn(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Ne()&&t instanceof Blob))throw"Expected Blob or File."})}function vn(t){return new mn(He,t)}function bn(){return new mn(function(t){if(!(Ce(t)&&t>=0))throw"Expected a number 0 or greater."})}function wn(t,e){return new mn(function(e){if(!(null===e||be(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function _n(t){return new mn(function(t){if(null!==t&&!_e(t))throw"Expected a Function."},t)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var En=function(){function t(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=ge.RUNNING,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals($t.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(ge.ERROR))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals($t.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(ge.ERROR))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===ge.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case ge.RUNNING:t(n);break;case ge.CANCELING:e.transition_(ge.CANCELED);break;case ge.PAUSING:e.transition_(ge.PAUSED)}})},t.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=un(e,r,i),s={name:a.fullPath},u=xe(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=Ke(a,n),l=t.maxUploadRetryTime(),f=new Ze(u,"POST",function(t){var e;hn(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){tn(!1)}return tn(Se(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=on(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new Ze(n,"POST",function(t){var e=hn(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){tn(!1)}n||tn(!1);var i=Number(n);return tn(!isNaN(i)),new cn(i,r.size(),"final"===e)},i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=on(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new cn(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=ln(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(e){return t.error_=e,void t.transition_(ge.ERROR)}var a=t.authWrapper_.makeRequest(o,i);t.request_=a,a.getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(ge.SUCCESS)):t.completeTransitions_()},t.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=sn(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(ge.SUCCESS)},t.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=un(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Ke(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=Re.getBlob(c,r,h);if(null===l)throw ne();var f={name:u.fullPath},p=xe(o),d=t.maxUploadRetryTime(),m=new Ze(p,"POST",en(t,n),d);return m.urlParams=f,m.headers=a,m.body=l.uploadData(),m.errorHandler=on(e),m}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(ge.SUCCESS)},t.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case ge.CANCELING:case ge.PAUSING:this.state_=t,null!==this.request_&&this.request_.cancel();break;case ge.RUNNING:var e=this.state_===ge.PAUSED;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case ge.PAUSED:this.state_=t,this.notifyObservers_();break;case ge.CANCELED:this.error_=ee(),this.state_=t,this.notifyObservers_();break;case ge.ERROR:case ge.SUCCESS:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case ge.PAUSING:this.transition_(ge.PAUSED);break;case ge.CANCELING:this.transition_(ge.CANCELED);break;case ge.RUNNING:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=ve(this.state_);return new pn(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=_n(!0).validator,a=wn(null,!0).validator;function s(t){try{return void o(t)}catch(t){}try{if(a(t),!(we(t.next)||we(t.error)||we(t.complete)))throw"";return}catch(t){throw i}}dn("on",[gn(function(){if(t!==me.STATE_CHANGED)throw"Expected one of the event types: ["+me.STATE_CHANGED+"]."}),wn(s,!0),_n(!0),_n(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&dn("on",t,arguments);var o=new fn(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[wn(function(t){if(null===t)throw i;s(t)}),_n(!0),_n(!0)];return!(we(e)||we(n)||we(r))?c(h):c(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},t.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach(function(e){t.notifyObserver_(e)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(ve(this.state_)){case ye.SUCCESS:Tn(this.resolve_.bind(null,this.snapshot))();break;case ye.CANCELED:case ye.ERROR:Tn(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(ve(this.state_)){case ye.RUNNING:case ye.PAUSED:t.next&&Tn(t.next.bind(t,this.snapshot))();break;case ye.SUCCESS:t.complete&&Tn(t.complete.bind(t))();break;case ye.CANCELED:case ye.ERROR:t.error&&Tn(t.error.bind(t,this.error_))();break;default:t.error&&Tn(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){dn("resume",[],arguments);var t=this.state_===ge.PAUSED||this.state_===ge.PAUSING;return t&&this.transition_(ge.RUNNING),t},t.prototype.pause=function(){dn("pause",[],arguments);var t=this.state_===ge.RUNNING;return t&&this.transition_(ge.PAUSING),t},t.prototype.cancel=function(){dn("cancel",[],arguments);var t=this.state_===ge.RUNNING||this.state_===ge.PAUSING;return t&&this.transition_(ge.CANCELING),t},t}(),Sn=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof Pe?e:Pe.makeFromUrl(e)}return t.prototype.toString=function(){return dn("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return qe()},t.prototype.child=function(t){dn("child",[gn()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new Pe(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new Pe(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new Pe(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Le(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),dn("put",[yn(),vn(!0)],arguments),this.throwIfRoot_("put"),new En(this,this.authWrapper,this.location,this.mappings(),new Re(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=se.RAW),dn("putString",[gn(),gn(ue,!0),vn(!0)],arguments),this.throwIfRoot_("putString");var r=he(e,t),i=Object.assign({},n);return!be(i.contentType)&&be(r.contentType)&&(i.contentType=r.contentType),new En(this,this.authWrapper,this.location,this.mappings(),new Re(r.data,!0),i)},t.prototype.delete=function(){var t=this;return dn("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e){var n=xe(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new Ze(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=an(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.listAll=function(){dn("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},t.prototype.listAllHelper=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r,o,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return n={pageToken:e},[4,this.list(n)];case 1:return r=i.sent(),(o=t.prefixes).push.apply(o,r.prefixes),(a=t.items).push.apply(a,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(t,r.nextPageToken)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.list=function(t){var e;dn("list",[(e=!0,new mn($e,e))],arguments);var n=this;return this.authWrapper.getAuthToken().then(function(e){var r=t||{},i=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=xe(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new Ze(a,"GET",nn(t),s);return u.urlParams=o,u.errorHandler=on(e),u}(n.authWrapper,n.location,"/",r.pageToken,r.maxResults);return n.authWrapper.makeRequest(i,e).getPromise()})},t.prototype.getMetadata=function(){var t=this;return dn("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(e){var n=sn(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.updateMetadata=function(t){var e=this;return dn("updateMetadata",[vn()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(n){var r=function(t,e,n,r){var i=xe(e.fullServerUrl()),o=Ke(n,r),a=t.maxOperationRetryTime(),s=new Ze(i,"PATCH",en(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=an(e),s}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},t.prototype.getDownloadURL=function(){var t=this;return dn("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e,n){var r=xe(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new Ze(r,"GET",rn(t,n),i);return o.errorHandler=an(e),o}(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw new Jt($t.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Jt($t.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),In=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}(),Cn=function(){function t(){this.map=new Map,this.id=Xt}return t.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},t.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},t}(),On=function(){function t(e,n,r,i,o,a){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var s=this.app_.options;be(s)&&(this.bucket_=t.extractBucket_(s))}this.authProvider_=n,this.storageRefMaker_=r,this.requestMaker_=i,this.pool_=a,this.service_=o,this.maxOperationRetryTime_=zt,this.maxUploadRetryTime_=Yt,this.requestMap_=new Cn}return t.extractBucket_=function(t){var e=t[Gt]||null;return null==e?null:Pe.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){var t=this.authProvider_.getImmediate({optional:!0});return t?t.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},t.prototype.bucket=function(){if(this.deleted_)throw ie();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new In(ie());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Nn=function(){function t(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());we(s)?i(s):i()}catch(t){o(t)}else null!==a?((r=te()).setServerResponseProp(a.getResponseText()),t.errorCallback_?o(t.errorCallback_(a,r)):o(r)):n.canceled?o(r=t.appDelete_?ie():ee()):o(r=new Jt($t.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new An(!1,null,!0)):this.backoffId_=
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e,n){var r=1,o=null,a=!1,s=0;function u(){return 2===s}var c=!1;function h(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];c||(c=!0,e.apply(null,t))}function l(e){o=setTimeout(function(){o=null,t(f,u())},e)}function f(t){for(var e,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];c||(t?h.call.apply(h,Object(i.g)([null,t],n)):u()||a?h.call.apply(h,Object(i.g)([null,t],n)):(r<64&&(r*=2),1===s?(s=2,e=0):e=1e3*(r+Math.random()),l(e)))}var p=!1;function d(t){p||(p=!0,c||(null!==o?(t||(s=2),clearTimeout(o),l(0)):t||(s=1)))}return l(0),setTimeout(function(){a=!0,d(!0)},n),d}(function(e,n){if(n)e(!1,new An(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===de.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new An(a,n))}else{var s=n.getErrorCode()===de.ABORT;e(!1,new An(!1,null,s))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),An=function(){return function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n}}();function Dn(t,e,n){var i=je(t.urlParams),o=t.url+i,a=Object.assign({},t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(a,e),function(t){var e=void 0!==r.a?r.a.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(a),new Nn(o,t.method,a,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kn=function(){function t(t,e,n,r){if(this.bucket_=null,this.authWrapper_=new On(t,e,function(t,e){return new Sn(t,e)},Dn,this,n),this.app_=t,null!=r)this.bucket_=Pe.makeFromBucketSpec(r);else{var i=this.authWrapper_.bucket();null!=i&&(this.bucket_=new Pe(i,""))}this.internals_=new Rn(this)}return t.prototype.ref=function(t){if(dn("ref",[gn(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new Sn(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return dn("refFromURL",[gn(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{Pe.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new Sn(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){dn("setMaxUploadRetryTime",[bn()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){dn("setMaxOperationRetryTime",[bn()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),Rn=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},t}(),Pn="@firebase/storage",Mn="0.3.23",Ln="storage";function xn(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return new kn(n,r,new De,e)}!function(t){var e={TaskState:ye,TaskEvent:me,StringFormat:se,Storage:kn,Reference:Sn};t.INTERNAL.registerComponent(new o.a(Ln,xn,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),t.registerVersion(Pn,Mn)}(r.a);var jn,Fn,Un,Vn,qn=n(4),Bn="@firebase/performance",Wn="0.2.29",Kn=Wn,Hn="FB-PERF-TRACE-START",Qn="FB-PERF-TRACE-STOP",Gn="FB-PERF-TRACE-MEASURE",zn="_wt_",Yn="@firebase/performance/config",Xn="@firebase/performance/configexpire",Jn=((jn={})["trace started"]="Trace {$traceName} was started before.",jn["trace stopped"]="Trace {$traceName} is not running.",jn["no window"]="Window is not available.",jn["no app id"]="App id is not available.",jn["no project id"]="Project id is not available.",jn["no api key"]="Api key is not available.",jn["invalid cc log"]="Attempted to queue invalid cc event",jn["FB not default"]="Performance can only start when Firebase app instance is the default one.",jn["RC response not ok"]="RC response is not ok",jn["invalid attribute name"]="Attribute name {$attributeName} is invalid.",jn["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",jn["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",jn),$n=new g.c("performance","Performance",Jn),Zn=function(){function t(t){if(this.window=t,!t)throw $n.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},t.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}}).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===Fn&&(Fn=new t(Un)),Fn},t}();var tr,er,nr=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw $n.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw $n.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw $n.create("no api key");return t},t.getInstance=function(){return void 0===Vn&&(Vn=new t),Vn},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(){return tr}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN"}(er||(er={}));var ir=["firebase_","google_","ga_"],or=new RegExp("^[a-zA-Z]\\w*$"),ar=40,sr=100;function ur(){switch(Zn.getInstance().document.visibilityState){case"visible":return er.VISIBLE;case"hidden":return er.HIDDEN;default:return er.UNKNOWN}}function cr(){var t=Zn.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var hr=new qn.b("Performance");hr.logLevel=qn.a.INFO;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var lr="0.0.1",fr={loggingEnabled:!0},pr="FIREBASE_INSTALLATIONS_AUTH";function dr(t){var e=function(){var t=Zn.getInstance().localStorage;if(!t)return;var e=t.getItem(Xn);if(!(e&&(n=e,Number(n)>Date.now())))return;var n;var r=t.getItem(Yn);if(!r)return;try{var i=JSON.parse(r);return i}catch(t){return}}();return e?(gr(e),Promise.resolve()):function(t){return(e=nr.getInstance().installationsService.getToken(),e.then(function(t){}),e).then(function(e){var n=nr.getInstance().getProjectId(),r="https://firebaseremoteconfig.googleapis.com/v1/projects/"+n+"/namespaces/fireperf:fetch?key="+nr.getInstance().getApiKey(),i=new Request(r,{method:"POST",headers:{Authorization:pr+" "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:nr.getInstance().getAppId(),app_version:Kn,sdk_version:lr})});return fetch(i).then(function(t){if(t.ok)return t.json();throw $n.create("RC response not ok")})}).catch(function(){hr.info(mr)});var e;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}(t).then(function(t){return gr(t)}).then(function(t){return function(t){var e=Zn.getInstance().localStorage;if(!t||!e)return;e.setItem(Yn,JSON.stringify(t)),e.setItem(Xn,String(Date.now()+60*nr.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var mr="Could not fetch config, will use default configs";function gr(t){if(!t)return t;var e=nr.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=fr.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=yr(e.tracesSamplingRate),e.logNetworkAfterSampling=yr(e.networkRequestsSamplingRate),t}function yr(t){return Math.random()<=t}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vr,br=1;function wr(){var t;return br=2,vr=vr||(t=Zn.getInstance().document,new Promise(function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()})).then(function(){return(t=nr.getInstance().installationsService.getId()).then(function(t){tr=t}),t;var t}).then(function(t){return dr(t)}).then(function(){return _r()},function(){return _r()})}function _r(){br=3}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tr,Er=1e4,Sr=3,Ir=Sr,Cr=[];function Or(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];!function(t){if(!t.eventTime||!t.message)throw $n.create("invalid cc log");Cr=Object(i.g)(Cr,[t])}({message:t.apply(void 0,e),eventTime:Date.now()})}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(t,e){Tr||(Tr=Or(kr)),Tr(t,e)}function Ar(t){var e=nr.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Zn.getInstance().requiredApisAvailable()&&(t.isAuto&&ur()!==er.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===br?Dr(t):wr().then(function(){return Dr(t)},function(){return Dr(t)})))}function Dr(t){rr()&&setTimeout(function(){return Nr(t,1)},0)}function kr(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:Rr(),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=Pr(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=Pr(n));var r={application_info:Rr(),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function Rr(){return{google_app_id:nr.getInstance().getAppId(),app_instance_id:rr(),web_app_info:{sdk_version:Kn,page_url:Zn.getInstance().getUrl(),service_worker_status:(t=Zn.getInstance().navigator,"serviceWorker"in t?t.serviceWorker.controller?2:3:1),visibility_state:ur(),effective_connection_type:cr()},application_process_state:0};var t}function Pr(t){return Object.keys(t).map(function(e){return{key:e,value:t[e]}})}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function t(e){setTimeout(function(){if(0!==Ir){if(!Cr.length)return t(Er);var e=Object(i.g)(Cr);Cr=[];var n=e.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),r={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:nr.getInstance().logSource,log_event:n};fetch(nr.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(r)}).then(function(t){return t.ok||hr.info("Call to Firebase backend failed."),t.json()}).then(function(e){var n=Number(e.next_request_wait_millis),r=isNaN(n)?Er:Math.max(Er,n);Ir=Sr,t(r)}).catch(function(){Cr=Object(i.g)(e,Cr),Ir--,hr.info("Tries left: "+Ir+"."),t(Er)})}},e)}(5500);var Mr=100,Lr="_",xr=["_fp","_fcp","_fid"];
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var jr=function(){function t(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Zn.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=Hn+"-"+this.randomId+"-"+this.name,this.traceStopMark=Qn+"-"+this.randomId+"-"+this.name,this.traceMeasure=n||Gn+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return t.prototype.start=function(){if(1!==this.state)throw $n.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},t.prototype.stop=function(){if(2!==this.state)throw $n.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Ar(this)},t.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=Object(i.a)({},n.attributes)),n&&n.metrics)for(var r=0,o=Object.keys(n.metrics);r<o.length;r++){var a=o[r];isNaN(Number(n.metrics[a]))||(this.counters[a]=Number(Math.floor(n.metrics[a])))}Ar(this)},t.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},t.prototype.putMetric=function(t,e){if(n=t,r=this.name,0===n.length||n.length>Mr||!(r&&r.startsWith(zn)&&xr.indexOf(n)>-1)&&n.startsWith(Lr))throw $n.create("invalide custom metric name",{customMetricName:t});var n,r;this.counters[t]=e},t.prototype.getMetric=function(t){return this.counters[t]||0},t.prototype.putAttribute=function(t,e){var n,r=!(0===(n=t).length||n.length>ar||ir.some(function(t){return n.startsWith(t)})||!n.match(or)),i=function(t){return 0!==t.length&&t.length<=sr}(e);if(r&&i)this.customAttributes[t]=e;else{if(!r)throw $n.create("invalid attribute name",{attributeName:t});if(!i)throw $n.create("invalid attribute value",{attributeValue:e})}},t.prototype.getAttribute=function(t){return this.customAttributes[t]},t.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},t.prototype.getAttributes=function(){return Object(i.a)({},this.customAttributes)},t.prototype.setStartTime=function(t){this.startTimeUs=t},t.prototype.setDuration=function(t){this.durationUs=t},t.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},t.createOobTrace=function(e,n,r){var i=Zn.getInstance().getUrl();if(i){var o=new t(zn+i,!0),a=Math.floor(1e3*Zn.getInstance().getTimeOrigin());o.setStartTime(a),e&&e[0]&&(o.setDuration(Math.floor(1e3*e[0].duration)),o.putMetric("domInteractive",Math.floor(1e3*e[0].domInteractive)),o.putMetric("domContentLoadedEventEnd",Math.floor(1e3*e[0].domContentLoadedEventEnd)),o.putMetric("loadEventEnd",Math.floor(1e3*e[0].loadEventEnd)));if(n){var s=n.find(function(t){return"first-paint"===t.name});s&&s.startTime&&o.putMetric("_fp",Math.floor(1e3*s.startTime));var u=n.find(function(t){return"first-contentful-paint"===t.name});u&&u.startTime&&o.putMetric("_fcp",Math.floor(1e3*u.startTime)),r&&o.putMetric("_fid",Math.floor(1e3*r))}Ar(o)}},t.createUserTimingTrace=function(e){Ar(new t(e,!1,e))},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(t){var e=t;if(e&&void 0!==e.responseStart){var n=Zn.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=nr.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return Nr(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ur=5e3;function Vr(){rr()&&(setTimeout(function(){return function(){var t=Zn.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){jr.createOobTrace(e,n),r=void 0},Ur);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),jr.createOobTrace(e,n,t))})}else jr.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=Zn.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){var i=r[n];Fr(i)}t.setupObserver("resource",Fr)}()},0),setTimeout(function(){return function(){for(var t=Zn.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){var i=r[n];qr(i)}t.setupObserver("measure",qr)}()},0))}function qr(t){var e=t.name;e.substring(0,Gn.length)!==Gn&&jr.createUserTimingTrace(e)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Br=function(){function t(t){this.app=t,Zn.getInstance().requiredApisAvailable()?wr().then(Vr,Vr):hr.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return t.prototype.trace=function(t){return new jr(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return nr.getInstance().instrumentationEnabled},set:function(t){nr.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return nr.getInstance().dataCollectionEnabled},set:function(t){nr.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),t}(),Wr="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){var e=function(t,e){if(t.name!==Wr)throw $n.create("FB not default");if("undefined"==typeof window)throw $n.create("no window");return function(t){Un=t}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(window),nr.getInstance().firebaseAppInstance=t,nr.getInstance().installationsService=e,new Br(t)};t.INTERNAL.registerComponent(new o.a("performance",function(t){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();return e(n,r)},"PUBLIC")),t.registerVersion(Bn,Wn)}(r.a);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Kr,Hr,Qr,Gr="measurementId",zr="firebase_id",Yr="origin",Xr="https://www.googletagmanager.com/gtag/js";function Jr(t,e,n){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];window[e].push(arguments)};return window[n]&&"function"==typeof window[n]&&(r=window[n]),window[n]=function(t,e){return function(n,r,i){if(n===Kr.EVENT){var o=[];if(i&&i.send_to){var a=i.send_to;Array.isArray(a)||(a=[a]);for(var s=0,u=a;s<u.length;s++){var c=u[s],h=e[c];if(!h){o=[];break}o.push(h)}}if(0===o.length)for(var l=0,f=Object.values(e);l<f.length;l++){var p=f[l];o.push(p)}Promise.all(o).then(function(){return t(Kr.EVENT,r,i||{})}).catch(function(t){return console.error(t)})}else n===Kr.CONFIG?(e[r]||Promise.resolve()).then(function(){t(Kr.CONFIG,r,i)}).catch(function(t){return console.error(t)}):t(Kr.SET,r)}}(r,t),{gtagCore:r,wrappedGtag:window[n]}}!function(t){t.EVENT="event",t.SET="set",t.CONFIG="config"}(Kr||(Kr={})),function(t){t.ADD_PAYMENT_INFO="add_payment_info",t.ADD_TO_CART="add_to_cart",t.ADD_TO_WISHLIST="add_to_wishlist",t.BEGIN_CHECKOUT="begin_checkout",t.CHECKOUT_PROGRESS="checkout_progress",t.EXCEPTION="exception",t.GENERATE_LEAD="generate_lead",t.LOGIN="login",t.PAGE_VIEW="page_view",t.PURCHASE="purchase",t.REFUND="refund",t.REMOVE_FROM_CART="remove_from_cart",t.SCREEN_VIEW="screen_view",t.SEARCH="search",t.SELECT_CONTENT="select_content",t.SET_CHECKOUT_OPTION="set_checkout_option",t.SHARE="share",t.SIGN_UP="sign_up",t.TIMING_COMPLETE="timing_complete",t.VIEW_ITEM="view_item",t.VIEW_ITEM_LIST="view_item_list",t.VIEW_PROMOTION="view_promotion",t.VIEW_SEARCH_RESULTS="view_search_results"}(Hr||(Hr={}));var $r,Zr,ti=((Qr={})["no-ga-id"]='"'+Gr+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',Qr["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",Qr["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",Qr["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate",Qr),ei=new g.c("analytics","Analytics",ti),ni={},ri="dataLayer",ii="gtag",oi=!1;function ai(t){if(oi)throw ei.create("already-initialized");t.dataLayerName&&(ri=t.dataLayerName),t.gtagName&&(ii=t.gtagName)}function si(t,e){var n=t.options[Gr];if(!n)throw ei.create("no-ga-id");if(null!=ni[n])throw ei.create("already-exists",{id:n});if(!oi){(function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(Xr))return r}return null}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)()||function(t){var e=document.createElement("script");e.src=Xr+"?l="+t,e.async=!0,document.head.appendChild(e)}(ri),function(t){var e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(ri);var r=Jr(ni,ri,ii),o=r.wrappedGtag,a=r.gtagCore;Zr=o,$r=a,oi=!0}return ni[n]=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e,n){return Object(i.b)(this,void 0,void 0,function(){var r,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,e.getId()];case 1:return r=i.sent(),n("js",new Date),n(Kr.CONFIG,t.options[Gr],((o={})[zr]=r,o[Yr]="firebase",o.update=!0,o)),[2]}})})}(t,e,$r),{app:t,logEvent:function(t,e,r){
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return function(t,e,n,r,o){var a=r||{};o&&o.global||(a=Object(i.a)(Object(i.a)({},r),{send_to:e})),t(Kr.EVENT,n,a||{})}(Zr,n,t,e,r)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(Kr.SET,{screen_name:n}):t(Kr.CONFIG,e,{update:!0,screen_name:n})}(Zr,n,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(Kr.SET,{user_id:n}):t(Kr.CONFIG,e,{update:!0,user_id:n})}(Zr,n,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(Kr.SET,i)}else t(Kr.CONFIG,e,{update:!0,user_properties:n})}(Zr,n,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(n,t)}}}var ui="@firebase/analytics",ci="0.2.10",hi="analytics";!function(t){t.INTERNAL.registerComponent(new o.a(hi,function(t){return si(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())},"PUBLIC").setServiceProps({settings:ai,EventName:Hr})),t.INTERNAL.registerComponent(new o.a("analytics-internal",function(t){try{var e=t.getProvider(hi).getImmediate();return{logEvent:e.logEvent}}catch(t){throw ei.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),t.registerVersion(ui,ci)}(r.a);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var li,fi=function(){function t(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}return t.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r,o,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=i.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(t.cacheMaxAgeMillis,n)?[2,r]:(t.eTag=r&&r.eTag,[4,this.client.fetch(t)]);case 2:return o=i.sent(),a=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===o.status&&a.push(this.storage.setLastSuccessfulFetchResponse(o)),[4,Promise.all(a)];case 3:return i.sent(),[2,o]}})})},t}(),pi=((li={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",li["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",li["registration-api-key"]="Undefined API key. Check Firebase app initialization.",li["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",li["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",li["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",li["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",li["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",li["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",li["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',li["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',li["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",li["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",li),di=new g.c("remoteconfig","Remote Config",pi);
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var mi=function(){function t(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}return t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n,r,o,a,s,u,c,h,l,f,p,d,m,g,y,v,b,w;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=i.sent(),n=e[0],r=e[1],o=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",a=o+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},u={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:(void 0===_&&(_=navigator),_.languages&&_.languages[0]||_.language)},c={method:"POST",headers:s,body:JSON.stringify(u)},h=fetch(a,c),l=new Promise(function(e,n){t.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",n(t)})}),i.label=2;case 2:return i.trys.push([2,5,,6]),[4,Promise.race([h,l])];case 3:return i.sent(),[4,h];case 4:return f=i.sent(),[3,6];case 5:throw p=i.sent(),d="fetch-client-network","AbortError"===p.name&&(d="fetch-timeout"),di.create(d,{originalErrorMessage:p.message});case 6:if(m=f.status,g=f.headers.get("ETag")||void 0,200!==f.status)return[3,11];b=void 0,i.label=7;case 7:return i.trys.push([7,9,,10]),[4,f.json()];case 8:return b=i.sent(),[3,10];case 9:throw w=i.sent(),di.create("fetch-client-parse",{originalErrorMessage:w.message});case 10:y=b.entries,v=b.state,i.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===v?m=500:"NO_CHANGE"===v?m=304:"NO_TEMPLATE"!==v&&"EMPTY_CONFIG"!==v||(y={}),304!==m&&200!==m)throw di.create("fetch-status",{httpStatus:m});return[2,{status:m,eTag:g,config:y}]}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _})})},t}(),gi=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},t}(),yi="",vi=["1","true","t","yes","y","on"],bi=function(){function t(t,e){void 0===e&&(e=yi),this._source=t,this._value=e}return t.prototype.asString=function(){return this._value},t.prototype.asBoolean=function(){return"static"!==this._source&&vi.indexOf(this._value.toLowerCase())>=0},t.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},t.prototype.getSource=function(){return this._source},t}(),wi=6e4,_i=432e5,Ti=function(){function t(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:wi,minimumFetchIntervalMillis:_i},this.defaultConfig={}}return t.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=qn.a.DEBUG;break;case"silent":this._logger.logLevel=qn.a.SILENT;break;default:this._logger.logLevel=qn.a.ERROR}},Object.defineProperty(t.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),t.prototype.activate=function(){return Object(i.b)(this,void 0,void 0,function(){var t,e,n;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=r.sent(),e=t[0],n=t[1],e&&e.config&&e.eTag&&e.eTag!==n?[4,Promise.all([this._storageCache.setActiveConfig(e.config),this._storage.setActiveConfigEtag(e.eTag)])]:[2,!1];case 2:return r.sent(),[2,!0]}})})},t.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},t.prototype.fetch=function(){return Object(i.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(i.d)(this,function(o){switch(o.label){case 0:t=new gi,setTimeout(function(){return Object(i.b)(r,void 0,void 0,function(){return Object(i.d)(this,function(e){return t.abort(),[2]})})},this.settings.fetchTimeoutMillis),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:t})];case 2:return o.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return o.sent(),[3,6];case 4:return e=o.sent(),s="fetch-throttle",n=(a=e)instanceof g.d&&-1!==a.code.indexOf(s)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(n)];case 5:throw o.sent(),e;case 6:return[2]}var a,s})})},t.prototype.fetchAndActivate=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},t.prototype.getAll=function(){var t=this;return function(t,e){void 0===t&&(t={});void 0===e&&(e={});return Object.keys(Object(i.a)(Object(i.a)({},t),e))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(e,n){return e[n]=t.getValue(n),e},{})},t.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},t.prototype.getNumber=function(t){return this.getValue(t).asNumber()},t.prototype.getString=function(t){return this.getValue(t).asString()},t.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new bi("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new bi("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new bi("static"))},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(t,e){var n=t.target.error||void 0;return di.create(e,{originalErrorMessage:n&&n.message})}var Si="app_namespace_store",Ii="firebase_remote_config",Ci=1;var Oi=function(){function t(t,e,n,r){void 0===r&&(r=new Promise(function(t,e){var n=indexedDB.open(Ii,Ci);n.onerror=function(t){e(Ei(t,"storage-open"))},n.onsuccess=function(e){t(e.target.result)},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(Si,{keyPath:"compositeKey"})}}})),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}return t.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},t.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},t.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},t.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},t.prototype.getActiveConfig=function(){return this.get("active_config")},t.prototype.setActiveConfig=function(t){return this.set("active_config",t)},t.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},t.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},t.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},t.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},t.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},t.prototype.get=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n=this;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise(function(r,i){var o=e.transaction([Si],"readonly").objectStore(Si),a=n.createCompositeKey(t);try{var s=o.get(a);s.onerror=function(t){i(Ei(t,"storage-get"))},s.onsuccess=function(t){var e=t.target.result;r(e?e.value:void 0)}}catch(t){i(di.create("storage-get",{originalErrorMessage:t&&t.message}))}})]}})})},t.prototype.set=function(t,e){return Object(i.b)(this,void 0,void 0,function(){var n,r=this;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,this.openDbPromise];case 1:return n=i.sent(),[2,new Promise(function(i,o){var a=n.transaction([Si],"readwrite").objectStore(Si),s=r.createCompositeKey(t);try{var u=a.put({compositeKey:s,value:e});u.onerror=function(t){o(Ei(t,"storage-set"))},u.onsuccess=function(){i()}}catch(t){o(di.create("storage-set",{originalErrorMessage:t&&t.message}))}})]}})})},t.prototype.delete=function(t){return Object(i.b)(this,void 0,void 0,function(){var e,n=this;return Object(i.d)(this,function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise(function(r,i){var o=e.transaction([Si],"readwrite").objectStore(Si),a=n.createCompositeKey(t);try{var s=o.delete(a);s.onerror=function(t){i(Ei(t,"storage-delete"))},s.onsuccess=function(){r()}}catch(t){i(di.create("storage-delete",{originalErrorMessage:t&&t.message}))}})]}})})},t.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},t}(),Ni=function(){function t(t){this.storage=t}return t.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},t.prototype.getActiveConfig=function(){return this.activeConfig},t.prototype.loadFromStorage=function(){return Object(i.b)(this,void 0,void 0,function(){var t,e,n,r,o,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),[4,t];case 1:return(r=i.sent())&&(this.lastFetchStatus=r),[4,e];case 2:return(o=i.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,n];case 3:return(a=i.sent())&&(this.activeConfig=a),[2]}})})},t.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},t.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},t}(),Ai=1e3,Di=2,ki=144e5,Ri=.5;
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(t){var e=Ai*Math.pow(Di,t),n=Math.round(Ri*e*(Math.random()-.5)*2);return Math.min(ki,e+n)}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mi(t,e){return new Promise(function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener(function(){clearTimeout(o),r(di.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}var Li,xi=function(){function t(t,e){this.client=t,this.storage=e}return t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.d)(this,function(n){switch(n.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=n.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(t,e)]}})})},t.prototype.attemptFetch=function(t,e){var n=e.throttleEndTimeMillis,r=e.backoffCount;return Object(i.b)(this,void 0,void 0,function(){var e,o,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return[4,Mi(t.signal,n)];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,5,,7]),[4,this.client.fetch(t)];case 3:return e=i.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return i.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof g.d))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(o=i.sent()))throw o;return a={throttleEndTimeMillis:Date.now()+Pi(r),backoffCount:r+1},[4,this.storage.setThrottleMetadata(a)];case 6:return i.sent(),[2,this.attemptFetch(t,a)];case 7:return[2]}})})},t}(),ji="@firebase/remote-config",Fi="0.1.10";(Li=r.a).INTERNAL.registerComponent(new o.a("remoteConfig",function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();if("undefined"==typeof window)throw di.create("registration-window");var i=n.options,o=i.projectId,a=i.apiKey,s=i.appId;if(!o)throw di.create("registration-project-id");if(!a)throw di.create("registration-api-key");if(!s)throw di.create("registration-app-id");e=e||"firebase";var u=new Oi(s,n.name,e),c=new Ni(u),h=new qn.b(ji);h.logLevel=qn.a.ERROR;var l=new mi(r,Li.SDK_VERSION,e,o,a,s),f=new xi(l,u),p=new fi(f,u,c,h),d=new Ti(n,p,c,u,h);return d.ensureInitialized(),d},"PUBLIC").setMultipleInstances(!0)),Li.registerVersion(ji,Fi);
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
r.a.registerVersion("firebase","7.6.2","app");
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport * as firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),r.a.registerVersion("firebase","7.6.2");var Ui=r.a,Vi={apiBaseUrl:"https://courses-rest-api.herokuapp.com/api/",authDomain:process.env.REACT_APP_AUTH_DOMAIN,fireBaseApiKey:process.env.REACT_APP_FIRESTORE_API_KEY,projectId:process.env.REACT_APP_PROJECT_ID};n(10),Ui.initializeApp({apiKey:Vi.fireBaseApiKey,authDomain:Vi.authDomain,projectId:Vi.projectId});const qi=Ui.firestore(),Bi=(qi.collection("users"),qi.collection("courses"));exports.handler=(async(t,e,n)=>{if("GET"===t.httpMethod&&"/courses"===t.path){n(null,{statusCode:200,body:(()=>Bi.get().then(t=>{t.exists?console.log("Document data:",t.data()):console.log("No such document!")}).catch(t=>{console.log("Error getting document:",t)}))()})}else n(null,{statusCode:400,body:{}})})}]));